import{r as v,j as e,e as B,d as o,aq as E,G as n,ar as c,a6 as P,K as M,u as G,as as O,at as U,C as z,b as x,Z as R,T as f,P as D,au as Y,a as W,av as _,B as F,ae as Q}from"./index-B471k5WB.js";import{u as L}from"./useAppointmentQueries-BH9FtcaG.js";import{u as q,d,a as K,t as V}from"./useWorkingHoursQueries-CZeh6n4A.js";import{I as Z,A as $,C as J}from"./AppointmentDetailsDrawer-D2AMyYKY.js";import{T as a}from"./Table-CqAoQaK7.js";import{G as A}from"./Grid-ViyXeQ7k.js";import"./appointmentService-BvcC1dgI.js";import"./useUserQueries-C6UIMzI2.js";import"./use-form-DgJEfYh-.js";import"./use-isomorphic-layout-effect.browser.esm-CdpQkb4V.js";function X({appointments:l=[]}){const[u,h]=v.useState(null),[p,m]=v.useState(!1),{updateAppointmentStatus:w}=L(),y={0:"Scheduled",1:"Cancelled",2:"Completed",3:"No Show"},T={0:"blue",1:"red",2:"green",3:"orange"},j=async(r,g)=>{try{const i=await w.mutateAsync({appointmentId:r,newStatus:g});M.show({title:"Success",message:i.message||"Appointment status updated successfully",color:"green"})}catch(i){M.show({title:"Error",message:i.message||"Failed to update appointment status",color:"red"})}},b=r=>{h(r),m(!0)};return l.length===0?e.jsx(B,{h:200,children:e.jsx(o,{size:"lg",fw:500,c:"dimmed",children:"No appointments scheduled for today"})}):e.jsxs(e.Fragment,{children:[e.jsxs(a,{verticalSpacing:"sm",highlightOnHover:!0,mt:15,children:[e.jsx(a.Thead,{children:e.jsxs(a.Tr,{children:[e.jsx(a.Th,{c:"dimmed",children:"ID"}),e.jsx(a.Th,{c:"dimmed",children:"Patient"}),e.jsx(a.Th,{c:"dimmed",children:"Doctor"}),e.jsx(a.Th,{c:"dimmed",children:"Time"}),e.jsx(a.Th,{c:"dimmed",children:"Status"})]})}),e.jsx(a.Tbody,{children:l.map(r=>{const g=r.status,i=y[g]||"Scheduled",C=T[g]||"blue";return e.jsxs(a.Tr,{style:{cursor:"pointer"},onClick:()=>b(r),children:[e.jsx(a.Td,{children:r.id}),e.jsx(a.Td,{children:e.jsx(o,{size:"sm",children:r.patientName})}),e.jsx(a.Td,{children:e.jsxs(o,{size:"sm",children:["Dr. ",r.doctorName]})}),e.jsx(a.Td,{children:e.jsx(o,{size:"sm",children:r.displayTime})}),e.jsx(a.Td,{children:e.jsx(E,{size:"sm",color:C,children:i})}),e.jsx(a.Td,{children:e.jsx(n,{gap:"xs",onClick:S=>S.stopPropagation(),children:e.jsxs(c,{shadow:"md",width:200,children:[e.jsx(c.Target,{children:e.jsx(P,{variant:"subtle",color:"gray",children:e.jsx(Z,{size:16})})}),e.jsxs(c.Dropdown,{children:[e.jsx(c.Label,{children:"Update Status"}),e.jsx(c.Item,{onClick:()=>j(r.id,0),color:"blue",children:"Mark as Scheduled"}),e.jsx(c.Item,{onClick:()=>j(r.id,1),color:"red",children:"Mark as Cancelled"}),e.jsx(c.Item,{onClick:()=>j(r.id,2),color:"green",children:"Mark as Completed"}),e.jsx(c.Item,{onClick:()=>j(r.id,3),color:"orange",children:"Mark as No Show"})]})]})})})]},r.id)})})]}),e.jsx($,{opened:p,onClose:()=>m(!1),appointment:u})]})}const ee="_autoHideScrollbar_uhlgo_2",I={autoHideScrollbar:ee};d.extend(K);d.extend(V);const N=l=>{const u=d().tz(d.tz.guess()).format("YYYY-MM-DD"),h=d.utc(l).tz(d.tz.guess()).format("YYYY-MM-DD");return u===h},se=(l,u)=>{const h=d().day();return l.filter(p=>{const m=u[p.id]||[];return m.length===0?!0:m.includes(h)})};function he(){const l=G(),{appointments:u,isLoadingAppointments:h,appointmentsError:p}=L(),{doctors:m,isLoading:w}=O(),{doctorsWorkingDays:y,isLoading:T}=q(),[j,{open:b,close:r}]=U(!1),g=s=>{l(`/doctors/${s}`)},i=(u||[]).map(s=>{var k;const t=s.startDate?d.utc(s.startDate).tz(d.tz.guess()):null;return{...s,formattedStartDate:t,doctorName:((k=s.doctor)==null?void 0:k.name)||"N/A",displayDate:(t==null?void 0:t.format("MMM D, YYYY"))||"Invalid Date",displayTime:(t==null?void 0:t.format("hh:mm A"))||"Invalid Time"}}),C=i.filter(s=>s.formattedStartDate&&N(s.startDate)),S=i.filter(s=>s.formattedStartDate&&N(s.startDate)).sort((s,t)=>!s.formattedStartDate||!t.formattedStartDate?0:s.formattedStartDate.isBefore(t.formattedStartDate)?-1:1),H=se(m,y);return h||w||T?e.jsx(z,{pt:12,fluid:!0,maw:1232,children:e.jsx(B,{h:400,children:e.jsxs(x,{align:"center",children:[e.jsx(R,{size:"lg"}),e.jsx(o,{children:"Loading dashboard..."})]})})}):p?e.jsx(z,{pt:12,fluid:!0,maw:1232,children:e.jsxs(o,{color:"red",children:["Error loading dashboard: ",p.message]})}):e.jsx(z,{pt:12,fluid:!0,maw:1232,h:"200",children:e.jsxs(x,{children:[e.jsx(f,{fz:"24px",order:2,children:"Dashboard"}),e.jsxs(A,{gutter:"md",w:"100%",children:[e.jsx(A.Col,{span:8,children:e.jsxs(x,{children:[e.jsxs(n,{justify:"space-between",gap:"md",w:"100%",children:[e.jsx(D,{withBorder:!0,radius:"md",p:"md",h:100,style:{flex:1},children:e.jsx(n,{justify:"space-between",align:"center",h:"100%",children:e.jsxs(x,{gap:"xs",children:[e.jsxs(n,{gap:"xs",children:[e.jsx(Y,{size:20,color:"var(--mantine-color-green-6)"}),e.jsx(f,{order:3,fz:"16px",c:"dimmed",children:"Today's Appointments"})]}),e.jsx(o,{fz:"24px",fw:700,c:"green",children:C.length})]})})}),e.jsx(D,{withBorder:!0,radius:"md",p:"md",h:100,style:{flex:1},children:e.jsx(n,{justify:"space-between",align:"center",h:"100%",children:e.jsxs(x,{gap:"xs",children:[e.jsxs(n,{gap:"xs",children:[e.jsx(Y,{size:20,color:"var(--mantine-color-blue-6)"}),e.jsx(f,{order:3,fz:"16px",c:"dimmed",children:"Total Appointments"})]}),e.jsx(o,{fz:"24px",fw:700,c:"blue",children:i.length})]})})})]}),e.jsxs(D,{withBorder:!0,radius:"md",p:"md",h:500,children:[e.jsxs(n,{justify:"space-between",align:"center",children:[e.jsx(n,{children:e.jsx(f,{order:3,fz:"18px",children:"Upcoming Appointments"})}),e.jsx(W,{onClick:b,leftSection:e.jsx(_,{size:16}),variant:"outline",size:"md",radius:"xl",fw:500,children:"New Appointment"})]}),e.jsx(F,{mah:600,style:{overflowY:"auto"},className:I.autoHideScrollbar,children:e.jsx(X,{appointments:S})})]})]})}),e.jsx(A.Col,{span:4,children:e.jsxs(D,{withBorder:!0,radius:"md",p:"md",h:616,children:[e.jsx(n,{mb:"xs",children:e.jsx(f,{order:4,fz:"lg",children:"Available Doctors"})}),e.jsx(x,{gap:"sm",style:{overflowY:"auto",height:"calc(100% - 40px)"},className:I.autoHideScrollbar,children:H.map(s=>e.jsxs(n,{style:{cursor:"pointer",padding:"8px",borderRadius:"8px",transition:"background-color 0.2s ease"},gap:"xs",onClick:()=>g(s.id),onMouseEnter:t=>{t.currentTarget.style.backgroundColor="var(--mantine-color-gray-1)"},onMouseLeave:t=>{t.currentTarget.style.backgroundColor="transparent"},children:[e.jsx(Q,{color:"#e7edf6",style:{cursor:"pointer"},size:"md",radius:"xl",variant:"filled",children:e.jsx(o,{fz:"sm",children:s.name.split(" ").map(t=>t[0]).join("").toUpperCase()})}),e.jsxs(x,{gap:"0",children:[e.jsxs(o,{fw:500,truncate:!0,children:["Dr. ",s.name]}),e.jsx(o,{size:"sm",c:"dimmed",truncate:!0,children:s.clinicName})]})]},s.id))})]})})]}),e.jsx(J,{opened:j,onClose:r})]})})}export{he as default};
