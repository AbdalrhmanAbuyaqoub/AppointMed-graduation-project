import{b as j,z as H,r as h,j as s,C as K,f as d,P as V,G as i,a3 as X,a4 as Z,aR as M,T as t,ab as $,e as m,an as S,D as ee,E as c,aO as U}from"./index-BG_Rz9Kc.js";import{u as se}from"./useUserQueries-gUIlUw__.js";import{T as w}from"./Title-BoY58k0_.js";import{B as R}from"./Badge-D2ZgZWu3.js";import{D as T}from"./Divider-BL_IfcrE.js";import{S as ae}from"./SimpleGrid-CtzGnnrh.js";import{I as re}from"./IconMail-l7tDXSvJ.js";import{a as oe,I as te}from"./IconTrash-vDUftuY0.js";import{I as ie}from"./IconMapPin-BL27BLe3.js";import{P as x,A as le}from"./PasswordInput-Ds9RNr8B.js";import"./useQuery-B3rl-HGt.js";import"./useMutation-MLE0ngmp.js";import"./ActionIcon-BJ1Gw5Ys.js";/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var ne=j("outline","alert-triangle","IconAlertTriangle",[["path",{d:"M12 9v4",key:"svg-0"}],["path",{d:"M10.363 3.591l-8.106 13.534a1.914 1.914 0 0 0 1.636 2.871h16.214a1.914 1.914 0 0 0 1.636 -2.87l-8.106 -13.536a1.914 1.914 0 0 0 -3.274 0z",key:"svg-1"}],["path",{d:"M12 16h.01",key:"svg-2"}]]);/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var de=j("outline","circle-check","IconCircleCheck",[["path",{d:"M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0",key:"svg-0"}],["path",{d:"M9 12l2 2l4 -4",key:"svg-1"}]]);/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var ce=j("outline","lock","IconLock",[["path",{d:"M5 13a2 2 0 0 1 2 -2h10a2 2 0 0 1 2 2v6a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2v-6z",key:"svg-0"}],["path",{d:"M11 16a1 1 0 1 0 2 0a1 1 0 0 0 -2 0",key:"svg-1"}],["path",{d:"M8 11v-4a4 4 0 1 1 8 0v4",key:"svg-2"}]]);const L=g=>{try{if(!g)return null;const n=g.split(".");if(n.length!==3)return null;const e=JSON.parse(atob(n[1]));return console.log("Decoded token payload:",e),e}catch(n){return console.error("Error decoding token:",n),null}};function Ee({isModal:g=!1,onClose:n}){var N,E,C,z,I,b,A,k,D;const{user:e,handleLogout:O}=H(),{resetPasswordWithToken:B,deleteAccount:P,isResettingPassword:F,isDeletingAccount:q}=se();h.useEffect(()=>{},[e]);const[G,p]=h.useState(!1),[_,f]=h.useState(!1),[o,u]=h.useState({oldPassword:"",newPassword:"",confirmNewPassword:""}),[v,W]=h.useState(""),J=()=>{if(e!=null&&e.id)return e.id;if(e!=null&&e.userId)return e.userId;if(e!=null&&e.user_id)return e.user_id;const r=U(),a=L(r);return(a==null?void 0:a.nameid)||(a==null?void 0:a.userId)||(a==null?void 0:a.sub)||(a==null?void 0:a.id)},y=()=>{if(e!=null&&e.email)return e.email;const r=U(),a=L(r);return(a==null?void 0:a.email)||(a==null?void 0:a.unique_name)},Q=async r=>{if(r.preventDefault(),o.newPassword!==o.confirmNewPassword){c.show({title:"Error",message:"New passwords do not match",color:"red"});return}if(o.newPassword.length<6){c.show({title:"Error",message:"Password must be at least 6 characters long",color:"red"});return}const a=y();if(!a){c.show({title:"Error",message:"User email is missing. Please try logging out and logging back in.",color:"red"});return}try{const l={email:a,oldPassword:o.oldPassword,newPassword:o.newPassword,confirmNewPassword:o.confirmNewPassword};console.log("Password reset data being sent:",l),await B(l),p(!1),u({oldPassword:"",newPassword:"",confirmNewPassword:""})}catch(l){console.error("Password reset failed:",l)}},Y=async()=>{if(v!=="DELETE"){c.show({title:"Error",message:'Please type "DELETE" to confirm account deletion',color:"red"});return}const r=y(),a=J();if(!r){c.show({title:"Error",message:"User email is missing. Please try logging out and logging back in.",color:"red"});return}try{a?await P({email:r,id:a}):await P({email:r,id:""}),c.show({title:"Success",message:"Account deleted successfully. You will be logged out.",color:"green"}),f(!1),g&&n&&n(),setTimeout(async()=>{try{await O()}catch{window.location.href="/login"}},1500)}catch(l){c.show({title:"Error",message:l.message||"Failed to delete account",color:"red"})}};return s.jsx(K,{size:"lg",py:"xl",children:s.jsxs(d,{gap:"xl",children:[s.jsx(V,{p:"xl",radius:"md",withBorder:!0,children:s.jsxs(d,{gap:"xl",children:[s.jsxs(i,{gap:"xl",align:"flex-start",children:[s.jsx(X,{size:"xl",radius:"xl",variant:"filled",children:Z({firstName:e==null?void 0:e.firstName,lastName:e==null?void 0:e.lastName})}),s.jsxs(d,{gap:"xs",style:{flex:1},children:[s.jsx(w,{order:2,fz:28,children:M({firstName:((N=e==null?void 0:e.firstName)==null?void 0:N.charAt(0).toUpperCase())+((E=e==null?void 0:e.firstName)==null?void 0:E.slice(1)),lastName:((C=e==null?void 0:e.lastName)==null?void 0:C.charAt(0).toUpperCase())+((z=e==null?void 0:e.lastName)==null?void 0:z.slice(1))})}),s.jsxs(i,{gap:"md",children:[s.jsx(R,{size:"lg",variant:"filled",color:"blue",children:((I=e==null?void 0:e.role)==null?void 0:I.toUpperCase())||"USER"}),s.jsx(R,{size:"lg",variant:"light",color:"green",children:s.jsxs(i,{gap:"xs",children:[s.jsx(de,{size:16}),s.jsx(t,{children:"Active Account"})]})})]})]})]}),s.jsx(T,{}),s.jsxs(ae,{cols:{base:1,sm:2},spacing:"xl",children:[s.jsxs(d,{gap:"md",children:[s.jsx(w,{order:3,size:"h4",children:"Basic Information"}),s.jsxs(i,{gap:"md",children:[s.jsx($,{size:20,color:"var(--mantine-color-gray-6)"}),s.jsx(t,{size:"sm",fw:500,children:"Full Name:"}),s.jsx(t,{size:"sm",children:M({firstName:((b=e==null?void 0:e.firstName)==null?void 0:b.charAt(0).toUpperCase())+((A=e==null?void 0:e.firstName)==null?void 0:A.slice(1)),lastName:((k=e==null?void 0:e.lastName)==null?void 0:k.charAt(0).toUpperCase())+((D=e==null?void 0:e.lastName)==null?void 0:D.slice(1))})})]}),s.jsxs(i,{gap:"md",children:[s.jsx(re,{size:20,color:"var(--mantine-color-gray-6)"}),s.jsx(t,{size:"sm",fw:500,children:"Email:"}),s.jsx(t,{size:"sm",children:(e==null?void 0:e.email)||"No email provided"})]})]}),s.jsxs(d,{gap:"md",children:[s.jsx(w,{order:3,size:"h4",children:"Contact Information"}),s.jsxs(i,{gap:"md",children:[s.jsx(oe,{size:20,color:"var(--mantine-color-gray-6)"}),s.jsx(t,{size:"sm",fw:500,children:"Phone:"}),s.jsx(t,{size:"sm",children:(e==null?void 0:e.phoneNumber)||"Not provided"})]}),s.jsxs(i,{gap:"md",children:[s.jsx(ie,{size:20,color:"var(--mantine-color-gray-6)"}),s.jsx(t,{size:"sm",fw:500,children:"Address:"}),s.jsx(t,{size:"sm",children:(e==null?void 0:e.address)||"Not provided"})]})]})]}),s.jsx(T,{}),s.jsxs(i,{gap:"md",children:[s.jsx(m,{leftSection:s.jsx(ce,{size:16}),onClick:()=>p(!0),variant:"outline",radius:"md",color:"blue",children:"Reset Password"}),s.jsx(m,{leftSection:s.jsx(te,{size:16}),onClick:()=>f(!0),variant:"outline",color:"red",radius:"md",children:"Delete Account"})]})]})}),s.jsx(S,{opened:G,onClose:()=>p(!1),title:s.jsx(t,{fw:600,children:"Reset Password"}),size:"md",children:s.jsx("form",{onSubmit:Q,children:s.jsxs(d,{gap:"md",children:[s.jsx(x,{radius:"md",label:"Current Password",placeholder:"Enter current password",value:o.oldPassword,onChange:r=>u({...o,oldPassword:r.target.value}),required:!0}),s.jsx(x,{radius:"md",label:"New Password",placeholder:"Enter new password",value:o.newPassword,onChange:r=>u({...o,newPassword:r.target.value}),required:!0}),s.jsx(x,{radius:"md",label:"Confirm New Password",placeholder:"Confirm new password",value:o.confirmNewPassword,onChange:r=>u({...o,confirmNewPassword:r.target.value}),required:!0}),s.jsxs(i,{justify:"flex-end",gap:"md",children:[s.jsx(m,{variant:"outline",onClick:()=>p(!1),radius:"md",children:"Cancel"}),s.jsx(m,{type:"submit",loading:F,radius:"md",children:"Reset Password"})]})]})})}),s.jsx(S,{opened:_,onClose:()=>f(!1),title:"Delete Account",size:"md",radius:"md",children:s.jsxs(d,{gap:"md",children:[s.jsx(le,{p:"xs",icon:s.jsx(ne,{size:16}),title:"Warning",color:"red",variant:"light",children:"This action cannot be undone. All your data will be permanently deleted."}),s.jsxs(t,{size:"sm",c:"dimmed",children:["To confirm deletion, please type ",s.jsx("strong",{children:"DELETE"})," in the field below:"]}),s.jsx(ee,{placeholder:"Type DELETE to confirm",value:v,onChange:r=>W(r.target.value)}),s.jsxs(i,{justify:"flex-end",gap:"md",children:[s.jsx(m,{variant:"filled",radius:"md",onClick:()=>f(!1),children:"Cancel"}),s.jsx(m,{color:"red",radius:"md",variant:"outline",loading:q,onClick:Y,children:"Delete Account"})]})]})})]})})}export{Ee as default};
