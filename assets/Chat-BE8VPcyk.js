import{a3 as U,m as z,n as E,X as F,a8 as G,a9 as L,j as e,aa as D,B as k,ab as H,c as I,G as B,ac as w,b as C,P as S,d as M,ad as A,r as x,J as W,ae as O,a as q,af as K,ag as X,ah as J,ai as Q,u as $,F as Y,aj as V,A as Z,ak as ee,al as se,am as te,an as ae,ao as ne}from"./index-By0p5ZE8.js";import{I as re}from"./Image-EVZ53z0B.js";const oe={gap:{type:"spacing",property:"gap"},rowGap:{type:"spacing",property:"rowGap"},columnGap:{type:"spacing",property:"columnGap"},align:{type:"identity",property:"alignItems"},justify:{type:"identity",property:"justifyContent"},wrap:{type:"identity",property:"flexWrap"},direction:{type:"identity",property:"flexDirection"}};var P={root:"m_8bffd616"};const ie={},g=U((s,t)=>{const a=z("Flex",ie,s),{classNames:r,className:n,style:o,styles:u,unstyled:d,vars:c,gap:v,rowGap:b,columnGap:f,align:i,justify:p,wrap:m,direction:h,...j}=a,T=E({name:"Flex",classes:P,props:a,className:n,style:o,classNames:r,styles:u,unstyled:d,vars:c}),R=F(),_=G(),y=L({styleProps:{gap:v,rowGap:b,columnGap:f,align:i,justify:p,wrap:m,direction:h},theme:R,data:oe});return e.jsxs(e.Fragment,{children:[y.hasResponsiveStyles&&e.jsx(D,{selector:`.${_}`,styles:y.styles,media:y.media}),e.jsx(k,{ref:t,...T("root",{className:_,style:H(y.inlineStyles)}),...j})]})});g.classes=P;g.displayName="@mantine/core/Flex";/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var le=I("outline","robot","IconRobot",[["path",{d:"M6 4m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v4a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z",key:"svg-0"}],["path",{d:"M12 2v2",key:"svg-1"}],["path",{d:"M9 12v9",key:"svg-2"}],["path",{d:"M15 12v9",key:"svg-3"}],["path",{d:"M5 16l4 -2",key:"svg-4"}],["path",{d:"M15 14l4 2",key:"svg-5"}],["path",{d:"M9 18h6",key:"svg-6"}],["path",{d:"M10 8v.01",key:"svg-7"}],["path",{d:"M14 8v.01",key:"svg-8"}]]);/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var ce=I("outline","send","IconSend",[["path",{d:"M10 14l11 -11",key:"svg-0"}],["path",{d:"M21 3l-6.5 18a.55 .55 0 0 1 -1 0l-3.5 -7l-7 -3.5a.55 .55 0 0 1 0 -1l18 -6.5",key:"svg-1"}]]);const pe="_userBubble_kv9dn_1",de="_botBubble_kv9dn_8",ue="_userAvatar_kv9dn_18",me="_botAvatar_kv9dn_24",he="_messageGroup_kv9dn_30",ge="_messageWrapper_kv9dn_36",ye="_timestamp_kv9dn_40",xe="_input_kv9dn_45",ve="_sendButton_kv9dn_65",be="_inputContainer_kv9dn_83",l={userBubble:pe,botBubble:de,userAvatar:ue,botAvatar:me,messageGroup:he,messageWrapper:ge,timestamp:ye,input:xe,sendButton:ve,inputContainer:be};function fe(s){const t=[];let a=0;const r=/<b>(.*?)<\/b>/gi;let n,o=0;for(;(n=r.exec(s))!==null;)n.index>a&&t.push(s.slice(a,n.index)),t.push(e.jsx("b",{children:n[1]},o++)),a=r.lastIndex;return a<s.length&&t.push(s.slice(a)),t}function je({message:s}){return e.jsxs(B,{justify:s.isUser?"flex-end":"flex-start",align:"flex-end",className:l.messageGroup,children:[!s.isUser&&e.jsx(w,{variant:"filled",radius:"xl",size:"md",className:l.botAvatar,children:e.jsx(le,{size:"1.2rem"})}),e.jsxs(C,{gap:4,align:s.isUser?"flex-end":"flex-start",style:{maxWidth:"70%"},children:[e.jsx(k,{className:l.messageWrapper,children:e.jsx(S,{className:s.isUser?l.userBubble:l.botBubble,shadow:"sm",p:"sm",children:e.jsx(M,{size:"sm",style:{whiteSpace:"pre-wrap",wordBreak:"break-word"},children:fe(s.text)})})}),e.jsx(M,{size:"xs",c:"dimmed",className:l.timestamp,children:s.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),s.isUser&&e.jsx(w,{variant:"filled",size:"md",radius:"xl",className:l.userAvatar,children:e.jsx(A,{size:"1.2rem"})})]})}function Se({onSendMessage:s}){const[t,a]=x.useState(""),r=()=>{t.trim()&&(s(t.trim()),a(""))},n=o=>{o.key==="Enter"&&!o.shiftKey&&(o.preventDefault(),r())};return e.jsxs(B,{gap:"xs",className:l.inputContainer,children:[e.jsx(W,{placeholder:"Type a message... (Press Enter to send)",value:t,onChange:o=>a(o.target.value),onKeyDown:n,style:{flex:1},classNames:{input:l.input},size:"md",radius:"xl"}),e.jsx(O,{label:"Send message",position:"top",children:e.jsx(q,{onClick:r,variant:"filled",className:l.sendButton,disabled:!t.trim(),children:e.jsx(ce,{size:18})})})]})}const ke="https://chatbot.majhool.me/api",N=K.create({baseURL:ke,headers:{"Content-Type":"application/json"}});N.interceptors.request.use(s=>{const t=localStorage.getItem("token");return t&&(s.headers.Authorization=`Bearer ${t}`),s},s=>Promise.reject(s));const _e=()=>{const s=X();if(!s)return null;try{const a=s.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),r=decodeURIComponent(atob(a).split("").map(o=>"%"+("00"+o.charCodeAt(0).toString(16)).slice(-2)).join("")),n=JSON.parse(r);return n.nameid||n.userId||n.sub||n.id}catch(t){return console.error("Error decoding token:",t),null}},we={sendMessage:async s=>{try{const a={user_id:_e()||"",message:s};console.log("[chatService] Sending message:",a);const r=await N.post("/chat",a);return console.log("[chatService] Received response:",r.data),r.data}catch(t){throw console.error("Error sending message:",t),t}}};function Me(){const[s,t]=x.useState([]),a=J({mutationFn:async r=>{const n={id:Date.now().toString(),text:r,isUser:!0,timestamp:new Date},o={id:(Date.now()+1).toString(),text:"...",isUser:!1,timestamp:new Date,isTemp:!0};t(d=>[...d,n,o]);const u=await we.sendMessage(r);return t(d=>d.map(c=>c.isTemp&&c.id===o.id?{...c,text:u.reply,isTemp:!1}:c)),{userMessage:n}},onError:r=>{Q.error("Error","Failed to send message"),t(n=>n.filter(o=>!o.isTemp))}});return{messages:s,isLoading:a.isPending,error:a.error,sendMessage:r=>a.mutate(r)}}const Ie="/graduation-front/assets/calendar-illustration-rrQxCqtX.svg";function Ae(){const s=x.useRef(null),t=$(),{user:a,handleLogout:r}=Y(),[n,o]=x.useState(!1),{messages:u,sendMessage:d}=Me(),c=[{label:"Profile",icon:e.jsx(A,{size:20}),onClick:()=>t(te.PROFILE)},{label:"Settings",icon:e.jsx(ae,{size:20}),onClick:()=>{}},{label:"Log Out",icon:e.jsx(ne,{size:20}),onClick:r}],v=(i="smooth")=>{if(s.current){const p=s.current,m=p.scrollHeight,h=p.clientHeight;p.scrollTo({top:m-h,behavior:i})}};V.useEffect(()=>{n||v()},[u,n]);const b=async i=>{i.trim()&&(o(!1),await d(i))},f=({y:i})=>{if(!s.current)return;const p=s.current,m=p.scrollHeight,h=p.clientHeight,j=Math.abs(m-h-i)<1;o(!j)};return e.jsx(Z,{bg:"var(--mantine-color-blue-light)",children:e.jsxs(g,{h:"100vh",gap:"md",p:"md",children:[e.jsxs(S,{w:"70%",radius:"md",bg:"transparent",pos:"relative",children:[e.jsx(k,{pos:"absolute",top:20,left:30,children:e.jsx(ee,{menuItems:c,user:a})}),e.jsx(g,{align:"center",justify:"center",h:"100%",children:e.jsx(re,{src:Ie,alt:"Calendar Illustration",h:600,w:"auto"})})]}),e.jsx(S,{w:500,radius:"lg",shadow:"md",mr:30,bg:"gray.1",pos:"relative",children:e.jsxs(g,{direction:"column",h:"100%",children:[e.jsx(se,{h:"calc(100% - 80px)",viewportRef:s,offsetScrollbars:!0,onScrollPositionChange:f,scrollbarSize:8,type:"hover",children:e.jsx(C,{gap:"md",p:"md",children:u.map(i=>e.jsx(je,{message:i},i.id))})}),e.jsx(Se,{onSendMessage:b})]})})]})})}export{Ae as default};
