import{a4 as R,m as U,n as G,X as E,aa as F,ab as L,j as e,ac as D,B as S,ad as H,c as M,G as I,ae as _,b as B,P as j,d as w,af as C,r as x,J as W,ag as q,a as K,ah as O,ai as X,aj as J,ak as Q,F as $,al as Y,A as V,am as Z,an as ee,ao as se,ap as te}from"./index-B471k5WB.js";import{I as ae}from"./Image-9yC3RX8L.js";const ne={gap:{type:"spacing",property:"gap"},rowGap:{type:"spacing",property:"rowGap"},columnGap:{type:"spacing",property:"columnGap"},align:{type:"identity",property:"alignItems"},justify:{type:"identity",property:"justifyContent"},wrap:{type:"identity",property:"flexWrap"},direction:{type:"identity",property:"flexDirection"}};var A={root:"m_8bffd616"};const re={},g=R((s,t)=>{const a=U("Flex",re,s),{classNames:n,className:r,style:o,styles:u,unstyled:d,vars:c,gap:v,rowGap:b,columnGap:i,align:p,justify:m,wrap:h,direction:f,...N}=a,T=G({name:"Flex",classes:A,props:a,className:r,style:o,classNames:n,styles:u,unstyled:d,vars:c}),z=E(),k=F(),y=L({styleProps:{gap:v,rowGap:b,columnGap:i,align:p,justify:m,wrap:h,direction:f},theme:z,data:ne});return e.jsxs(e.Fragment,{children:[y.hasResponsiveStyles&&e.jsx(D,{selector:`.${k}`,styles:y.styles,media:y.media}),e.jsx(S,{ref:t,...T("root",{className:k,style:H(y.inlineStyles)}),...N})]})});g.classes=A;g.displayName="@mantine/core/Flex";/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var oe=M("outline","robot","IconRobot",[["path",{d:"M6 4m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v4a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z",key:"svg-0"}],["path",{d:"M12 2v2",key:"svg-1"}],["path",{d:"M9 12v9",key:"svg-2"}],["path",{d:"M15 12v9",key:"svg-3"}],["path",{d:"M5 16l4 -2",key:"svg-4"}],["path",{d:"M15 14l4 2",key:"svg-5"}],["path",{d:"M9 18h6",key:"svg-6"}],["path",{d:"M10 8v.01",key:"svg-7"}],["path",{d:"M14 8v.01",key:"svg-8"}]]);/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var ie=M("outline","send","IconSend",[["path",{d:"M10 14l11 -11",key:"svg-0"}],["path",{d:"M21 3l-6.5 18a.55 .55 0 0 1 -1 0l-3.5 -7l-7 -3.5a.55 .55 0 0 1 0 -1l18 -6.5",key:"svg-1"}]]);const le="_userBubble_kv9dn_1",ce="_botBubble_kv9dn_8",pe="_userAvatar_kv9dn_18",de="_botAvatar_kv9dn_24",ue="_messageGroup_kv9dn_30",me="_messageWrapper_kv9dn_36",he="_timestamp_kv9dn_40",ge="_input_kv9dn_45",ye="_sendButton_kv9dn_65",xe="_inputContainer_kv9dn_83",l={userBubble:le,botBubble:ce,userAvatar:pe,botAvatar:de,messageGroup:ue,messageWrapper:me,timestamp:he,input:ge,sendButton:ye,inputContainer:xe};function ve(s){const t=[];let a=0;const n=/<b>(.*?)<\/b>/gi;let r,o=0;for(;(r=n.exec(s))!==null;)r.index>a&&t.push(s.slice(a,r.index)),t.push(e.jsx("b",{children:r[1]},o++)),a=n.lastIndex;return a<s.length&&t.push(s.slice(a)),t}function be({message:s}){return e.jsxs(I,{justify:s.isUser?"flex-end":"flex-start",align:"flex-end",className:l.messageGroup,children:[!s.isUser&&e.jsx(_,{variant:"filled",radius:"xl",size:"md",className:l.botAvatar,children:e.jsx(oe,{size:"1.2rem"})}),e.jsxs(B,{gap:4,align:s.isUser?"flex-end":"flex-start",style:{maxWidth:"70%"},children:[e.jsx(S,{className:l.messageWrapper,children:e.jsx(j,{className:s.isUser?l.userBubble:l.botBubble,shadow:"sm",p:"sm",children:e.jsx(w,{size:"sm",style:{whiteSpace:"pre-wrap",wordBreak:"break-word"},children:ve(s.text)})})}),e.jsx(w,{size:"xs",c:"dimmed",className:l.timestamp,children:s.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),s.isUser&&e.jsx(_,{variant:"filled",size:"md",radius:"xl",className:l.userAvatar,children:e.jsx(C,{size:"1.2rem"})})]})}function fe({onSendMessage:s}){const[t,a]=x.useState(""),n=()=>{t.trim()&&(s(t.trim()),a(""))},r=o=>{o.key==="Enter"&&!o.shiftKey&&(o.preventDefault(),n())};return e.jsxs(I,{gap:"xs",className:l.inputContainer,children:[e.jsx(W,{placeholder:"Type a message... (Press Enter to send)",value:t,onChange:o=>a(o.target.value),onKeyDown:r,style:{flex:1},classNames:{input:l.input},size:"md",radius:"xl"}),e.jsx(q,{label:"Send message",position:"top",children:e.jsx(K,{onClick:n,variant:"filled",className:l.sendButton,disabled:!t.trim(),children:e.jsx(ie,{size:18})})})]})}const je="https://chatbot.majhool.me/api",P=O.create({baseURL:je,headers:{"Content-Type":"application/json"}});P.interceptors.request.use(s=>{const t=localStorage.getItem("token");return t&&(s.headers.Authorization=`Bearer ${t}`),s},s=>Promise.reject(s));const Se=()=>{const s=X();if(!s)return null;try{const a=s.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),n=decodeURIComponent(atob(a).split("").map(o=>"%"+("00"+o.charCodeAt(0).toString(16)).slice(-2)).join("")),r=JSON.parse(n);return r.nameid||r.userId||r.sub||r.id}catch(t){return console.error("Error decoding token:",t),null}},ke={sendMessage:async s=>{try{const a={user_id:Se()||"",message:s};console.log("[chatService] Sending message:",a);const n=await P.post("/chat",a);return console.log("[chatService] Received response:",n.data),n.data}catch(t){throw console.error("Error sending message:",t),t}}};function _e(){const[s,t]=x.useState([]),a=J({mutationFn:async n=>{const r={id:Date.now().toString(),text:n,isUser:!0,timestamp:new Date},o={id:(Date.now()+1).toString(),text:"...",isUser:!1,timestamp:new Date,isTemp:!0};t(d=>[...d,r,o]);const u=await ke.sendMessage(n);return t(d=>d.map(c=>c.isTemp&&c.id===o.id?{...c,text:u.reply,isTemp:!1}:c)),{userMessage:r}},onError:n=>{Q.error("Error","Failed to send message"),t(r=>r.filter(o=>!o.isTemp))}});return{messages:s,isLoading:a.isPending,error:a.error,sendMessage:n=>a.mutate(n)}}const we="/graduation-front/assets/calendar-illustration-rrQxCqtX.svg";function Be(){const s=x.useRef(null),{user:t,handleLogout:a}=$(),[n,r]=x.useState(!1),{messages:o,sendMessage:u}=_e(),d=[{label:"Profile",icon:e.jsx(C,{size:20}),onClick:()=>{}},{label:"Settings",icon:e.jsx(se,{size:20}),onClick:()=>{}},{label:"Log Out",icon:e.jsx(te,{size:20}),onClick:a}],c=(i="smooth")=>{if(s.current){const p=s.current,m=p.scrollHeight,h=p.clientHeight;p.scrollTo({top:m-h,behavior:i})}};Y.useEffect(()=>{n||c()},[o,n]);const v=async i=>{i.trim()&&(r(!1),await u(i))},b=({y:i})=>{if(!s.current)return;const p=s.current,m=p.scrollHeight,h=p.clientHeight,f=Math.abs(m-h-i)<1;r(!f)};return e.jsx(V,{bg:"var(--mantine-color-blue-light)",children:e.jsxs(g,{h:"100vh",gap:"md",p:"md",children:[e.jsxs(j,{w:"70%",radius:"md",bg:"transparent",pos:"relative",children:[e.jsx(S,{pos:"absolute",top:20,left:30,children:e.jsx(Z,{menuItems:d,user:t})}),e.jsx(g,{align:"center",justify:"center",h:"100%",children:e.jsx(ae,{src:we,alt:"Calendar Illustration",h:600,w:"auto"})})]}),e.jsx(j,{w:500,radius:"lg",shadow:"md",mr:30,bg:"gray.1",pos:"relative",children:e.jsxs(g,{direction:"column",h:"100%",children:[e.jsx(ee,{h:"calc(100% - 80px)",viewportRef:s,offsetScrollbars:!0,onScrollPositionChange:b,scrollbarSize:8,type:"hover",children:e.jsx(B,{gap:"md",p:"md",children:o.map(i=>e.jsx(be,{message:i},i.id))})}),e.jsx(fe,{onSendMessage:v})]})})]})})}export{Be as default};
