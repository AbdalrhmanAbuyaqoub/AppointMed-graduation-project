import{p as A,b as P,g as R,w as H,x as L,y as D,j as e,z as W,E as b,F as K,r as x,k as O,H as $,v as I,G as T,S as z,P as w,T as C,J as U,t as q,K as Q,B as X,M as J,N as V,O as Y,Q as Z,s as ee,R as se,U as te,V as ae,W as re,X as ne}from"./index-hZ1qAkO8.js";import{A as N}from"./Avatar-BeLdhHzi.js";const oe={gap:{type:"spacing",property:"gap"},rowGap:{type:"spacing",property:"rowGap"},columnGap:{type:"spacing",property:"columnGap"},align:{type:"identity",property:"alignItems"},justify:{type:"identity",property:"justifyContent"},wrap:{type:"identity",property:"flexWrap"},direction:{type:"identity",property:"flexDirection"}};var E={root:"m_8bffd616"};const ie={},f=A((s,t)=>{const a=P("Flex",ie,s),{classNames:r,className:n,style:o,styles:y,unstyled:d,vars:l,gap:u,rowGap:m,columnGap:i,align:p,justify:g,wrap:h,direction:v,...M}=a,j=R({name:"Flex",classes:E,props:a,className:n,style:o,classNames:r,styles:y,unstyled:d,vars:l}),S=H(),k=L(),_=D({styleProps:{gap:u,rowGap:m,columnGap:i,align:p,justify:g,wrap:h,direction:v},theme:S,data:oe});return e.jsxs(e.Fragment,{children:[_.hasResponsiveStyles&&e.jsx(W,{selector:`.${k}`,styles:_.styles,media:_.media}),e.jsx(b,{ref:t,...j("root",{className:k,style:K(_.inlineStyles)}),...M})]})});f.classes=E;f.displayName="@mantine/core/Flex";var G={root:"m_9e117634"};const le={},ce=O((s,{radius:t,fit:a})=>({root:{"--image-radius":t===void 0?void 0:$(t),"--image-object-fit":a}})),B=A((s,t)=>{const a=P("Image",le,s),{classNames:r,className:n,style:o,styles:y,unstyled:d,vars:l,onError:u,src:m,radius:i,fit:p,fallbackSrc:g,mod:h,...v}=a,[M,j]=x.useState(!m);x.useEffect(()=>j(!m),[m]);const S=R({name:"Image",classes:G,props:a,className:n,style:o,classNames:r,styles:y,unstyled:d,vars:l,varsResolver:ce});return M&&g?e.jsx(b,{component:"img",ref:t,src:g,...S("root"),onError:u,mod:["fallback",h],...v}):e.jsx(b,{component:"img",ref:t,...S("root"),src:m,onError:k=>{u==null||u(k),j(!0)},mod:h,...v})});B.classes=G;B.displayName="@mantine/core/Image";/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var de=I("outline","robot","IconRobot",[["path",{d:"M6 4m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v4a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z",key:"svg-0"}],["path",{d:"M12 2v2",key:"svg-1"}],["path",{d:"M9 12v9",key:"svg-2"}],["path",{d:"M15 12v9",key:"svg-3"}],["path",{d:"M5 16l4 -2",key:"svg-4"}],["path",{d:"M15 14l4 2",key:"svg-5"}],["path",{d:"M9 18h6",key:"svg-6"}],["path",{d:"M10 8v.01",key:"svg-7"}],["path",{d:"M14 8v.01",key:"svg-8"}]]);/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var pe=I("outline","send","IconSend",[["path",{d:"M10 14l11 -11",key:"svg-0"}],["path",{d:"M21 3l-6.5 18a.55 .55 0 0 1 -1 0l-3.5 -7l-7 -3.5a.55 .55 0 0 1 0 -1l18 -6.5",key:"svg-1"}]]);/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var ue=I("outline","settings","IconSettings",[["path",{d:"M10.325 4.317c.426 -1.756 2.924 -1.756 3.35 0a1.724 1.724 0 0 0 2.573 1.066c1.543 -.94 3.31 .826 2.37 2.37a1.724 1.724 0 0 0 1.065 2.572c1.756 .426 1.756 2.924 0 3.35a1.724 1.724 0 0 0 -1.066 2.573c.94 1.543 -.826 3.31 -2.37 2.37a1.724 1.724 0 0 0 -2.572 1.065c-.426 1.756 -2.924 1.756 -3.35 0a1.724 1.724 0 0 0 -2.573 -1.066c-1.543 .94 -3.31 -.826 -2.37 -2.37a1.724 1.724 0 0 0 -1.065 -2.572c-1.756 -.426 -1.756 -2.924 0 -3.35a1.724 1.724 0 0 0 1.066 -2.573c-.94 -1.543 .826 -3.31 2.37 -2.37c1 .608 2.296 .07 2.572 -1.065z",key:"svg-0"}],["path",{d:"M9 12a3 3 0 1 0 6 0a3 3 0 0 0 -6 0",key:"svg-1"}]]);const me="_userBubble_kv9dn_1",ge="_botBubble_kv9dn_8",he="_userAvatar_kv9dn_18",ye="_botAvatar_kv9dn_24",ve="_messageGroup_kv9dn_30",xe="_messageWrapper_kv9dn_36",fe="_timestamp_kv9dn_40",be="_input_kv9dn_45",je="_sendButton_kv9dn_65",Se="_inputContainer_kv9dn_83",c={userBubble:me,botBubble:ge,userAvatar:he,botAvatar:ye,messageGroup:ve,messageWrapper:xe,timestamp:fe,input:be,sendButton:je,inputContainer:Se};function ke(s){const t=[];let a=0;const r=/<b>(.*?)<\/b>/gi;let n,o=0;for(;(n=r.exec(s))!==null;)n.index>a&&t.push(s.slice(a,n.index)),t.push(e.jsx("b",{children:n[1]},o++)),a=r.lastIndex;return a<s.length&&t.push(s.slice(a)),t}function _e({message:s}){return e.jsxs(T,{justify:s.isUser?"flex-end":"flex-start",align:"flex-end",className:c.messageGroup,children:[!s.isUser&&e.jsx(N,{variant:"filled",radius:"xl",size:"md",className:c.botAvatar,children:e.jsx(de,{size:"1.2rem"})}),e.jsxs(z,{gap:4,align:s.isUser?"flex-end":"flex-start",style:{maxWidth:"70%"},children:[e.jsx(b,{className:c.messageWrapper,children:e.jsx(w,{className:s.isUser?c.userBubble:c.botBubble,shadow:"sm",p:"sm",children:e.jsx(C,{size:"sm",style:{whiteSpace:"pre-wrap",wordBreak:"break-word"},children:ke(s.text)})})}),e.jsx(C,{size:"xs",c:"dimmed",className:c.timestamp,children:s.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),s.isUser&&e.jsx(N,{variant:"filled",size:"md",radius:"xl",className:c.userAvatar,children:e.jsx(U,{size:"1.2rem"})})]})}function Me({onSendMessage:s}){const[t,a]=x.useState(""),r=()=>{t.trim()&&(s(t.trim()),a(""))},n=o=>{o.key==="Enter"&&!o.shiftKey&&(o.preventDefault(),r())};return e.jsxs(T,{gap:"xs",className:c.inputContainer,children:[e.jsx(q,{placeholder:"Type a message... (Press Enter to send)",value:t,onChange:o=>a(o.target.value),onKeyDown:n,style:{flex:1},classNames:{input:c.input},size:"md",radius:"xl"}),e.jsx(Q,{label:"Send message",position:"top",children:e.jsx(X,{onClick:r,variant:"filled",className:c.sendButton,disabled:!t.trim(),children:e.jsx(pe,{size:18})})})]})}const we="https://chatbot.majhool.me/api",F=J.create({baseURL:we,headers:{"Content-Type":"application/json"}});F.interceptors.request.use(s=>{const t=localStorage.getItem("token");return t&&(s.headers.Authorization=`Bearer ${t}`),s},s=>Promise.reject(s));const Ie=()=>{const s=V();if(!s)return null;try{const a=s.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),r=decodeURIComponent(atob(a).split("").map(o=>"%"+("00"+o.charCodeAt(0).toString(16)).slice(-2)).join("")),n=JSON.parse(r);return n.nameid||n.userId||n.sub||n.id}catch(t){return console.error("Error decoding token:",t),null}},Be={sendMessage:async s=>{try{const a={user_id:Ie()||"",message:s};console.log("[chatService] Sending message:",a);const r=await F.post("/chat",a);return console.log("[chatService] Received response:",r.data),r.data}catch(t){throw console.error("Error sending message:",t),t}}};function Ce(){const[s,t]=x.useState([]),a=Y({mutationFn:async r=>{const n={id:Date.now().toString(),text:r,isUser:!0,timestamp:new Date},o={id:(Date.now()+1).toString(),text:"...",isUser:!1,timestamp:new Date,isTemp:!0};t(d=>[...d,n,o]);const y=await Be.sendMessage(r);return t(d=>d.map(l=>l.isTemp&&l.id===o.id?{...l,text:y.reply,isTemp:!1}:l)),{userMessage:n}},onError:r=>{Z.error("Error","Failed to send message"),t(n=>n.filter(o=>!o.isTemp))}});return{messages:s,isLoading:a.isPending,error:a.error,sendMessage:r=>a.mutate(r)}}const Ne="/graduation-front/assets/calendar-illustration-rrQxCqtX.svg";function Re(){const s=x.useRef(null),{user:t,handleLogout:a}=ee(),[r,n]=x.useState(!1),{messages:o,sendMessage:y}=Ce(),d=[{label:"Profile",icon:e.jsx(U,{size:14}),onClick:()=>{}},{label:"Settings",icon:e.jsx(ue,{size:14}),onClick:()=>{}},{label:"Log Out",icon:e.jsx(ne,{size:14}),onClick:a,color:"red"}],l=(i="smooth")=>{if(s.current){const p=s.current,g=p.scrollHeight,h=p.clientHeight;p.scrollTo({top:g-h,behavior:i})}};se.useEffect(()=>{r||l()},[o,r]);const u=async i=>{i.trim()&&(n(!1),await y(i))},m=({y:i})=>{if(!s.current)return;const p=s.current,g=p.scrollHeight,h=p.clientHeight,v=Math.abs(g-h-i)<1;n(!v)};return e.jsx(te,{bg:"var(--mantine-color-blue-light)",children:e.jsxs(f,{h:"100vh",gap:"md",p:"md",children:[e.jsxs(w,{w:"70%",radius:"md",bg:"transparent",pos:"relative",children:[e.jsx(b,{pos:"absolute",top:20,left:30,children:e.jsx(ae,{userRole:(t==null?void 0:t.role)||"user",menuItems:d})}),e.jsx(f,{align:"center",justify:"center",h:"100%",children:e.jsx(B,{src:Ne,alt:"Calendar Illustration",h:600,w:"auto"})})]}),e.jsx(w,{w:500,radius:"lg",shadow:"md",mr:30,bg:"gray.1",pos:"relative",children:e.jsxs(f,{direction:"column",h:"100%",children:[e.jsx(re,{h:"calc(100% - 80px)",viewportRef:s,offsetScrollbars:!0,onScrollPositionChange:m,scrollbarSize:8,type:"hover",children:e.jsx(z,{gap:"md",p:"md",children:o.map(i=>e.jsx(_e,{message:i},i.id))})}),e.jsx(Me,{onSendMessage:u})]})})]})})}export{Re as default};
