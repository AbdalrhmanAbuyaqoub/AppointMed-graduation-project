import{b as e,z as s,r,j as l,C as i,f as a,P as o,G as n,a3 as d,a4 as t,aP as c,T as u,ab as m,e as h,an as g,D as j,E as p,aM as v}from"./index-DbEKal5d.js";import{u as x}from"./useUserQueries-BTFbrwAF.js";import{T as w}from"./Title-CFcNY-rT.js";import{B as f}from"./Badge-BIiM0XzC.js";import{D as P}from"./Divider-DZ5C-WQo.js";import{S as y}from"./SimpleGrid-DgTM9OXm.js";import{I as N}from"./IconMail-AMInNEQ-.js";import{a as z,I as C}from"./IconTrash-Be9yDEeN.js";import{I as E}from"./IconMapPin-BJg9m87-.js";import{P as b,A as k}from"./PasswordInput-M2LdtY_Q.js";import"./useQuery-DzRLwVkj.js";import"./useMutation-CdDHAm4w.js";import"./get-base-value-D7dq2aJJ.js";import"./ActionIcon-LAepEItE.js";
/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var A=e("outline","alert-triangle","IconAlertTriangle",[["path",{d:"M12 9v4",key:"svg-0"}],["path",{d:"M10.363 3.591l-8.106 13.534a1.914 1.914 0 0 0 1.636 2.871h16.214a1.914 1.914 0 0 0 1.636 -2.87l-8.106 -13.536a1.914 1.914 0 0 0 -3.274 0z",key:"svg-1"}],["path",{d:"M12 16h.01",key:"svg-2"}]]),I=e("outline","circle-check","IconCircleCheck",[["path",{d:"M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0",key:"svg-0"}],["path",{d:"M9 12l2 2l4 -4",key:"svg-1"}]]),T=e("outline","lock","IconLock",[["path",{d:"M5 13a2 2 0 0 1 2 -2h10a2 2 0 0 1 2 2v6a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2v-6z",key:"svg-0"}],["path",{d:"M11 16a1 1 0 1 0 2 0a1 1 0 0 0 -2 0",key:"svg-1"}],["path",{d:"M8 11v-4a4 4 0 1 1 8 0v4",key:"svg-2"}]]);
/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const M=e=>{try{if(!e)return null;const s=e.split(".");if(3!==s.length)return null;return JSON.parse(atob(s[1]))}catch(s){return null}};function D({isModal:e=!1,onClose:D}){var S,U,L,R,q,B,F,_,G;const{user:J,handleLogout:Q}=s(),{resetPasswordWithToken:W,deleteAccount:H,isResettingPassword:O,isDeletingAccount:Y}=x();r.useEffect(()=>{},[J]);const[K,V]=r.useState(!1),[X,Z]=r.useState(!1),[$,ee]=r.useState({oldPassword:"",newPassword:"",confirmNewPassword:""}),[se,re]=r.useState(""),le=()=>{if(null==J?void 0:J.email)return J.email;const e=v(),s=M(e);return(null==s?void 0:s.email)||(null==s?void 0:s.unique_name)};return l.jsx(i,{size:"lg",py:"xl",children:l.jsxs(a,{gap:"xl",children:[l.jsx(o,{p:"xl",radius:"md",withBorder:!0,children:l.jsxs(a,{gap:"xl",children:[l.jsxs(n,{gap:"xl",align:"flex-start",children:[l.jsx(d,{size:"xl",radius:"xl",variant:"filled",children:t({firstName:null==J?void 0:J.firstName,lastName:null==J?void 0:J.lastName})}),l.jsxs(a,{gap:"xs",style:{flex:1},children:[l.jsx(w,{order:2,fz:28,children:c({firstName:(null==(S=null==J?void 0:J.firstName)?void 0:S.charAt(0).toUpperCase())+(null==(U=null==J?void 0:J.firstName)?void 0:U.slice(1)),lastName:(null==(L=null==J?void 0:J.lastName)?void 0:L.charAt(0).toUpperCase())+(null==(R=null==J?void 0:J.lastName)?void 0:R.slice(1))})}),l.jsxs(n,{gap:"md",children:[l.jsx(f,{size:"lg",variant:"filled",color:"blue",children:(null==(q=null==J?void 0:J.role)?void 0:q.toUpperCase())||"USER"}),l.jsx(f,{size:"lg",variant:"light",color:"green",children:l.jsxs(n,{gap:"xs",children:[l.jsx(I,{size:16}),l.jsx(u,{children:"Active Account"})]})})]})]})]}),l.jsx(P,{}),l.jsxs(y,{cols:{base:1,sm:2},spacing:"xl",children:[l.jsxs(a,{gap:"md",children:[l.jsx(w,{order:3,size:"h4",children:"Basic Information"}),l.jsxs(n,{gap:"md",children:[l.jsx(m,{size:20,color:"var(--mantine-color-gray-6)"}),l.jsx(u,{size:"sm",fw:500,children:"Full Name:"}),l.jsx(u,{size:"sm",children:c({firstName:(null==(B=null==J?void 0:J.firstName)?void 0:B.charAt(0).toUpperCase())+(null==(F=null==J?void 0:J.firstName)?void 0:F.slice(1)),lastName:(null==(_=null==J?void 0:J.lastName)?void 0:_.charAt(0).toUpperCase())+(null==(G=null==J?void 0:J.lastName)?void 0:G.slice(1))})})]}),l.jsxs(n,{gap:"md",children:[l.jsx(N,{size:20,color:"var(--mantine-color-gray-6)"}),l.jsx(u,{size:"sm",fw:500,children:"Email:"}),l.jsx(u,{size:"sm",children:(null==J?void 0:J.email)||"No email provided"})]})]}),l.jsxs(a,{gap:"md",children:[l.jsx(w,{order:3,size:"h4",children:"Contact Information"}),l.jsxs(n,{gap:"md",children:[l.jsx(z,{size:20,color:"var(--mantine-color-gray-6)"}),l.jsx(u,{size:"sm",fw:500,children:"Phone:"}),l.jsx(u,{size:"sm",children:(null==J?void 0:J.phoneNumber)||"Not provided"})]}),l.jsxs(n,{gap:"md",children:[l.jsx(E,{size:20,color:"var(--mantine-color-gray-6)"}),l.jsx(u,{size:"sm",fw:500,children:"Address:"}),l.jsx(u,{size:"sm",children:(null==J?void 0:J.address)||"Not provided"})]})]})]}),l.jsx(P,{}),l.jsxs(n,{gap:"md",children:[l.jsx(h,{leftSection:l.jsx(T,{size:16}),onClick:()=>V(!0),variant:"outline",radius:"md",color:"blue",children:"Reset Password"}),l.jsx(h,{leftSection:l.jsx(C,{size:16}),onClick:()=>Z(!0),variant:"outline",color:"red",radius:"md",children:"Delete Account"})]})]})}),l.jsx(g,{opened:K,onClose:()=>V(!1),title:l.jsx(u,{fw:600,children:"Reset Password"}),size:"md",children:l.jsx("form",{onSubmit:async e=>{if(e.preventDefault(),$.newPassword!==$.confirmNewPassword)return void p.show({title:"Error",message:"New passwords do not match",color:"red"});if($.newPassword.length<6)return void p.show({title:"Error",message:"Password must be at least 6 characters long",color:"red"});const s=le();if(s)try{const e={email:s,oldPassword:$.oldPassword,newPassword:$.newPassword,confirmNewPassword:$.confirmNewPassword};await W(e),V(!1),ee({oldPassword:"",newPassword:"",confirmNewPassword:""})}catch(r){}else p.show({title:"Error",message:"User email is missing. Please try logging out and logging back in.",color:"red"})},children:l.jsxs(a,{gap:"md",children:[l.jsx(b,{radius:"md",label:"Current Password",placeholder:"Enter current password",value:$.oldPassword,onChange:e=>ee({...$,oldPassword:e.target.value}),required:!0}),l.jsx(b,{radius:"md",label:"New Password",placeholder:"Enter new password",value:$.newPassword,onChange:e=>ee({...$,newPassword:e.target.value}),required:!0}),l.jsx(b,{radius:"md",label:"Confirm New Password",placeholder:"Confirm new password",value:$.confirmNewPassword,onChange:e=>ee({...$,confirmNewPassword:e.target.value}),required:!0}),l.jsxs(n,{justify:"flex-end",gap:"md",children:[l.jsx(h,{variant:"outline",onClick:()=>V(!1),radius:"md",children:"Cancel"}),l.jsx(h,{type:"submit",loading:O,radius:"md",children:"Reset Password"})]})]})})}),l.jsx(g,{opened:X,onClose:()=>Z(!1),title:"Delete Account",size:"md",radius:"md",children:l.jsxs(a,{gap:"md",children:[l.jsx(k,{p:"xs",icon:l.jsx(A,{size:16}),title:"Warning",color:"red",variant:"light",children:"This action cannot be undone. All your data will be permanently deleted."}),l.jsxs(u,{size:"sm",c:"dimmed",children:["To confirm deletion, please type ",l.jsx("strong",{children:"DELETE"})," in the field below:"]}),l.jsx(j,{placeholder:"Type DELETE to confirm",value:se,onChange:e=>re(e.target.value)}),l.jsxs(n,{justify:"flex-end",gap:"md",children:[l.jsx(h,{variant:"filled",radius:"md",onClick:()=>Z(!1),children:"Cancel"}),l.jsx(h,{color:"red",radius:"md",variant:"outline",loading:Y,onClick:async()=>{if("DELETE"!==se)return void p.show({title:"Error",message:'Please type "DELETE" to confirm account deletion',color:"red"});const s=le(),r=(()=>{if(null==J?void 0:J.id)return J.id;if(null==J?void 0:J.userId)return J.userId;if(null==J?void 0:J.user_id)return J.user_id;const e=v(),s=M(e);return(null==s?void 0:s.nameid)||(null==s?void 0:s.userId)||(null==s?void 0:s.sub)||(null==s?void 0:s.id)})();if(s)try{r?await H({email:s,id:r}):await H({email:s,id:""}),p.show({title:"Success",message:"Account deleted successfully. You will be logged out.",color:"green"}),Z(!1),e&&D&&D(),setTimeout(async()=>{try{await Q()}catch(e){window.location.href="/login"}},1500)}catch(l){p.show({title:"Error",message:l.message||"Failed to delete account",color:"red"})}else p.show({title:"Error",message:"User email is missing. Please try logging out and logging back in.",color:"red"})},children:"Delete Account"})]})]})})]})})}export{D as default};
