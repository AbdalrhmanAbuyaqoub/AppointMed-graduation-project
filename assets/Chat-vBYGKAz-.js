import{a3 as G,m as L,n as z,X as F,a8 as H,a9 as D,j as e,aa as W,B as A,ab as K,c as k,G as N,ac as w,b as O,P as C,d as j,ad as B,r as d,J as X,ae as Y,a as $,af as U,ag as R,ah as b,u as Q,F as q,ai as _,A as J,aj as V,N as Z,ak as ee,al as se,am as te,an as oe}from"./index-BvZYOKgn.js";import{I as ae}from"./Image-M8F3CtJ3.js";const ne={gap:{type:"spacing",property:"gap"},rowGap:{type:"spacing",property:"rowGap"},columnGap:{type:"spacing",property:"columnGap"},align:{type:"identity",property:"alignItems"},justify:{type:"identity",property:"justifyContent"},wrap:{type:"identity",property:"flexWrap"},direction:{type:"identity",property:"flexDirection"}};var P={root:"m_8bffd616"};const re={},M=G((s,t)=>{const r=L("Flex",re,s),{classNames:g,className:o,style:l,styles:c,unstyled:v,vars:y,gap:S,rowGap:p,columnGap:T,align:E,justify:x,wrap:a,direction:n,...i}=r,h=z({name:"Flex",classes:P,props:r,className:o,style:l,classNames:g,styles:c,unstyled:v,vars:y}),I=F(),f=H(),u=D({styleProps:{gap:S,rowGap:p,columnGap:T,align:E,justify:x,wrap:a,direction:n},theme:I,data:ne});return e.jsxs(e.Fragment,{children:[u.hasResponsiveStyles&&e.jsx(W,{selector:`.${f}`,styles:u.styles,media:u.media}),e.jsx(A,{ref:t,...h("root",{className:f,style:K(u.inlineStyles)}),...i})]})});M.classes=P;M.displayName="@mantine/core/Flex";/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var le=k("outline","robot","IconRobot",[["path",{d:"M6 4m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v4a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z",key:"svg-0"}],["path",{d:"M12 2v2",key:"svg-1"}],["path",{d:"M9 12v9",key:"svg-2"}],["path",{d:"M15 12v9",key:"svg-3"}],["path",{d:"M5 16l4 -2",key:"svg-4"}],["path",{d:"M15 14l4 2",key:"svg-5"}],["path",{d:"M9 18h6",key:"svg-6"}],["path",{d:"M10 8v.01",key:"svg-7"}],["path",{d:"M14 8v.01",key:"svg-8"}]]);/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var ie=k("outline","send","IconSend",[["path",{d:"M10 14l11 -11",key:"svg-0"}],["path",{d:"M21 3l-6.5 18a.55 .55 0 0 1 -1 0l-3.5 -7l-7 -3.5a.55 .55 0 0 1 0 -1l18 -6.5",key:"svg-1"}]]);const ce="_userBubble_kv9dn_1",ue="_botBubble_kv9dn_8",ge="_userAvatar_kv9dn_18",de="_botAvatar_kv9dn_24",me="_messageGroup_kv9dn_30",pe="_messageWrapper_kv9dn_36",he="_timestamp_kv9dn_40",fe="_input_kv9dn_45",ye="_sendButton_kv9dn_65",Te="_inputContainer_kv9dn_83",m={userBubble:ce,botBubble:ue,userAvatar:ge,botAvatar:de,messageGroup:me,messageWrapper:pe,timestamp:he,input:fe,sendButton:ye,inputContainer:Te};function Ee(s){const t=[];let r=0;const g=/<b>(.*?)<\/b>/gi;let o,l=0;for(;(o=g.exec(s))!==null;)o.index>r&&t.push(s.slice(r,o.index)),t.push(e.jsx("b",{children:o[1]},l++)),r=g.lastIndex;return r<s.length&&t.push(s.slice(r)),t}function Ie({message:s}){return e.jsxs(N,{justify:s.isUser?"flex-end":"flex-start",align:"flex-end",className:m.messageGroup,children:[!s.isUser&&e.jsx(w,{variant:"filled",radius:"xl",size:"md",className:m.botAvatar,children:e.jsx(le,{size:"1.2rem"})}),e.jsxs(O,{gap:4,align:s.isUser?"flex-end":"flex-start",style:{maxWidth:"70%"},children:[e.jsx(A,{className:m.messageWrapper,children:e.jsx(C,{className:s.isUser?m.userBubble:m.botBubble,shadow:"sm",p:"sm",children:e.jsx(j,{size:"sm",style:{whiteSpace:"pre-wrap",wordBreak:"break-word"},children:Ee(s.text)})})}),e.jsx(j,{size:"xs",c:"dimmed",className:m.timestamp,children:s.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),s.isUser&&e.jsx(w,{variant:"filled",size:"md",radius:"xl",className:m.userAvatar,children:e.jsx(B,{size:"1.2rem"})})]})}function ve({onSendMessage:s}){const[t,r]=d.useState(""),g=()=>{t.trim()&&(s(t.trim()),r(""))},o=l=>{l.key==="Enter"&&!l.shiftKey&&(l.preventDefault(),g())};return e.jsxs(N,{gap:"xs",className:m.inputContainer,children:[e.jsx(X,{placeholder:"Type a message... (Press Enter to send)",value:t,onChange:l=>r(l.target.value),onKeyDown:o,style:{flex:1},classNames:{input:m.input},size:"md",radius:"xl"}),e.jsx(Y,{label:"Send message",position:"top",children:e.jsx($,{onClick:g,variant:"filled",className:m.sendButton,disabled:!t.trim(),children:e.jsx(ie,{size:18})})})]})}function xe(){const[s,t]=d.useState([]),[r,g]=d.useState(!1),[o,l]=d.useState(!1),c=d.useRef(null),v=1*60*1e3,y={id:"welcome-message",text:"Hello! ðŸ‘‹ I'm Samera your AI assistant. I'm here to help you to Book Your appointment. How can I help you today?",isUser:!1,timestamp:new Date},S={id:`timeout-${Date.now()}`,text:"â° Your session has ended due to inactivity. Please send a new message to start again.",isUser:!1,timestamp:new Date},p=(a=!1)=>{if(console.log("[TIMEOUT] startTimeout called - hasUserInteracted:",o,"forceStart:",a),!o&&!a){console.log("[TIMEOUT] Not starting timeout - user hasn't interacted yet and not forced");return}c.current&&(console.log("[TIMEOUT] Clearing existing timeout"),clearTimeout(c.current)),console.log("[TIMEOUT] Starting new timeout - duration:",v/1e3,"seconds"),c.current=setTimeout(async()=>{console.log("[TIMEOUT] â° Chat session timeout triggered!");try{console.log("[TIMEOUT] Attempting to clear backend chat..."),await b.clearChat(),console.log("[TIMEOUT] âœ… Backend chat cleared successfully on timeout")}catch(n){console.warn("[TIMEOUT] âŒ Failed to clear backend chat on timeout:",n)}console.log("[TIMEOUT] Adding timeout message to conversation"),t(n=>{const i=[...n,{...S,id:`timeout-${Date.now()}`}];return console.log("[TIMEOUT] New message count after timeout:",i.length),i}),console.log("[TIMEOUT] Resetting hasUserInteracted flag to false"),l(!1),console.log("[TIMEOUT] Session timeout processing complete")},v),console.log("[TIMEOUT] Timeout set with ID:",c.current)},T=()=>{c.current?(console.log("[TIMEOUT] Clearing timeout with ID:",c.current),clearTimeout(c.current),c.current=null,console.log("[TIMEOUT] Timeout cleared and reset to null")):console.log("[TIMEOUT] No active timeout to clear")};d.useEffect(()=>{r||(console.log("[CHAT] Initializing chat with welcome message"),t([y]),g(!0),console.log("[CHAT] Chat initialized - NOT starting timeout (waiting for user interaction)"))},[r]),d.useEffect(()=>()=>{console.log("[CHAT] Component unmounting - cleaning up timeout"),T()},[]),d.useEffect(()=>{console.log("[USER_INTERACTION] hasUserInteracted changed to:",o)},[o]);const E=U({mutationFn:async a=>{console.log("[MESSAGE] User sending message:",a),!o?(console.log("[USER_INTERACTION] ðŸŽ¯ First user interaction detected!"),l(!0),console.log("[USER_INTERACTION] Setting hasUserInteracted to true"),p(!0)):(console.log("[USER_INTERACTION] User interaction (timeout will restart)"),p());const i={id:Date.now().toString(),text:a,isUser:!0,timestamp:new Date},h={id:(Date.now()+1).toString(),text:"...",isUser:!1,timestamp:new Date,isTemp:!0};console.log("[MESSAGE] Adding user message and temp bot message to conversation"),t(f=>{const u=[...f,i,h];return console.log("[MESSAGE] Message count after adding user message:",u.length),u}),console.log("[API] Sending message to chatbot API...");const I=await b.sendMessage(a);return console.log("[API] Received response from chatbot API"),console.log("[MESSAGE] Replacing temp message with bot response"),t(f=>f.map(u=>u.isTemp&&u.id===h.id?{...u,text:I.reply,isTemp:!1}:u)),console.log("[TIMEOUT] Restarting timeout after receiving bot response"),p(),console.log("[MESSAGE] Message send process completed successfully"),{userMessage:i}},onError:a=>{console.error("[MESSAGE] âŒ Error sending message:",a),R.error("Error","Failed to send message"),console.log("[MESSAGE] Removing temp bot message due to error"),t(n=>n.filter(i=>!i.isTemp)),o?(console.log("[TIMEOUT] Restarting timeout after message error (user has interacted)"),p()):console.log("[TIMEOUT] Not restarting timeout after error (user hasn't interacted)")}}),x=U({mutationFn:async()=>{console.log("[CLEAR] Manual chat clear initiated"),console.log("[CLEAR] Clearing timeout before chat clear"),T(),console.log("[CLEAR] Resetting hasUserInteracted to false"),l(!1),console.log("[CLEAR] Calling API to clear backend chat...");const a=await b.clearChat();return console.log("[CLEAR] Backend chat cleared successfully"),console.log("[CLEAR] Clearing local messages and resetting with welcome message"),t([y]),console.log("[CLEAR] Manual chat clear completed - NOT starting timeout (waiting for user interaction)"),a},onSuccess:()=>{console.log("[CLEAR] âœ… Chat cleared successfully")},onError:a=>{console.error("[CLEAR] âŒ Error clearing chat:",a),R.error("Error","Failed to clear chat"),console.log("[CLEAR] Not restarting timeout due to clear error")}});return d.useEffect(()=>{console.log("[MESSAGES] Message count changed to:",s.length),s.length>0&&console.log("[MESSAGES] Latest message:",s[s.length-1])},[s]),{messages:s,isLoading:E.isPending,error:E.error,sendMessage:a=>E.mutate(a),clearChat:()=>x.mutate(),isClearingChat:x.isPending,startTimeout:p,clearChatTimeout:T}}const Se="/graduation-front/assets/calendar-illustration-rrQxCqtX.svg";function Ce(){const s=d.useRef(null),t=Q(),{user:r,handleLogout:g}=q(),[o,l]=d.useState(!1),{messages:c,sendMessage:v,clearChat:y,isClearingChat:S}=xe();_.useEffect(()=>()=>{y()},[]);const p=async()=>{await y(),g()},T=[{label:"Profile",icon:e.jsx(B,{size:20}),onClick:()=>t(se.PROFILE)},{label:"Settings",icon:e.jsx(te,{size:20}),onClick:()=>{}},{label:"Log Out",icon:e.jsx(oe,{size:20}),onClick:p}],E=(n="smooth")=>{if(s.current){const i=s.current,h=i.scrollHeight,I=i.clientHeight;i.scrollTo({top:h-I,behavior:n})}};_.useEffect(()=>{o||E()},[c,o]);const x=async n=>{n.trim()&&(l(!1),await v(n))},a=({y:n})=>{if(!s.current)return;const i=s.current,h=i.scrollHeight,I=i.clientHeight,f=Math.abs(h-I-n)<1;l(!f)};return e.jsx(J,{bg:"var(--mantine-color-blue-light)",children:e.jsxs(M,{h:"100vh",gap:"md",p:"md",children:[e.jsxs(C,{w:"70%",radius:"md",bg:"transparent",pos:"relative",children:[e.jsx(A,{pos:"absolute",top:20,left:30,children:e.jsx(V,{menuItems:T,user:r})}),e.jsx(M,{align:"center",justify:"center",h:"100%",children:e.jsx(ae,{src:Se,alt:"Calendar Illustration",h:600,w:"auto"})})]}),e.jsxs(C,{w:500,radius:"lg",shadow:"md",mr:30,bg:"gray.1",pos:"relative",children:[e.jsx(Z,{visible:S}),e.jsxs(M,{direction:"column",h:"100%",children:[e.jsx(ee,{h:"calc(100% - 80px)",viewportRef:s,offsetScrollbars:!0,onScrollPositionChange:a,scrollbarSize:8,type:"hover",children:e.jsx(O,{gap:"md",p:"md",children:c.map(n=>e.jsx(Ie,{message:n},n.id))})}),e.jsx(ve,{onSendMessage:x})]})]})]})})}export{Ce as default};
