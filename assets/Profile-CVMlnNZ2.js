import{j as e,C as K,S as d,P as Y,G as n,m as $,Y as f,K as b,T as i,D as A,a9 as J,F as m,W as D,ac as p,aa as Q,o as H}from"./ui-60GCj8Dw.js";import{r as h}from"./router-DP3ythCP.js";import{u as V,n as c,i as U}from"./chat-CG0hw1Kq.js";import{f as X}from"./appointments-B_6-NBdq.js";import{K as Z,I as ee,s as se,h as re,t as ae,L as oe,n as te,M as ie}from"./icons-BQympANv.js";import"./vendor-DJG_os-6.js";import"./query-D3UiA-xa.js";const S=u=>{try{if(!u)return null;const l=u.split(".");if(l.length!==3)return null;const s=JSON.parse(atob(l[1]));return console.log("Decoded token payload:",s),s}catch(l){return console.error("Error decoding token:",l),null}};function ge({isModal:u=!1,onClose:l}){var C,y,z,I,N;const{user:s,handleLogout:M}=V(),{resetPasswordWithToken:L,deleteAccount:j,isResettingPassword:R,isDeletingAccount:T}=X();h.useEffect(()=>{},[s]);const[k,g]=h.useState(!1),[F,w]=h.useState(!1),[o,x]=h.useState({oldPassword:"",newPassword:"",confirmNewPassword:""}),[P,O]=h.useState(""),q=()=>{if(s!=null&&s.id)return s.id;if(s!=null&&s.userId)return s.userId;if(s!=null&&s.user_id)return s.user_id;const a=U(),r=S(a);return(r==null?void 0:r.nameid)||(r==null?void 0:r.userId)||(r==null?void 0:r.sub)||(r==null?void 0:r.id)},E=()=>{if(s!=null&&s.email)return s.email;const a=U(),r=S(a);return(r==null?void 0:r.email)||(r==null?void 0:r.unique_name)},B=async a=>{if(a.preventDefault(),o.newPassword!==o.confirmNewPassword){c.show({title:"Error",message:"New passwords do not match",color:"red"});return}if(o.newPassword.length<6){c.show({title:"Error",message:"Password must be at least 6 characters long",color:"red"});return}const r=E();if(!r){c.show({title:"Error",message:"User email is missing. Please try logging out and logging back in.",color:"red"});return}try{const t={email:r,oldPassword:o.oldPassword,newPassword:o.newPassword,confirmNewPassword:o.confirmNewPassword};console.log("Password reset data being sent:",t),await L(t),g(!1),x({oldPassword:"",newPassword:"",confirmNewPassword:""})}catch(t){console.error("Password reset failed:",t)}},G=async()=>{if(P!=="DELETE"){c.show({title:"Error",message:'Please type "DELETE" to confirm account deletion',color:"red"});return}const a=E(),r=q();if(!a){c.show({title:"Error",message:"User email is missing. Please try logging out and logging back in.",color:"red"});return}try{r?await j({email:a,id:r}):await j({email:a,id:""}),c.show({title:"Success",message:"Account deleted successfully. You will be logged out.",color:"green"}),w(!1),u&&l&&l(),setTimeout(async()=>{try{await M()}catch{window.location.href="/login"}},1500)}catch(t){c.show({title:"Error",message:t.message||"Failed to delete account",color:"red"})}},W=(a,r)=>{if(!a&&!r)return"U";const t=a?a.charAt(0).toUpperCase():"",_=r?r.charAt(0).toUpperCase():"";return t+_},v=(a,r)=>!a&&!r?"User":`${a||""} ${r||""}`.trim();return e.jsx(K,{size:"lg",py:"xl",children:e.jsxs(d,{gap:"xl",children:[e.jsx(Y,{p:"xl",radius:"md",withBorder:!0,children:e.jsxs(d,{gap:"xl",children:[e.jsxs(n,{gap:"xl",align:"flex-start",children:[e.jsx($,{size:"xl",radius:"xl",variant:"filled",children:W(s==null?void 0:s.firstName,s==null?void 0:s.lastName)}),e.jsxs(d,{gap:"xs",style:{flex:1},children:[e.jsx(f,{order:2,fz:28,children:v(((C=s==null?void 0:s.firstName)==null?void 0:C.charAt(0).toUpperCase())+((y=s==null?void 0:s.firstName)==null?void 0:y.slice(1)),((z=s==null?void 0:s.lastName)==null?void 0:z.charAt(0).toUpperCase())+((I=s==null?void 0:s.lastName)==null?void 0:I.slice(1)))}),e.jsxs(n,{gap:"md",children:[e.jsx(b,{size:"lg",variant:"filled",color:"blue",children:((N=s==null?void 0:s.role)==null?void 0:N.toUpperCase())||"USER"}),e.jsx(b,{size:"lg",variant:"light",color:"green",children:e.jsxs(n,{gap:"xs",children:[e.jsx(Z,{size:16}),e.jsx(i,{children:"Active Account"})]})})]})]})]}),e.jsx(A,{}),e.jsxs(J,{cols:{base:1,sm:2},spacing:"xl",children:[e.jsxs(d,{gap:"md",children:[e.jsx(f,{order:3,size:"h4",children:"Basic Information"}),e.jsxs(n,{gap:"md",children:[e.jsx(ee,{size:20,color:"var(--mantine-color-gray-6)"}),e.jsx(i,{size:"sm",fw:500,children:"Full Name:"}),e.jsx(i,{size:"sm",children:v(s==null?void 0:s.firstName,s==null?void 0:s.lastName)})]}),e.jsxs(n,{gap:"md",children:[e.jsx(se,{size:20,color:"var(--mantine-color-gray-6)"}),e.jsx(i,{size:"sm",fw:500,children:"Email:"}),e.jsx(i,{size:"sm",children:(s==null?void 0:s.email)||"No email provided"})]})]}),e.jsxs(d,{gap:"md",children:[e.jsx(f,{order:3,size:"h4",children:"Contact Information"}),e.jsxs(n,{gap:"md",children:[e.jsx(re,{size:20,color:"var(--mantine-color-gray-6)"}),e.jsx(i,{size:"sm",fw:500,children:"Phone:"}),e.jsx(i,{size:"sm",children:(s==null?void 0:s.phoneNumber)||"Not provided"})]}),e.jsxs(n,{gap:"md",children:[e.jsx(ae,{size:20,color:"var(--mantine-color-gray-6)"}),e.jsx(i,{size:"sm",fw:500,children:"Address:"}),e.jsx(i,{size:"sm",children:(s==null?void 0:s.address)||"Not provided"})]})]})]}),e.jsx(A,{}),e.jsxs(n,{gap:"md",children:[e.jsx(m,{leftSection:e.jsx(oe,{size:16}),onClick:()=>g(!0),variant:"outline",radius:"md",color:"blue",children:"Reset Password"}),e.jsx(m,{leftSection:e.jsx(te,{size:16}),onClick:()=>w(!0),variant:"outline",color:"red",radius:"md",children:"Delete Account"})]})]})}),e.jsx(D,{opened:k,onClose:()=>g(!1),title:e.jsx(i,{fw:600,children:"Reset Password"}),size:"md",children:e.jsx("form",{onSubmit:B,children:e.jsxs(d,{gap:"md",children:[e.jsx(p,{radius:"md",label:"Current Password",placeholder:"Enter current password",value:o.oldPassword,onChange:a=>x({...o,oldPassword:a.target.value}),required:!0}),e.jsx(p,{radius:"md",label:"New Password",placeholder:"Enter new password",value:o.newPassword,onChange:a=>x({...o,newPassword:a.target.value}),required:!0}),e.jsx(p,{radius:"md",label:"Confirm New Password",placeholder:"Confirm new password",value:o.confirmNewPassword,onChange:a=>x({...o,confirmNewPassword:a.target.value}),required:!0}),e.jsxs(n,{justify:"flex-end",gap:"md",children:[e.jsx(m,{variant:"outline",onClick:()=>g(!1),radius:"md",children:"Cancel"}),e.jsx(m,{type:"submit",loading:R,radius:"md",children:"Reset Password"})]})]})})}),e.jsx(D,{opened:F,onClose:()=>w(!1),title:"Delete Account",size:"md",radius:"md",children:e.jsxs(d,{gap:"md",children:[e.jsx(Q,{p:"xs",icon:e.jsx(ie,{size:16}),title:"Warning",color:"red",variant:"light",children:"This action cannot be undone. All your data will be permanently deleted."}),e.jsxs(i,{size:"sm",c:"dimmed",children:["To confirm deletion, please type ",e.jsx("strong",{children:"DELETE"})," in the field below:"]}),e.jsx(H,{placeholder:"Type DELETE to confirm",value:P,onChange:a=>O(a.target.value)}),e.jsxs(n,{justify:"flex-end",gap:"md",children:[e.jsx(m,{variant:"filled",radius:"md",onClick:()=>w(!1),children:"Cancel"}),e.jsx(m,{color:"red",radius:"md",variant:"outline",loading:T,onClick:G,children:"Delete Account"})]})]})})]})})}export{ge as default};
