import{w as W,j as r,C as B,a3 as D,P as G,L as M,G as g,T as c,ae as p,S as j,n as d,F as u,ab as z,aa as N,af as $,ac as P}from"./ui-DwlZS5FE.js";import{S as J}from"./index-BQ8IoaJW.js";import{u as O,r as n}from"./router-DP3ythCP.js";import{u as Y,t as Z,f as v,n as t}from"./chat-DfZj3kwJ.js";import{u as H}from"./useStore-BccYtkDz.js";import{s as C,f as V,F as o}from"./icons-CEIuXgFH.js";import"./vendor-DJG_os-6.js";import"./appointments-D_E_DIOB.js";import"./query-CPQchYQR.js";const ae=()=>{const x=O(),a=H(e=>e.isLoading),{handleRegister:E}=Y(),[m,b]=n.useState(0),[h,F]=n.useState(""),[f,y]=n.useState(!1),[q,S]=n.useState(!1),[l,w]=n.useState(0),[k,R]=n.useState(!1),s=W({initialValues:{email:"",password:"",firstName:"",lastName:"",confirmPassword:"",address:"",phoneNumber:""},validate:{email:e=>e?/^\S+@\S+$/.test(e)?null:"Invalid email address":"Email is required",password:e=>e?e.length<6?"Password must be at least 6 characters":/[A-Z]/.test(e)?/[a-z]/.test(e)?/[0-9]/.test(e)?null:"Password must contain at least one number":"Password must contain at least one lowercase letter":"Password must contain at least one uppercase letter":"Password is required",confirmPassword:(e,i)=>e!==i.password?"Passwords do not match":e?null:"Please confirm your password",firstName:e=>e?null:"First Name is required",lastName:e=>e?null:"Last Name is required",address:e=>e?null:"Address is required",phoneNumber:e=>e?null:"Phone Number is required"}});n.useEffect(()=>{if(l>0){const e=setTimeout(()=>w(l-1),1e3);return()=>clearTimeout(e)}},[l]);const T=async()=>{if(!s.validateField("email").hasError)try{const i=await v.sendVerificationCode(s.values.email);i.success?(b(1),w(60),t.show({title:"Code Sent",message:i.message,color:"green",icon:r.jsx(C,{size:16})})):t.show({title:"Error",message:i.error,color:"red",icon:r.jsx(o,{size:16})})}catch{t.show({title:"Error",message:"Failed to send verification code. Please try again.",color:"red",icon:r.jsx(o,{size:16})})}},A=async()=>{if(h.length!==6){t.show({title:"Invalid Code",message:"Please enter a 6-digit verification code",color:"red",icon:r.jsx(o,{size:16})});return}y(!0);try{const e=await v.verifyCode(s.values.email,h);e.success?(R(!0),b(2),t.show({title:"Email Verified",message:"Email verified successfully! Complete your registration.",color:"green",icon:r.jsx(V,{size:16})})):t.show({title:"Verification Failed",message:e.error,color:"red",icon:r.jsx(o,{size:16})})}catch{t.show({title:"Error",message:"An unexpected error occurred. Please try again.",color:"red",icon:r.jsx(o,{size:16})})}y(!1)},I=async()=>{if(!(l>0)){S(!0);try{const e=await v.sendVerificationCode(s.values.email);e.success?(t.show({title:"Code Sent",message:e.message,color:"green",icon:r.jsx(C,{size:16})}),w(60)):t.show({title:"Error",message:e.error,color:"red",icon:r.jsx(o,{size:16})})}catch{t.show({title:"Error",message:"Failed to resend verification code. Please try again.",color:"red",icon:r.jsx(o,{size:16})})}S(!1)}},L=async e=>{if(!k){t.show({title:"Email Not Verified",message:"Please verify your email before completing registration.",color:"red",icon:r.jsx(o,{size:16})});return}try{const i=await E({email:e.email,password:e.password,firstName:e.firstName,lastName:e.lastName,confirmPassword:e.confirmPassword,address:e.address,phoneNumber:e.phoneNumber});if(!(i!=null&&i.success))throw new Error((i==null?void 0:i.error)||"Registration failed")}catch(i){console.error("Registration error:",i)}};return r.jsxs(B,{w:"100vw",h:"100vh",fluid:!0,bg:Z.backgroundColor,children:[r.jsx(D,{h:"50"}),r.jsxs(G,{withBorder:!0,shadow:"md",radius:"lg",p:"xl",mx:"auto",w:"600",children:[r.jsx(M,{visible:a||f,overlayProps:{blur:2}}),r.jsx(g,{pb:"md",justify:"center",children:r.jsx(J,{height:60,width:60,onClick:()=>x("/"),style:{cursor:"pointer"}})}),r.jsx(c,{size:"30px",ta:"center",mb:"md",fw:500,children:"Create an account"}),r.jsxs(p,{active:m,breakpoint:"sm",mb:"xl",children:[r.jsx(p.Step,{label:"Email",description:"Enter your email",children:"Step 1: Email verification"}),r.jsx(p.Step,{label:"Verify",description:"Verify code",children:"Step 2: Email verification"}),r.jsx(p.Step,{label:"Complete",description:"Finish registration",children:"Step 3: Complete registration"})]}),m===0&&r.jsxs(j,{gap:"lg",children:[r.jsx(d,{size:"md",required:!0,label:"Email",placeholder:"your@email.com",value:s.values.email,onChange:e=>s.setFieldValue("email",e.currentTarget.value),error:s.errors.email,radius:"md",disabled:a}),r.jsx(u,{size:"lg",radius:"xl",fullWidth:!0,onClick:T,loading:a,disabled:!s.values.email,children:"Send Verification Code"}),r.jsxs(c,{ta:"center",size:"sm",children:["Already have an account?"," ",r.jsx(z,{component:"button",type:"button",onClick:()=>x("/login"),fw:500,disabled:a,children:"Sign in"})]})]}),m===1&&r.jsxs(j,{gap:"lg",children:[r.jsxs(N,{icon:r.jsx(C,{size:16}),variant:"light",children:["We've sent a 6-digit verification code to"," ",r.jsx(c,{component:"span",fw:500,children:s.values.email}),". Please check your inbox."]}),r.jsx(g,{justify:"center",children:r.jsx($,{length:6,value:h,onChange:F,size:"lg",type:"number",placeholder:"○",disabled:f})}),r.jsx(u,{size:"lg",radius:"xl",fullWidth:!0,onClick:A,loading:f,disabled:h.length!==6,children:"Verify Code"}),r.jsxs(g,{justify:"center",gap:"xs",children:[r.jsx(c,{size:"sm",c:"dimmed",children:"Didn't receive the code?"}),r.jsx(u,{variant:"subtle",size:"sm",onClick:I,loading:q,disabled:l>0,children:l>0?`Resend in ${l}s`:"Resend Code"})]}),r.jsx(u,{variant:"subtle",onClick:()=>b(0),disabled:f,children:"← Change Email"})]}),m===2&&r.jsx("form",{onSubmit:s.onSubmit(L),children:r.jsxs(j,{gap:"md",children:[r.jsx(N,{icon:r.jsx(V,{size:16}),color:"green",variant:"light",mb:"md",children:"Email verified successfully! Complete your registration below."}),r.jsxs(g,{grow:!0,children:[r.jsx(d,{size:"md",required:!0,label:"First Name",placeholder:"e.g. John",value:s.values.firstName,onChange:e=>s.setFieldValue("firstName",e.currentTarget.value),error:s.errors.firstName,radius:"md",disabled:a}),r.jsx(d,{size:"md",required:!0,label:"Last Name",placeholder:"e.g. Doe",value:s.values.lastName,onChange:e=>s.setFieldValue("lastName",e.currentTarget.value),error:s.errors.lastName,radius:"md",disabled:a})]}),r.jsx(d,{size:"md",required:!0,label:"Phone Number",placeholder:"e.g. 09123456789",value:s.values.phoneNumber,onChange:e=>s.setFieldValue("phoneNumber",e.currentTarget.value),error:s.errors.phoneNumber,radius:"md",disabled:a}),r.jsx(d,{size:"md",required:!0,label:"Address",placeholder:"e.g. Main St, Nablus, Palestine",value:s.values.address,onChange:e=>s.setFieldValue("address",e.currentTarget.value),error:s.errors.address,radius:"md",disabled:a}),r.jsx(d,{size:"md",required:!0,label:"Email",value:s.values.email,radius:"md",disabled:!0}),r.jsx(P,{size:"md",required:!0,label:"Password",placeholder:"Your password",value:s.values.password,onChange:e=>s.setFieldValue("password",e.currentTarget.value),error:s.errors.password,radius:"md",disabled:a}),r.jsx(P,{size:"md",required:!0,label:"Confirm Password",placeholder:"Confirm your password",value:s.values.confirmPassword,onChange:e=>s.setFieldValue("confirmPassword",e.currentTarget.value),error:s.errors.confirmPassword,radius:"md",disabled:a}),r.jsx(u,{mt:"lg",type:"submit",radius:"xl",size:"lg",fullWidth:!0,loading:a,children:"Complete Registration"}),r.jsxs(c,{ta:"center",size:"sm",children:["Already have an account?"," ",r.jsx(z,{component:"button",type:"button",onClick:()=>x("/login"),fw:500,disabled:a,children:"Sign in"})]})]})})]})]})};export{ae as default};
