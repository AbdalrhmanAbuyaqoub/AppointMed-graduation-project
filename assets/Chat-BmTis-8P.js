import{a5 as L,m as G,n as z,Z as F,aa as H,ab as D,j as e,ac as W,B as A,ad as K,c as k,G as N,ae as w,b as O,P as C,d as j,af as B,r as d,K as Y,ag as $,a as Q,ah as U,ai as R,aj as b,u as X,M as q,F as Z,ak as _,A as J,al as V,O as ee,am as se,an as te,ao as oe,ap as ae}from"./index-V7YoHL8v.js";import{I as ne}from"./Image-2w0lmft6.js";const re={gap:{type:"spacing",property:"gap"},rowGap:{type:"spacing",property:"rowGap"},columnGap:{type:"spacing",property:"columnGap"},align:{type:"identity",property:"alignItems"},justify:{type:"identity",property:"justifyContent"},wrap:{type:"identity",property:"flexWrap"},direction:{type:"identity",property:"flexDirection"}};var P={root:"m_8bffd616"};const le={},M=L((s,t)=>{const r=G("Flex",le,s),{classNames:u,className:n,style:l,styles:c,unstyled:y,vars:v,gap:x,rowGap:f,columnGap:T,align:E,justify:S,wrap:a,direction:m,...o}=r,g=z({name:"Flex",classes:P,props:r,className:n,style:l,classNames:u,styles:c,unstyled:y,vars:v}),I=F(),p=H(),i=D({styleProps:{gap:x,rowGap:f,columnGap:T,align:E,justify:S,wrap:a,direction:m},theme:I,data:re});return e.jsxs(e.Fragment,{children:[i.hasResponsiveStyles&&e.jsx(W,{selector:`.${p}`,styles:i.styles,media:i.media}),e.jsx(A,{ref:t,...g("root",{className:p,style:K(i.inlineStyles)}),...o})]})});M.classes=P;M.displayName="@mantine/core/Flex";/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var ie=k("outline","robot","IconRobot",[["path",{d:"M6 4m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v4a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z",key:"svg-0"}],["path",{d:"M12 2v2",key:"svg-1"}],["path",{d:"M9 12v9",key:"svg-2"}],["path",{d:"M15 12v9",key:"svg-3"}],["path",{d:"M5 16l4 -2",key:"svg-4"}],["path",{d:"M15 14l4 2",key:"svg-5"}],["path",{d:"M9 18h6",key:"svg-6"}],["path",{d:"M10 8v.01",key:"svg-7"}],["path",{d:"M14 8v.01",key:"svg-8"}]]);/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var ce=k("outline","send","IconSend",[["path",{d:"M10 14l11 -11",key:"svg-0"}],["path",{d:"M21 3l-6.5 18a.55 .55 0 0 1 -1 0l-3.5 -7l-7 -3.5a.55 .55 0 0 1 0 -1l18 -6.5",key:"svg-1"}]]);const ue="_userBubble_kv9dn_1",ge="_botBubble_kv9dn_8",de="_userAvatar_kv9dn_18",me="_botAvatar_kv9dn_24",pe="_messageGroup_kv9dn_30",he="_messageWrapper_kv9dn_36",fe="_timestamp_kv9dn_40",ye="_input_kv9dn_45",Te="_sendButton_kv9dn_65",Ee="_inputContainer_kv9dn_83",h={userBubble:ue,botBubble:ge,userAvatar:de,botAvatar:me,messageGroup:pe,messageWrapper:he,timestamp:fe,input:ye,sendButton:Te,inputContainer:Ee};function Ie(s){const t=[];let r=0;const u=/<b>(.*?)<\/b>/gi;let n,l=0;for(;(n=u.exec(s))!==null;)n.index>r&&t.push(s.slice(r,n.index)),t.push(e.jsx("b",{children:n[1]},l++)),r=u.lastIndex;return r<s.length&&t.push(s.slice(r)),t}function ve({message:s}){return e.jsxs(N,{justify:s.isUser?"flex-end":"flex-start",align:"flex-end",className:h.messageGroup,children:[!s.isUser&&e.jsx(w,{variant:"filled",radius:"xl",size:"md",className:h.botAvatar,children:e.jsx(ie,{size:"1.2rem"})}),e.jsxs(O,{gap:4,align:s.isUser?"flex-end":"flex-start",style:{maxWidth:"70%"},children:[e.jsx(A,{className:h.messageWrapper,children:e.jsx(C,{className:s.isUser?h.userBubble:h.botBubble,shadow:"sm",p:"sm",children:e.jsx(j,{size:"sm",style:{whiteSpace:"pre-wrap",wordBreak:"break-word"},children:Ie(s.text)})})}),e.jsx(j,{size:"xs",c:"dimmed",className:h.timestamp,children:s.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),s.isUser&&e.jsx(w,{variant:"filled",size:"md",radius:"xl",className:h.userAvatar,children:e.jsx(B,{size:"1.2rem"})})]})}function xe({onSendMessage:s}){const[t,r]=d.useState(""),u=()=>{t.trim()&&(s(t.trim()),r(""))},n=l=>{l.key==="Enter"&&!l.shiftKey&&(l.preventDefault(),u())};return e.jsxs(N,{gap:"xs",className:h.inputContainer,children:[e.jsx(Y,{placeholder:"Type a message... (Press Enter to send)",value:t,onChange:l=>r(l.target.value),onKeyDown:n,style:{flex:1},classNames:{input:h.input},size:"md",radius:"xl"}),e.jsx($,{label:"Send message",position:"top",children:e.jsx(Q,{onClick:u,variant:"filled",className:h.sendButton,disabled:!t.trim(),children:e.jsx(ce,{size:18})})})]})}function Se(){const[s,t]=d.useState([]),[r,u]=d.useState(!1),[n,l]=d.useState(!1),c=d.useRef(null),y=5*60*1e3,v={id:"welcome-message",text:"Hello! 👋 I'm Samera your AI assistant. I'm here to help you to Book Your appointment. How can I help you today?",isUser:!1,timestamp:new Date},x={id:`timeout-${Date.now()}`,text:"⏰ Your session has ended due to inactivity. Please send a new message to start again.",isUser:!1,timestamp:new Date},f=(a=!1)=>{if(console.log("[TIMEOUT] startTimeout called - hasUserInteracted:",n,"forceStart:",a),!n&&!a){console.log("[TIMEOUT] Not starting timeout - user hasn't interacted yet and not forced");return}c.current&&(console.log("[TIMEOUT] Clearing existing timeout"),clearTimeout(c.current)),console.log("[TIMEOUT] Starting new timeout - duration:",y/1e3,"seconds"),c.current=setTimeout(async()=>{console.log("[TIMEOUT] ⏰ Chat session timeout triggered!");try{console.log("[TIMEOUT] Attempting to clear backend chat..."),await b.clearChat(),console.log("[TIMEOUT] ✅ Backend chat cleared successfully on timeout")}catch(m){console.warn("[TIMEOUT] ❌ Failed to clear backend chat on timeout:",m)}console.log("[TIMEOUT] Adding timeout message to conversation"),t(m=>{const o=[...m,{...x,id:`timeout-${Date.now()}`}];return console.log("[TIMEOUT] New message count after timeout:",o.length),o}),console.log("[TIMEOUT] Resetting hasUserInteracted flag to false"),l(!1),console.log("[TIMEOUT] Session timeout processing complete")},y),console.log("[TIMEOUT] Timeout set with ID:",c.current)},T=()=>{c.current?(console.log("[TIMEOUT] Clearing timeout with ID:",c.current),clearTimeout(c.current),c.current=null,console.log("[TIMEOUT] Timeout cleared and reset to null")):console.log("[TIMEOUT] No active timeout to clear")};d.useEffect(()=>{r||(console.log("[CHAT] Initializing chat with welcome message"),t([v]),u(!0),console.log("[CHAT] Chat initialized - NOT starting timeout (waiting for user interaction)"))},[r]),d.useEffect(()=>()=>{console.log("[CHAT] Component unmounting - cleaning up timeout"),T()},[]),d.useEffect(()=>{console.log("[USER_INTERACTION] hasUserInteracted changed to:",n)},[n]);const E=U({mutationFn:async a=>{console.log("[MESSAGE] User sending message:",a),!n?(console.log("[USER_INTERACTION] 🎯 First user interaction detected!"),l(!0),console.log("[USER_INTERACTION] Setting hasUserInteracted to true"),f(!0)):(console.log("[USER_INTERACTION] User interaction (timeout will restart)"),f());const o={id:Date.now().toString(),text:a,isUser:!0,timestamp:new Date},g={id:(Date.now()+1).toString(),text:"...",isUser:!1,timestamp:new Date,isTemp:!0};console.log("[MESSAGE] Adding user message and temp bot message to conversation"),t(p=>{const i=[...p,o,g];return console.log("[MESSAGE] Message count after adding user message:",i.length),i}),console.log("[API] Sending message to chatbot API...");const I=await b.sendMessage(a);return console.log("[API] Received response from chatbot API"),console.log("[MESSAGE] Replacing temp message with bot response"),t(p=>p.map(i=>i.isTemp&&i.id===g.id?{...i,text:I.reply,isTemp:!1}:i)),console.log("[TIMEOUT] Restarting timeout after receiving bot response"),f(),console.log("[MESSAGE] Message send process completed successfully"),{userMessage:o}},onError:a=>{console.error("[MESSAGE] ❌ Error sending message:",a),R.error("Error","Failed to send message"),console.log("[MESSAGE] Removing temp bot message due to error"),t(m=>m.filter(o=>!o.isTemp)),n?(console.log("[TIMEOUT] Restarting timeout after message error (user has interacted)"),f()):console.log("[TIMEOUT] Not restarting timeout after error (user hasn't interacted)")}}),S=U({mutationFn:async()=>{console.log("[CLEAR] Manual chat clear initiated"),console.log("[CLEAR] Clearing timeout before chat clear"),T(),console.log("[CLEAR] Resetting hasUserInteracted to false"),l(!1),console.log("[CLEAR] Calling API to clear backend chat...");const a=await b.clearChat();return console.log("[CLEAR] Backend chat cleared successfully"),console.log("[CLEAR] Clearing local messages and resetting with welcome message"),t([v]),console.log("[CLEAR] Manual chat clear completed - NOT starting timeout (waiting for user interaction)"),a},onSuccess:()=>{console.log("[CLEAR] ✅ Chat cleared successfully")},onError:a=>{console.error("[CLEAR] ❌ Error clearing chat:",a),R.error("Error","Failed to clear chat"),console.log("[CLEAR] Not restarting timeout due to clear error")}});return d.useEffect(()=>{console.log("[MESSAGES] Message count changed to:",s.length),s.length>0&&console.log("[MESSAGES] Latest message:",s[s.length-1])},[s]),{messages:s,isLoading:E.isPending,error:E.error,sendMessage:a=>E.mutate(a),clearChat:()=>S.mutate(),isClearingChat:S.isPending,startTimeout:f,clearChatTimeout:T}}const Me="/graduation-front/assets/calendar-illustration-rrQxCqtX.svg";function Ae(){const s=d.useRef(null),t=X(),r=q(),{user:u,handleLogout:n}=Z(),[l,c]=d.useState(!1),{messages:y,sendMessage:v,clearChat:x,isClearingChat:f}=Se();_.useEffect(()=>()=>{x()},[]);const T=async()=>{await x(),n()},E=[{label:"Profile",icon:e.jsx(B,{size:20}),onClick:()=>t(te.PROFILE,{state:{background:r}})},{label:"Settings",icon:e.jsx(oe,{size:20}),onClick:()=>{}},{label:"Log Out",icon:e.jsx(ae,{size:20}),onClick:T}],S=(o="smooth")=>{if(s.current){const g=s.current,I=g.scrollHeight,p=g.clientHeight;g.scrollTo({top:I-p,behavior:o})}};_.useEffect(()=>{l||S()},[y,l]);const a=async o=>{o.trim()&&(c(!1),await v(o))},m=({y:o})=>{if(!s.current)return;const g=s.current,I=g.scrollHeight,p=g.clientHeight,i=Math.abs(I-p-o)<1;c(!i)};return e.jsx(J,{bg:"var(--mantine-color-blue-light)",children:e.jsxs(M,{h:"100vh",gap:"md",p:"md",children:[e.jsxs(C,{w:"70%",radius:"md",bg:"transparent",pos:"relative",children:[e.jsx(A,{pos:"absolute",top:20,left:30,children:e.jsx(V,{menuItems:E,user:u})}),e.jsx(M,{align:"center",justify:"center",h:"100%",children:e.jsx(ne,{src:Me,alt:"Calendar Illustration",h:600,w:"auto"})})]}),e.jsxs(C,{w:500,radius:"lg",shadow:"md",mr:30,bg:"gray.1",pos:"relative",children:[e.jsx(ee,{visible:f}),e.jsxs(M,{direction:"column",h:"100%",children:[e.jsx(se,{h:"calc(100% - 80px)",viewportRef:s,offsetScrollbars:!0,onScrollPositionChange:m,scrollbarSize:8,type:"hover",children:e.jsx(O,{gap:"md",p:"md",children:y.map(o=>e.jsx(ve,{message:o},o.id))})}),e.jsx(xe,{onSendMessage:a})]})]})]})})}export{Ae as default};
