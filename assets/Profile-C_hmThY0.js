import{c as D,F,r as u,j as e,C as O,b as i,G as l,T as C,P as q,ac as B,ao as _,h as G,H as J,d as f,aV as $,b3 as H,aT as K,a as g,aC as Q,aD as b,J as V,K as n,b9 as x}from"./index-BvZYOKgn.js";import{u as W}from"./useUserQueries-BcqvAC1Q.js";import{P as j,A as Y}from"./PasswordInput-DbMb0vJB.js";/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var X=D("outline","alert-triangle","IconAlertTriangle",[["path",{d:"M12 9v4",key:"svg-0"}],["path",{d:"M10.363 3.591l-8.106 13.534a1.914 1.914 0 0 0 1.636 2.871h16.214a1.914 1.914 0 0 0 1.636 -2.87l-8.106 -13.536a1.914 1.914 0 0 0 -3.274 0z",key:"svg-1"}],["path",{d:"M12 16h.01",key:"svg-2"}]]);/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Z=D("outline","lock","IconLock",[["path",{d:"M5 13a2 2 0 0 1 2 -2h10a2 2 0 0 1 2 2v6a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2v-6z",key:"svg-0"}],["path",{d:"M11 16a1 1 0 1 0 2 0a1 1 0 0 0 -2 0",key:"svg-1"}],["path",{d:"M8 11v-4a4 4 0 1 1 8 0v4",key:"svg-2"}]]);const I=s=>{try{if(!s)return null;const c=s.split(".");if(c.length!==3)return null;const h=JSON.parse(atob(c[1]));return console.log("Decoded token payload:",h),h}catch(c){return console.error("Error decoding token:",c),null}};function ae(){var E;const{user:s,handleLogout:c}=F(),{resetPassword:h,deleteAccount:P,isResettingPassword:z,isDeletingAccount:A}=W();u.useEffect(()=>{},[s]);const[k,m]=u.useState(!1),[N,w]=u.useState(!1),[t,p]=u.useState({oldPassword:"",newPassword:"",confirmNewPassword:""}),[v,M]=u.useState(""),S=()=>{if(s!=null&&s.id)return s.id;if(s!=null&&s.userId)return s.userId;if(s!=null&&s.user_id)return s.user_id;const a=x(),r=I(a);return(r==null?void 0:r.nameid)||(r==null?void 0:r.userId)||(r==null?void 0:r.sub)||(r==null?void 0:r.id)},y=()=>{if(s!=null&&s.email)return s.email;const a=x(),r=I(a);return(r==null?void 0:r.email)||(r==null?void 0:r.unique_name)},U=async a=>{if(a.preventDefault(),t.newPassword!==t.confirmNewPassword){n.show({title:"Error",message:"New passwords do not match",color:"red"});return}if(t.newPassword.length<6){n.show({title:"Error",message:"Password must be at least 6 characters long",color:"red"});return}const r=y(),o=x();if(!r){n.show({title:"Error",message:"User email is missing. Please try logging out and logging back in.",color:"red"});return}if(!o){n.show({title:"Error",message:"Authentication token is missing. Please try logging out and logging back in.",color:"red"});return}try{const d={email:r,oldPassword:t.oldPassword,newPassword:t.newPassword,confirmNewPassword:t.confirmNewPassword,token:o};console.log("Password reset data being sent:",d),await h(d),m(!1),p({oldPassword:"",newPassword:"",confirmNewPassword:""}),n.show({title:"Success",message:"Password reset successfully",color:"green"})}catch(d){n.show({title:"Error",message:d.message||"Failed to reset password",color:"red"})}},R=async()=>{if(v!=="DELETE"){n.show({title:"Error",message:'Please type "DELETE" to confirm account deletion',color:"red"});return}const a=y(),r=S();if(!a){n.show({title:"Error",message:"User email is missing. Please try logging out and logging back in.",color:"red"});return}try{r?await P({email:a,id:r}):await P({email:a,id:""}),n.show({title:"Success",message:"Account deleted successfully. You will be logged out.",color:"green"}),w(!1),setTimeout(async()=>{try{await c()}catch{window.location.href="/login"}},1500)}catch(o){n.show({title:"Error",message:o.message||"Failed to delete account",color:"red"})}},T=(a,r)=>{if(!a&&!r)return"U";const o=a?a.charAt(0).toUpperCase():"",d=r?r.charAt(0).toUpperCase():"";return o+d},L=(a,r)=>!a&&!r?"User":`${a||""} ${r||""}`.trim();return e.jsxs(O,{size:"lg",py:"xl",children:[e.jsxs(i,{gap:"xl",children:[e.jsx(l,{justify:"space-between",align:"center",children:e.jsx(C,{order:1,children:"Profile Details"})}),e.jsx(q,{radius:"md",p:"xl",withBorder:!0,children:e.jsxs(i,{gap:"lg",children:[e.jsxs(l,{gap:"xl",align:"flex-start",children:[e.jsx(B,{size:120,radius:120,variant:"filled",children:T(s==null?void 0:s.firstName,s==null?void 0:s.lastName)}),e.jsxs(i,{gap:"md",style:{flex:1},children:[e.jsx(l,{justify:"space-between",align:"flex-start",children:e.jsxs(i,{gap:"xs",children:[e.jsx(C,{order:2,children:L(s==null?void 0:s.firstName,s==null?void 0:s.lastName)}),e.jsx(_,{size:"lg",variant:"light",color:"blue",children:((E=s==null?void 0:s.role)==null?void 0:E.toUpperCase())||"USER"})]})}),e.jsx(G,{withBorder:!0,p:"md",children:e.jsxs(i,{gap:"md",children:[e.jsxs(l,{gap:"md",children:[e.jsx(J,{size:20,color:"var(--mantine-color-gray-6)"}),e.jsx(f,{size:"md",children:(s==null?void 0:s.email)||"No email provided"})]}),(s==null?void 0:s.phoneNumber)&&e.jsxs(l,{gap:"md",children:[e.jsx($,{size:20,color:"var(--mantine-color-gray-6)"}),e.jsx(f,{size:"md",children:s.phoneNumber})]}),(s==null?void 0:s.address)&&e.jsxs(l,{gap:"md",children:[e.jsx(H,{size:20,color:"var(--mantine-color-gray-6)"}),e.jsx(f,{size:"md",children:s.address})]})]})})]})]}),e.jsx(K,{}),e.jsxs(l,{gap:"md",children:[e.jsx(g,{leftSection:e.jsx(Z,{size:16}),onClick:()=>m(!0),variant:"outline",color:"blue",children:"Reset Password"}),e.jsx(g,{leftSection:e.jsx(Q,{size:16}),onClick:()=>w(!0),variant:"outline",color:"red",children:"Delete Account"})]})]})})]}),e.jsx(b,{opened:k,onClose:()=>m(!1),title:"Reset Password",size:"md",children:e.jsx("form",{onSubmit:U,children:e.jsxs(i,{gap:"md",children:[e.jsx(j,{label:"Current Password",placeholder:"Enter current password",value:t.oldPassword,onChange:a=>p({...t,oldPassword:a.target.value}),required:!0}),e.jsx(j,{label:"New Password",placeholder:"Enter new password",value:t.newPassword,onChange:a=>p({...t,newPassword:a.target.value}),required:!0}),e.jsx(j,{label:"Confirm New Password",placeholder:"Confirm new password",value:t.confirmNewPassword,onChange:a=>p({...t,confirmNewPassword:a.target.value}),required:!0}),e.jsxs(l,{justify:"flex-end",gap:"md",children:[e.jsx(g,{variant:"outline",onClick:()=>m(!1),children:"Cancel"}),e.jsx(g,{type:"submit",loading:z,children:"Reset Password"})]})]})})}),e.jsx(b,{opened:N,onClose:()=>w(!1),title:"Delete Account",size:"md",children:e.jsxs(i,{gap:"md",children:[e.jsx(Y,{icon:e.jsx(X,{size:16}),title:"Warning",color:"red",variant:"light",children:"This action cannot be undone. All your data will be permanently deleted."}),e.jsxs(f,{size:"sm",c:"dimmed",children:["To confirm deletion, please type ",e.jsx("strong",{children:"DELETE"})," in the field below:"]}),e.jsx(V,{placeholder:"Type DELETE to confirm",value:v,onChange:a=>M(a.target.value)}),e.jsxs(l,{justify:"flex-end",gap:"md",children:[e.jsx(g,{variant:"outline",onClick:()=>w(!1),children:"Cancel"}),e.jsx(g,{color:"red",loading:A,onClick:R,children:"Delete Account"})]})]})})]})}export{ae as default};
