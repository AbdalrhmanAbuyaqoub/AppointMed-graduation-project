import{v as Ie,X as C,af as Ne,r as te,o as U,j as e,ak as Ae,B as je,al as be,w as ze,am as K,E as Te,an as Le,ao as Me,ap as ke,F as Ee,a6 as Fe,G as E,b as _,a8 as D,a as O,aq as Re,a7 as Oe,z as $e,ar as Ye,as as Be,at as fe,d as Ce,e as Ve,a9 as V,au as He,ab as _e,av as Ue,C as We,T as Ze,aw as Ge,ae as qe,P as Xe}from"./index-Yqc44LFA.js";import{u as De}from"./useAppointmentQueries-IMF4CvF5.js";import{S as Je,D as Ke,I as Qe,a as et,A as tt,C as st}from"./AppointmentDetailsDrawer-CxyYMV2T.js";import{T as h}from"./Table-BhI_H3rt.js";import{d as ee,u as at,t as nt}from"./timezone-YNkisRrB.js";import"./appointmentService-tGjyUJJe.js";import"./useUserQueries-CZpXoeHi.js";import"./use-form-DP3dSN8K.js";import"./use-isomorphic-layout-effect.browser.esm-puOWt--r.js";function k(s,t){const n=t-s+1;return Array.from({length:n},(o,l)=>l+s)}const Q="dots";function ot({total:s,siblings:t=1,boundaries:n=1,page:o,initialPage:l=1,onChange:i}){const c=Math.max(Math.trunc(s),0),[m,x]=Ie({value:o,onChange:i,defaultValue:l,finalValue:l}),d=I=>{I<=0?x(1):I>c?x(c):x(I)},p=()=>d(m+1),u=()=>d(m-1),j=()=>d(1),S=()=>d(c);return{range:C.useMemo(()=>{if(t*2+3+n*2>=c)return k(1,c);const A=Math.max(m-t,n),b=Math.min(m+t,c-n),z=A>n+2,M=b<c-(n+1);if(!z&&M){const T=t*2+n+2;return[...k(1,T),Q,...k(c-(n-1),c)]}if(z&&!M){const T=n+1+2*t;return[...k(1,n),Q,...k(c-T,c)]}return[...k(1,n),Q,...k(A,b),Q,...k(c-n+1,c)]},[c,t,m]),active:m,setPage:d,next:p,previous:u,first:j,last:S}}function it(s,t){return typeof s=="boolean"?s:t.autoContrast}const[rt,se]=Ne("Pagination.Root component was not found in tree");var W={root:"m_4addd315",control:"m_326d024a",dots:"m_4ad7767d"};const ct={withPadding:!0},Z=te((s,t)=>{const n=U("PaginationControl",ct,s),{classNames:o,className:l,style:i,styles:c,vars:m,active:x,disabled:d,withPadding:p,mod:u,...j}=n,S=se(),f=d||S.disabled;return e.jsx(Ae,{ref:t,disabled:f,mod:[{active:x,disabled:f,"with-padding":p},u],...S.getStyles("control",{className:l,style:i,classNames:o,styles:c,active:!f}),...j})});Z.classes=W;Z.displayName="@mantine/core/PaginationControl";function G({style:s,children:t,path:n,...o}){return e.jsx("svg",{viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg",style:{width:"calc(var(--pagination-control-size) / 1.8)",height:"calc(var(--pagination-control-size) / 1.8)",...s},...o,children:e.jsx("path",{d:n,fill:"currentColor"})})}const lt=s=>e.jsx(G,{...s,path:"M8.781 8l-3.3-3.3.943-.943L10.667 8l-4.243 4.243-.943-.943 3.3-3.3z"}),dt=s=>e.jsx(G,{...s,path:"M7.219 8l3.3 3.3-.943.943L5.333 8l4.243-4.243.943.943-3.3 3.3z"}),ut=s=>e.jsx(G,{...s,path:"M6.85355 3.85355C7.04882 3.65829 7.04882 3.34171 6.85355 3.14645C6.65829 2.95118 6.34171 2.95118 6.14645 3.14645L2.14645 7.14645C1.95118 7.34171 1.95118 7.65829 2.14645 7.85355L6.14645 11.8536C6.34171 12.0488 6.65829 12.0488 6.85355 11.8536C7.04882 11.6583 7.04882 11.3417 6.85355 11.1464L3.20711 7.5L6.85355 3.85355ZM12.8536 3.85355C13.0488 3.65829 13.0488 3.34171 12.8536 3.14645C12.6583 2.95118 12.3417 2.95118 12.1464 3.14645L8.14645 7.14645C7.95118 7.34171 7.95118 7.65829 8.14645 7.85355L12.1464 11.8536C12.3417 12.0488 12.6583 12.0488 12.8536 11.8536C13.0488 11.6583 13.0488 11.3417 12.8536 11.1464L9.20711 7.5L12.8536 3.85355Z"}),ht=s=>e.jsx(G,{...s,path:"M2.14645 11.1464C1.95118 11.3417 1.95118 11.6583 2.14645 11.8536C2.34171 12.0488 2.65829 12.0488 2.85355 11.8536L6.85355 7.85355C7.04882 7.65829 7.04882 7.34171 6.85355 7.14645L2.85355 3.14645C2.65829 2.95118 2.34171 2.95118 2.14645 3.14645C1.95118 3.34171 1.95118 3.65829 2.14645 3.85355L5.79289 7.5L2.14645 11.1464ZM8.14645 11.1464C7.95118 11.3417 7.95118 11.6583 8.14645 11.8536C8.34171 12.0488 8.65829 12.0488 8.85355 11.8536L12.8536 7.85355C13.0488 7.65829 13.0488 7.34171 12.8536 7.14645L8.85355 3.14645C8.65829 2.95118 8.34171 2.95118 8.14645 3.14645C7.95118 3.34171 7.95118 3.65829 8.14645 3.85355L11.7929 7.5L8.14645 11.1464Z"}),mt=s=>e.jsx(G,{...s,path:"M2 8c0-.733.6-1.333 1.333-1.333.734 0 1.334.6 1.334 1.333s-.6 1.333-1.334 1.333C2.6 9.333 2 8.733 2 8zm9.333 0c0-.733.6-1.333 1.334-1.333C13.4 6.667 14 7.267 14 8s-.6 1.333-1.333 1.333c-.734 0-1.334-.6-1.334-1.333zM6.667 8c0-.733.6-1.333 1.333-1.333s1.333.6 1.333 1.333S8.733 9.333 8 9.333 6.667 8.733 6.667 8z"}),gt={icon:mt},ae=te((s,t)=>{const n=U("PaginationDots",gt,s),{classNames:o,className:l,style:i,styles:c,vars:m,icon:x,...d}=n,p=se(),u=x;return e.jsx(je,{ref:t,...p.getStyles("dots",{className:l,style:i,styles:c,classNames:o}),...d,children:e.jsx(u,{style:{width:"calc(var(--pagination-control-size) / 1.8)",height:"calc(var(--pagination-control-size) / 1.8)"}})})});ae.classes=W;ae.displayName="@mantine/core/PaginationDots";function ne({icon:s,name:t,action:n,type:o}){const l={icon:s},i=C.forwardRef((c,m)=>{const{icon:x,...d}=U(t,l,c),p=x,u=se(),j=o==="next"?u.active===u.total:u.active===1;return e.jsx(Z,{disabled:u.disabled||j,ref:m,onClick:u[n],withPadding:!1,...d,children:e.jsx(p,{className:"mantine-rotate-rtl",style:{width:"calc(var(--pagination-control-size) / 1.8)",height:"calc(var(--pagination-control-size) / 1.8)"}})})});return i.displayName=`@mantine/core/${t}`,be(i)}const Pe=ne({icon:lt,name:"PaginationNext",action:"onNext",type:"next"}),we=ne({icon:dt,name:"PaginationPrevious",action:"onPrevious",type:"previous"}),ve=ne({icon:ut,name:"PaginationFirst",action:"onFirst",type:"previous"}),ye=ne({icon:ht,name:"PaginationLast",action:"onLast",type:"next"});function ge({dotsIcon:s}){const t=se(),n=t.range.map((o,l)=>{var i,c,m;return o==="dots"?e.jsx(ae,{icon:s},l):e.jsx(Z,{active:o===t.active,"aria-current":o===t.active?"page":void 0,onClick:()=>t.onChange(o),disabled:t.disabled,...(i=t.getItemProps)==null?void 0:i.call(t,o),children:((m=(c=t.getItemProps)==null?void 0:c.call(t,o))==null?void 0:m.children)??o},l)});return e.jsx(e.Fragment,{children:n})}ge.displayName="@mantine/core/PaginationItems";const xt={siblings:1,boundaries:1},pt=Te((s,{size:t,radius:n,color:o,autoContrast:l})=>({root:{"--pagination-control-radius":n===void 0?void 0:Fe(n),"--pagination-control-size":Ee(t,"pagination-control-size"),"--pagination-control-fz":ke(t),"--pagination-active-bg":o?Me(o,s):void 0,"--pagination-active-color":it(l,s)?Le({color:o,theme:s,autoContrast:l}):void 0}})),oe=te((s,t)=>{const n=U("PaginationRoot",xt,s),{classNames:o,className:l,style:i,styles:c,unstyled:m,vars:x,total:d,value:p,defaultValue:u,onChange:j,disabled:S,siblings:f,boundaries:I,color:A,radius:b,onNextPage:z,onPreviousPage:M,onFirstPage:T,onLastPage:F,getItemProps:$,autoContrast:a,...L}=n,R=ze({name:"Pagination",classes:W,props:n,className:l,style:i,classNames:o,styles:c,unstyled:m,vars:x,varsResolver:pt}),{range:Y,setPage:P,next:H,previous:q,active:ie,first:re,last:ce}=ot({page:p,initialPage:u,onChange:j,total:d,siblings:f,boundaries:I}),X=K(z,H),le=K(M,q),J=K(T,re),B=K(F,ce);return e.jsx(rt,{value:{total:d,range:Y,active:ie,disabled:S,getItemProps:$,onChange:P,onNext:X,onPrevious:le,onFirst:J,onLast:B,getStyles:R},children:e.jsx(je,{ref:t,...R("root"),...L})})});oe.classes=W;oe.displayName="@mantine/core/PaginationRoot";const ft={withControls:!0,withPages:!0,siblings:1,boundaries:1,gap:8},N=te((s,t)=>{const n=U("Pagination",ft,s),{withEdges:o,withControls:l,getControlProps:i,nextIcon:c,previousIcon:m,lastIcon:x,firstIcon:d,dotsIcon:p,total:u,gap:j,hideWithOnePage:S,withPages:f,...I}=n;return u<=0||S&&u===1?null:e.jsx(oe,{ref:t,total:u,...I,children:e.jsxs(E,{gap:j,children:[o&&e.jsx(ve,{icon:d,...i==null?void 0:i("first")}),l&&e.jsx(we,{icon:m,...i==null?void 0:i("previous")}),f&&e.jsx(ge,{dotsIcon:p}),l&&e.jsx(Pe,{icon:c,...i==null?void 0:i("next")}),o&&e.jsx(ye,{icon:x,...i==null?void 0:i("last")})]})})});N.classes=W;N.displayName="@mantine/core/Pagination";N.Root=oe;N.Control=Z;N.Dots=ae;N.First=ve;N.Last=ye;N.Next=Pe;N.Previous=we;N.Items=ge;const jt=s=>{const t=new Date,n=new Date(t.setHours(0,0,0,0));switch(s){case"today":return[n,new Date(t.setHours(23,59,59,999))];case"this-week":{const o=new Date(n);o.setDate(o.getDate()-o.getDay());const l=new Date(o);return l.setDate(l.getDate()+6),l.setHours(23,59,59,999),[o,l]}case"this-month":{const o=new Date(t.getFullYear(),t.getMonth(),1),l=new Date(t.getFullYear(),t.getMonth()+1,0,23,59,59,999);return[o,l]}default:return[null,null]}},me=s=>{if(!s)return null;const t=new Date(s);return t.setHours(0,0,0,0),t};function Ct({searchQuery:s,hasFilters:t}){const n=()=>s?"No appointments found matching your search":t?"No appointments found with the current filters":"No appointments found";return e.jsx(h.Tr,{children:e.jsx(h.Td,{colSpan:7,children:e.jsx(Ve,{h:100,children:e.jsx(_,{align:"center",gap:"md",children:e.jsx(Ce,{size:"lg",fw:500,c:"dimmed",children:n()})})})})})}function Dt({appointments:s=[],onAppointmentClick:t,searchQuery:n=""}){var xe,pe;const[o,l]=C.useState("all"),[i,c]=C.useState([null,null]),[m,x]=C.useState(!1),[d,p]=C.useState(null),[u,j]=C.useState(!1),[S,f]=C.useState(!1),[I,A]=C.useState(!1),[b,z]=C.useState(s),[M,T]=C.useState(1),F=20,{updateAppointment:$,deleteAppointment:a,updateAppointmentStatus:L}=De(),R={0:"Scheduled",1:"Cancelled",2:"Completed",3:"No Show"},Y={0:"blue",1:"red",2:"green",3:"orange"};C.useEffect(()=>{z(s)},[s]);const P=r=>{const g=jt(r);c(g)},H=()=>{if(!i[0]||!i[1])return"Date Range";const r=v=>!v||!(v instanceof Date)?"":v.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),g=r(i[0]),w=r(i[1]);return!g||!w?"Date Range":`${g} - ${w}`},q=r=>{p(r),j(!0)},ie=async r=>{try{await a.mutateAsync(r),V.show({title:"Success",message:"Appointment deleted successfully",color:"green"})}catch(g){V.show({title:"Error",message:g.message||"Failed to delete appointment",color:"red"})}},re=async r=>{try{await $.mutateAsync({id:d.id,...r}),V.show({title:"Success",message:"Appointment updated successfully",color:"green"}),j(!1)}catch(g){V.show({title:"Error",message:g.message||"Failed to update appointment",color:"red"})}};C.useEffect(()=>{const r=s.filter(g=>{var v;if(!(o==="all"||g.status===parseInt(o)))return!1;if(n){const y=n.toLowerCase().trim();if(![g.patientName,(v=g.id)==null?void 0:v.toString()].some(he=>he==null?void 0:he.toLowerCase().includes(y)))return!1}if(!i[0]||!i[1])return!0;try{const y=me(new Date(g.date)),de=me(i[0]),ue=me(i[1]);return!y||!de||!ue?!0:y>=de&&y<=ue}catch(y){return console.error("Error filtering appointment date:",y),!0}});z(r),T(1)},[s,o,n,i]);const ce=Math.ceil(b.length/F),X=(M-1)*F,le=X+F,J=b.slice(X,le),B=async(r,g)=>{try{const w=await L.mutateAsync({appointmentId:r,newStatus:g});V.show({title:"Success",message:w.message||"Appointment status updated successfully",color:"green"});const v=b.map(y=>y.id===r?{...y,status:w.newStatus}:y);z(v)}catch(w){V.show({title:"Error",message:w.message||"Failed to update appointment status",color:"red"})}},Se=r=>{p(r),A(!0),t&&t(r)};return e.jsxs(_,{children:[e.jsx(E,{mt:"sm",justify:"start",w:"100%",mb:"md",children:e.jsxs(E,{gap:"md",children:[e.jsx(Je,{size:"md",radius:"md",value:o,onChange:l,data:[{label:"All",value:"all"},{label:"Scheduled",value:"0"},{label:"Completed",value:"2"},{label:"Cancelled",value:"1"},{label:"No Show",value:"3"}]}),e.jsxs(D,{shadow:"md",radius:"lg",opened:m,onChange:x,position:"bottom-start",width:"targetWidth",children:[e.jsx(D.Target,{children:e.jsx(O,{size:"md",radius:"md",variant:"subtle",rightSection:e.jsx(Re,{color:"black",size:18}),children:H()})}),e.jsx(D.Dropdown,{p:"md",children:e.jsxs(_,{gap:"xs",children:[e.jsxs(E,{py:"sm",w:"100%",justify:"left",children:[e.jsx(O,{size:"sm",radius:"md",variant:"subtle",onClick:()=>P("today"),children:"Today"}),e.jsx(O,{size:"sm",radius:"md",variant:"subtle",onClick:()=>P("this-week"),children:"This Week"}),e.jsx(O,{radius:"md",size:"sm",variant:"subtle",onClick:()=>P("this-month"),children:"This Month"})]}),e.jsx(Ke,{size:"sm",type:"range",value:i,onChange:r=>{const[g,w]=r;if(g&&w){const v=new Date(w);v.setHours(23,59,59,999),c([g,v])}else c(r)},numberOfColumns:2})]})})]})]})}),e.jsxs(h,{verticalSpacing:"sm",highlightOnHover:!0,children:[e.jsx(h.Thead,{children:e.jsxs(h.Tr,{children:[e.jsx(h.Th,{children:"ID"}),e.jsx(h.Th,{children:"Patient"}),e.jsx(h.Th,{children:"Doctor"}),e.jsx(h.Th,{children:"Clinic"}),e.jsx(h.Th,{children:"Date"}),e.jsx(h.Th,{children:"Time"}),e.jsx(h.Th,{children:"Status"})]})}),e.jsx(h.Tbody,{children:J.length===0?e.jsx(Ct,{searchQuery:n,hasFilters:o!=="all"||i[0]&&i[1]}):J.map(r=>{const g=r.status,w=R[g]||"Scheduled",v=Y[g]||"blue";return e.jsxs(h.Tr,{style:{cursor:"pointer"},onClick:()=>Se(r),children:[e.jsx(h.Td,{children:r.id}),e.jsx(h.Td,{children:r.patientName}),e.jsx(h.Td,{children:r.doctorName}),e.jsx(h.Td,{children:r.clinicName}),e.jsx(h.Td,{children:r.displayDate||r.date}),e.jsx(h.Td,{children:r.time}),e.jsx(h.Td,{children:e.jsx(Oe,{size:"md",color:v,children:w})}),e.jsx(h.Td,{children:e.jsx(E,{gap:"xs",onClick:y=>y.stopPropagation(),children:e.jsxs(D,{shadow:"md",width:200,children:[e.jsx(D.Target,{children:e.jsx($e,{variant:"subtle",color:"gray",children:e.jsx(Qe,{size:16})})}),e.jsxs(D.Dropdown,{children:[e.jsx(D.Label,{children:"Update Status"}),e.jsx(D.Item,{onClick:()=>B(r.id,0),color:"blue",children:"Mark as Scheduled"}),e.jsx(D.Item,{onClick:()=>B(r.id,1),color:"red",children:"Mark as Cancelled"}),e.jsx(D.Item,{onClick:()=>B(r.id,2),color:"green",children:"Mark as Completed"}),e.jsx(D.Item,{onClick:()=>B(r.id,3),color:"orange",children:"Mark as No Show"}),e.jsx(D.Divider,{}),e.jsx(D.Label,{children:"Actions"}),e.jsx(D.Item,{leftSection:e.jsx(Ye,{size:14}),onClick:()=>q(r),children:"Edit"}),e.jsx(D.Item,{leftSection:e.jsx(Be,{size:14}),color:"red",onClick:()=>{p(r),f(!0)},children:"Delete"})]})]})})})]},r.id)})})]}),b.length>0&&e.jsx(E,{justify:"center",mt:"lg",children:e.jsx(N,{value:M,onChange:T,total:ce,size:"sm",radius:"md"})}),e.jsx(fe,{opened:u,onClose:()=>j(!1),title:"Edit Appointment",size:"lg",children:d&&e.jsx(et,{initialValues:{doctorId:(pe=(xe=d.doctor)==null?void 0:xe.id)==null?void 0:pe.toString(),patientName:d.patientName,patientPhone:d.patientPhone||"",startTime:new Date(d.rawDate),notes:d.notes||""},onSubmit:re,isLoading:$.isPending})}),e.jsx(fe,{opened:S,onClose:()=>f(!1),title:"Delete Appointment",size:"sm",children:e.jsxs(_,{children:[e.jsxs(Ce,{children:["Are you sure you want to delete this appointment for"," ",d==null?void 0:d.patientName,"?"]}),e.jsxs(E,{justify:"flex-end",mt:"md",children:[e.jsx(O,{variant:"light",onClick:()=>f(!1),children:"Cancel"}),e.jsx(O,{color:"red",loading:a.isPending,onClick:()=>{ie(d.id),f(!1)},children:"Delete"})]})]})}),e.jsx(tt,{opened:I,onClose:()=>A(!1),appointment:d,onEdit:()=>{A(!1),j(!0)},onDelete:()=>{A(!1),f(!0)}})]})}ee.extend(at);ee.extend(nt);function zt(){const[s,t]=C.useState(null),[n,o]=C.useState(null),{searchQuery:l}=He(),[i,{open:c,close:m}]=_e(!1),{clinics:x,doctors:d,isLoading:p,error:u}=Ue(),{appointments:j,isLoadingAppointments:S,appointmentsError:f,getAppointmentsByClinic:I,getAppointmentsByDoctor:A}=De(),{data:b}=I(s),{data:z}=A(n),M=n?z:s?b:j,T=C.useCallback(a=>{if(!a||a==="all")t(null),o(null);else if(a.startsWith("clinic-")){const L=a.replace("clinic-","");t(L),o(null)}else if(a.startsWith("doctor-")){const L=a.replace("doctor-","");o(L),t(null)}},[]),F=[{group:"General",items:[{value:"all",label:"All Appointments"}]},{group:"Clinics",items:x.map(a=>({value:`clinic-${a.id}`,label:a.name}))},{group:"Doctors",items:d.map(a=>({value:`doctor-${a.id}`,label:`${a.name} (${a.clinicName})`}))}],$=(M||[]).map(a=>{var L,R,Y;try{const P=a.startDate?ee.utc(a.startDate).tz(ee.tz.guess()):null;if(!P||!P.isValid())return{...a,id:a.id,patientName:a.patientName,doctorName:((L=a.doctor)==null?void 0:L.name)||"N/A",clinicName:a.clinicName||"N/A",date:"Invalid Date",time:"Invalid Time",status:a.status!==void 0?a.status:0,doctor:a.doctor,userId:a.userId,patientId:a.patientId};const H=P.format("YYYY-MM-DD");return{id:a.id,patientName:a.patientName,doctorName:((R=a.doctor)==null?void 0:R.name)||"N/A",clinicName:a.clinicName||"N/A",rawDate:P.toDate(),date:H,displayDate:P.format("MMM D, YYYY"),time:P.format("hh:mm A"),status:a.status!==void 0?a.status:0,doctor:a.doctor,patientPhone:a.patientPhone,notes:a.notes,userId:a.userId,patientId:a.patientId}}catch(P){return console.error("Error formatting appointment:",P),{...a,id:a.id,patientName:a.patientName,doctorName:((Y=a.doctor)==null?void 0:Y.name)||"N/A",clinicName:a.clinicName||"N/A",date:"Error",displayDate:"Error",time:"Error",status:a.status!==void 0?a.status:0,doctor:a.doctor,userId:a.userId,patientId:a.patientId}}});return e.jsx(We,{pt:12,fluid:!0,maw:1232,children:e.jsxs(_,{children:[e.jsx(Ze,{fz:"24px",order:2,children:"Appointments"}),e.jsxs(E,{mt:40,justify:"space-between",children:[e.jsx(Ge,{w:200,size:"lg",radius:"md",data:F,placeholder:"Select clinic or doctor",disabled:p,error:u==null?void 0:u.message,onChange:T,value:n?`doctor-${n}`:s?`clinic-${s}`:"all",comboboxProps:{width:500,position:"bottom-start"},styles:{dropdown:{borderRadius:"var(--mantine-radius-md)",boxShadow:"var(--mantine-shadow-md)",minWidth:"200px"}}}),e.jsx(O,{onClick:c,leftSection:e.jsx(qe,{size:16}),variant:"outline",size:"lg",radius:"xl",children:"New Appointment"})]}),e.jsx(Xe,{withBorder:!0,radius:"md",p:"md",children:S?e.jsx("div",{children:"Loading appointments..."}):f?e.jsxs("div",{children:["Error loading appointments: ",f.message]}):e.jsx(Dt,{appointments:$,searchQuery:l})}),e.jsx(st,{opened:i,onClose:m})]})})}export{zt as default};
