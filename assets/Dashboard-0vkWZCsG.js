import{j as e,t as B,T as n,U as t,K as E,G as o,M as c,p as P,X as U,v as d,C,S as x,ag as O,Y as f,a8 as A,P as D,F,B as G,A as R}from"./ui-DwlZS5FE.js";import{d as L,A as W,e as _,C as Q,b as K,t as V}from"./appointments-D_E_DIOB.js";import{u as X}from"./doctors-DtG2Q8oG.js";import{r as v,u as $}from"./router-DP3ythCP.js";import{o as q,j as M,p as J}from"./icons-CEIuXgFH.js";import{n as Y,g as Z}from"./chat-DfZj3kwJ.js";import"./vendor-DJG_os-6.js";import"./query-CPQchYQR.js";function ee({appointments:l=[]}){const[h,u]=v.useState(null),[p,m]=v.useState(!1),{updateAppointmentStatus:w}=L(),y={0:"Scheduled",1:"Cancelled",2:"Completed",3:"No Show"},T={0:"blue",1:"red",2:"green",3:"orange"},j=async(r,g)=>{try{const i=await w.mutateAsync({appointmentId:r,newStatus:g});Y.show({title:"Success",message:i.message||"Appointment status updated successfully",color:"green"})}catch(i){Y.show({title:"Error",message:i.message||"Failed to update appointment status",color:"red"})}},b=r=>{u(r),m(!0)};return l.length===0?e.jsx(B,{h:200,children:e.jsx(n,{size:"lg",fw:500,c:"dimmed",children:"No appointments scheduled for today"})}):e.jsxs(e.Fragment,{children:[e.jsxs(t,{verticalSpacing:"sm",highlightOnHover:!0,mt:15,children:[e.jsx(t.Thead,{children:e.jsxs(t.Tr,{children:[e.jsx(t.Th,{c:"dimmed",children:"ID"}),e.jsx(t.Th,{c:"dimmed",children:"Patient"}),e.jsx(t.Th,{c:"dimmed",children:"Doctor"}),e.jsx(t.Th,{c:"dimmed",children:"Time"}),e.jsx(t.Th,{c:"dimmed",children:"Status"})]})}),e.jsx(t.Tbody,{children:l.map(r=>{const g=r.status,i=y[g]||"Scheduled",S=T[g]||"blue";return e.jsxs(t.Tr,{style:{cursor:"pointer"},onClick:()=>b(r),children:[e.jsx(t.Td,{children:r.id}),e.jsx(t.Td,{children:e.jsx(n,{size:"sm",children:r.patientName})}),e.jsx(t.Td,{children:e.jsxs(n,{size:"sm",children:["Dr. ",r.doctorName]})}),e.jsx(t.Td,{children:e.jsx(n,{size:"sm",children:r.displayTime})}),e.jsx(t.Td,{children:e.jsx(E,{size:"sm",color:S,children:i})}),e.jsx(t.Td,{children:e.jsx(o,{gap:"xs",onClick:z=>z.stopPropagation(),children:e.jsxs(c,{shadow:"md",width:200,children:[e.jsx(c.Target,{children:e.jsx(P,{variant:"subtle",color:"gray",children:e.jsx(q,{size:16})})}),e.jsxs(c.Dropdown,{children:[e.jsx(c.Label,{children:"Update Status"}),e.jsx(c.Item,{onClick:()=>j(r.id,0),color:"blue",children:"Mark as Scheduled"}),e.jsx(c.Item,{onClick:()=>j(r.id,1),color:"red",children:"Mark as Cancelled"}),e.jsx(c.Item,{onClick:()=>j(r.id,2),color:"green",children:"Mark as Completed"}),e.jsx(c.Item,{onClick:()=>j(r.id,3),color:"orange",children:"Mark as No Show"})]})]})})})]},r.id)})})]}),e.jsx(W,{opened:p,onClose:()=>m(!1),appointment:h})]})}const se="_autoHideScrollbar_uhlgo_2",N={autoHideScrollbar:se};d.extend(K);d.extend(V);const I=l=>{const h=d().tz(d.tz.guess()).format("YYYY-MM-DD"),u=d.utc(l).tz(d.tz.guess()).format("YYYY-MM-DD");return h===u},re=(l,h)=>{const u=d().day();return l.filter(p=>{const m=h[p.id]||[];return m.length===0?!0:m.includes(u)})};function he(){const l=$(),{appointments:h,isLoadingAppointments:u,appointmentsError:p}=L(),{doctors:m,isLoading:w}=X(),{doctorsWorkingDays:y,isLoading:T}=_(),[j,{open:b,close:r}]=U(!1),g=s=>{l(`/doctors/${s}`)},i=(h||[]).map(s=>{var k;const a=s.startDate?d.utc(s.startDate).tz(d.tz.guess()):null;return{...s,formattedStartDate:a,doctorName:((k=s.doctor)==null?void 0:k.name)||"N/A",displayDate:(a==null?void 0:a.format("MMM D, YYYY"))||"Invalid Date",displayTime:(a==null?void 0:a.format("hh:mm A"))||"Invalid Time"}}),S=i.filter(s=>s.formattedStartDate&&I(s.startDate)),z=i.filter(s=>s.formattedStartDate&&I(s.startDate)).sort((s,a)=>!s.formattedStartDate||!a.formattedStartDate?0:s.formattedStartDate.isBefore(a.formattedStartDate)?-1:1),H=re(m,y);return u||w||T?e.jsx(C,{pt:12,fluid:!0,maw:1232,children:e.jsx(B,{h:400,children:e.jsxs(x,{align:"center",children:[e.jsx(O,{size:"lg"}),e.jsx(n,{children:"Loading dashboard..."})]})})}):p?e.jsx(C,{pt:12,fluid:!0,maw:1232,children:e.jsxs(n,{color:"red",children:["Error loading dashboard: ",p.message]})}):e.jsx(C,{pt:12,fluid:!0,maw:1232,h:"200",children:e.jsxs(x,{children:[e.jsx(f,{fz:"24px",order:2,children:"Dashboard"}),e.jsxs(A,{gutter:"md",w:"100%",children:[e.jsx(A.Col,{span:8,children:e.jsxs(x,{children:[e.jsxs(o,{justify:"space-between",gap:"md",w:"100%",children:[e.jsx(D,{withBorder:!0,radius:"md",p:"md",h:100,style:{flex:1},children:e.jsx(o,{justify:"space-between",align:"center",h:"100%",children:e.jsxs(x,{gap:"xs",children:[e.jsxs(o,{gap:"xs",children:[e.jsx(M,{size:20,color:"var(--mantine-color-green-6)"}),e.jsx(f,{order:3,fz:"16px",c:"dimmed",children:"Today's Appointments"})]}),e.jsx(n,{fz:"24px",fw:700,c:"green",children:S.length})]})})}),e.jsx(D,{withBorder:!0,radius:"md",p:"md",h:100,style:{flex:1},children:e.jsx(o,{justify:"space-between",align:"center",h:"100%",children:e.jsxs(x,{gap:"xs",children:[e.jsxs(o,{gap:"xs",children:[e.jsx(M,{size:20,color:"var(--mantine-color-blue-6)"}),e.jsx(f,{order:3,fz:"16px",c:"dimmed",children:"Total Appointments"})]}),e.jsx(n,{fz:"24px",fw:700,c:"blue",children:i.length})]})})})]}),e.jsxs(D,{withBorder:!0,radius:"md",p:"md",h:500,children:[e.jsxs(o,{justify:"space-between",align:"center",mb:"md",children:[e.jsx(o,{children:e.jsx(f,{order:3,fz:"18px",children:"Upcoming Appointments"})}),e.jsx(F,{onClick:b,leftSection:e.jsx(J,{size:16}),variant:"outline",size:"md",radius:"xl",fw:500,children:"New Appointment"})]}),e.jsx(G,{style:{overflowY:"auto",height:"calc(100% - 60px)"},className:N.autoHideScrollbar,children:e.jsx(ee,{appointments:z})})]})]})}),e.jsx(A.Col,{span:4,children:e.jsxs(D,{withBorder:!0,radius:"md",p:"md",h:616,children:[e.jsx(o,{mb:"xs",children:e.jsx(f,{order:4,fz:"lg",children:"Available Doctors"})}),e.jsx(x,{gap:"sm",style:{overflowY:"auto",height:"calc(100% - 40px)"},className:N.autoHideScrollbar,children:H.map(s=>e.jsxs(o,{style:{cursor:"pointer",padding:"8px",borderRadius:"8px",transition:"background-color 0.2s ease"},gap:"xs",onClick:()=>g(s.id),onMouseEnter:a=>{a.currentTarget.style.backgroundColor="var(--mantine-color-gray-1)"},onMouseLeave:a=>{a.currentTarget.style.backgroundColor="transparent"},children:[e.jsx(R,{color:"#e7edf6",style:{cursor:"pointer"},size:"md",radius:"xl",variant:"filled",children:e.jsx(n,{fz:"sm",children:Z({fullName:s.name})})}),e.jsxs(x,{gap:"0",children:[e.jsxs(n,{fw:500,truncate:!0,children:["Dr. ",s.name]}),e.jsx(n,{size:"sm",c:"dimmed",truncate:!0,children:s.clinicName})]})]},s.id))})]})})]}),e.jsx(Q,{opened:j,onClose:r})]})})}export{he as default};
