import{q as fe,u as he,F as Me,a as Ie,W as We,r as y,s as Ke,j as e,G as Q,v as Oe,X as Ue,c as Ve,D as Ee,Y as Ze,Z as Ge,_ as Je,U as Ye,y as Fe,$ as He,a0 as Se,a1 as Qe,B as xe,a2 as we,a3 as Xe,g as es,a4 as ss,z as ts,d as rs,H as as,C as os,t as is,O as ns,P as ls,Q as cs,R as ds,h as Y,f as ue,L as K,e as H,J as Ce,K as pe,n as je,V as Pe,a5 as me,M as z}from"./index-ZwLsdpq7.js";import{u as us,A as Ne,I as T}from"./useStore-DNo-CAzB.js";import{u as ps}from"./use-form-D7qxXVJX.js";import{g as ms}from"./get-auto-contrast-value-Da6zqqWm.js";function O(n,o){if(n<1)return[];const v=new Array(n).fill("");if(o){const p=o.trim().split("");for(let h=0;h<Math.min(n,p.length);h+=1)v[h]=p[h]===" "?"":p[h]}return v}var _e={root:"m_f1cb205a",pinInput:"m_cb288ead"};const ze={number:/^[0-9]+$/,alphanumeric:/^[a-zA-Z0-9]+$/i},Re={gap:"sm",length:4,manageFocus:!0,oneTimeCode:!0,placeholder:"○",type:"alphanumeric",ariaLabel:"PinInput"},fs=Ve((n,{size:o})=>({root:{"--pin-input-size":Ee(o??Re.size,"pin-input-size")}})),ge=fe((n,o)=>{const{name:v,form:p,className:h,value:g,defaultValue:j,variant:b,gap:S,style:R,size:w,classNames:m,styles:I,unstyled:P,length:d,onChange:r,onComplete:k,manageFocus:q,autoFocus:C,error:A,radius:s,disabled:c,oneTimeCode:U,placeholder:Z,type:l,mask:G,readOnly:f,inputType:$,inputMode:V,ariaLabel:L,vars:ne,id:le,hiddenInputProps:ce,rootRef:X,getInputProps:M,...ee}=he("PinInput",Re,n),W=Me(le),E=Ie({name:"PinInput",classes:_e,props:n,className:h,style:R,classNames:m,styles:I,unstyled:P,vars:ne,varsResolver:fs}),{resolvedClassNames:F,resolvedStyles:N}=We({classNames:m,styles:I,props:n}),[se,te]=y.useState(-1),[_,J]=Ke({value:g?O(d??0,g):void 0,defaultValue:j==null?void 0:j.split("").slice(0,d??0),finalValue:O(d??0,""),onChange:typeof r=="function"?i=>{r(i.join("").trim())}:void 0}),re=_.join("").trim(),de=y.useRef([]),be=i=>{const t=l instanceof RegExp?l:l&&l in ze?ze[l]:null;return t==null?void 0:t.test(i)},B=(i,t,a)=>{if(!q){a==null||a.preventDefault();return}if(i==="next"){const x=t+1;x<(d??0)&&(a==null||a.preventDefault(),de.current[x].focus())}if(i==="prev"){const x=t-1;x>-1&&(a==null||a.preventDefault(),de.current[x].focus())}},ae=(i,t)=>{const a=[..._];a[t]=i,J(a)},ke=(i,t)=>{const a=i.target.value,x=a.length===2?a.split("")[a.length-1]:a,u=be(x);x.length<2?u?(ae(x,t),B("next",t)):ae("",t):u&&J(O(d??0,a))},Ae=(i,t)=>{const{ctrlKey:a,metaKey:x,key:u,shiftKey:Le,target:Be}=i,$e=Be.value;V==="numeric"&&(u==="Backspace"||u==="Tab"||u==="Control"||u==="Delete"||a&&u==="v"||x&&u==="v"||!Number.isNaN(Number(u))||i.preventDefault()),u==="ArrowLeft"||Le&&u==="Tab"?B("prev",t,i):u==="ArrowRight"||u==="Tab"||u===" "?B("next",t,i):u==="Delete"?ae("",t):u==="Backspace"?t!==0&&(ae("",t),d===t+1?i.target.value===""&&B("prev",t,i):B("prev",t,i)):$e.length>0&&u===_[t]&&B("next",t,i)},Te=(i,t)=>{i.target.select(),te(t)},De=()=>{te(-1)},qe=i=>{i.preventDefault();const t=i.clipboardData.getData("text/plain").replace(/[\n\r\s]+/g,"");if(be(t.trim())){const x=O(d??0,t);J(x),B("next",x.length-2)}};return y.useEffect(()=>{re.length===d&&(k==null||k(re))},[d,re]),y.useEffect(()=>{d!==_.length&&J(O(d??0,_.join("")))},[d,_]),y.useEffect(()=>{g===""&&J(O(d??0,g))},[g]),y.useEffect(()=>{c&&te(-1)},[c]),e.jsxs(e.Fragment,{children:[e.jsx(Q,{...ee,...E("root"),ref:X,role:"group",id:W,gap:S,unstyled:P,wrap:"nowrap",variant:b,__size:w,dir:"ltr",children:_.map((i,t)=>y.createElement(Oe,{component:"input",...E("pinInput",{style:{"--input-padding":"0","--input-text-align":"center"}}),classNames:F,styles:N,size:w,__staticSelector:"PinInput",id:`${W}-${t+1}`,key:`${W}-${t}`,inputMode:V||(l==="number"?"numeric":"text"),onChange:a=>ke(a,t),onKeyDown:a=>Ae(a,t),onFocus:a=>Te(a,t),onBlur:De,onPaste:qe,type:$||(G?"password":l==="number"?"tel":"text"),radius:s,error:A,variant:b,disabled:c,ref:a=>{t===0&&Ue(o,a),de.current[t]=a},autoComplete:U?"one-time-code":"off",placeholder:se===t?"":Z,value:i,autoFocus:C&&t===0,unstyled:P,"aria-label":L,readOnly:f,...M==null?void 0:M(t)}))}),e.jsx("input",{type:"hidden",name:v,form:p,value:re,...ce})]})});ge.classes={..._e,...Ze.classes};ge.displayName="@mantine/core/PinInput";const[hs,gs]=Ge("Stepper component was not found in tree"),ie=()=>null;ie.displayName="@mantine/core/StepperCompleted";var ye={root:"m_cbb4ea7e",steps:"m_aaf89d0b",separator:"m_2a371ac9",content:"m_78da155d",step:"m_cbb57068","step--horizontal":"m_f56b1e2c","step--vertical":"m_833edb7e",verticalSeparator:"m_6496b3f3",stepWrapper:"m_818e70b",stepIcon:"m_1959ad01",stepCompletedIcon:"m_a79331dc",stepBody:"m_1956aa2a",stepLabel:"m_12051f6c",stepDescription:"m_164eea74"};const oe=(n,o)=>typeof n=="function"?e.jsx(n,{step:o||0}):n,ys={withIcon:!0,allowStepClick:!0,iconPosition:"left"},ve=fe((n,o)=>{const{classNames:v,className:p,style:h,styles:g,vars:j,step:b,state:S,color:R,icon:w,completedIcon:m,progressIcon:I,label:P,description:d,withIcon:r,iconSize:k,loading:q,allowStepClick:C,allowStepSelect:A,iconPosition:s,orientation:c,mod:U,...Z}=he("StepperStep",ys,n),l=gs(),G=Je(),f={classNames:v,styles:g},$=S==="stepCompleted"?null:S==="stepProgress"?I:w,V={"data-progress":S==="stepProgress"||void 0,"data-completed":S==="stepCompleted"||void 0};return e.jsxs(Ye,{...l.getStyles("step",{className:p,style:h,variant:l.orientation,...f}),mod:[{"icon-position":s||l.iconPosition,"allow-click":C},U],ref:o,...V,...Z,__vars:{"--step-color":R?Fe(R,G):void 0},tabIndex:C?0:-1,children:[r&&e.jsxs("span",{...l.getStyles("stepWrapper",f),children:[e.jsxs("span",{...l.getStyles("stepIcon",f),...V,children:[e.jsx(He,{mounted:S==="stepCompleted",transition:"pop",duration:200,children:L=>e.jsx("span",{...l.getStyles("stepCompletedIcon",{style:L,...f}),children:q?e.jsx(Se,{color:"var(--mantine-color-white)",size:"calc(var(--stepper-icon-size) / 2)",...l.getStyles("stepLoader",f)}):oe(m,b)||e.jsx(Qe,{size:"60%"})})}),S!=="stepCompleted"?q?e.jsx(Se,{...l.getStyles("stepLoader",f),size:"calc(var(--stepper-icon-size) / 2)",color:R}):oe($||w,b):null]}),c==="vertical"&&e.jsx("span",{...l.getStyles("verticalSeparator",f),"data-active":S==="stepCompleted"||void 0})]}),(P||d)&&e.jsxs("span",{...l.getStyles("stepBody",f),"data-orientation":l.orientation,"data-icon-position":s||l.iconPosition,children:[P&&e.jsx("span",{...l.getStyles("stepLabel",f),children:oe(P,b)}),d&&e.jsx("span",{...l.getStyles("stepDescription",f),children:oe(d,b)})]})]})});ve.classes=ye;ve.displayName="@mantine/core/StepperStep";const vs={orientation:"horizontal",iconPosition:"left",allowNextStepsSelect:!0,wrap:!0},bs=Ve((n,{color:o,iconSize:v,size:p,contentPadding:h,radius:g,autoContrast:j})=>({root:{"--stepper-color":o?Fe(o,n):void 0,"--stepper-icon-color":ms(j,n)?ts({color:o,theme:n,autoContrast:j}):void 0,"--stepper-icon-size":v===void 0?Ee(p,"stepper-icon-size"):ss(v),"--stepper-content-padding":we(h),"--stepper-radius":g===void 0?void 0:es(g),"--stepper-fz":Xe(p),"--stepper-spacing":we(p)}})),D=fe((n,o)=>{var M,ee,W;const v=he("Stepper",vs,n),{classNames:p,className:h,style:g,styles:j,unstyled:b,vars:S,children:R,onStepClick:w,active:m,icon:I,completedIcon:P,progressIcon:d,color:r,iconSize:k,contentPadding:q,orientation:C,iconPosition:A,size:s,radius:c,allowNextStepsSelect:U,wrap:Z,autoContrast:l,...G}=v,f=Ie({name:"Stepper",classes:ye,props:v,className:h,style:g,classNames:p,styles:j,unstyled:b,vars:S,varsResolver:bs}),$=y.Children.toArray(R),V=$.filter(E=>E.type!==ie),L=$.find(E=>E.type===ie),ne=V.reduce((E,F,N)=>{const se=m===N?"stepProgress":m>N?"stepCompleted":"stepInactive",_=typeof w!="function"?!1:typeof F.props.allowStepSelect=="boolean"?F.props.allowStepSelect:se==="stepCompleted"||U;return E.push(y.cloneElement(F,{icon:F.props.icon||I||N+1,key:N,step:N,state:se,onClick:()=>_&&(w==null?void 0:w(N)),allowStepClick:_,completedIcon:F.props.completedIcon||P,progressIcon:F.props.progressIcon||d,color:F.props.color||r,iconSize:k,iconPosition:F.props.iconPosition||A,orientation:C})),C==="horizontal"&&N!==V.length-1&&E.push(y.createElement("div",{...f("separator"),"data-active":N<m||void 0,"data-orientation":C,key:`separator-${N}`})),E},[]),le=(ee=(M=V[m])==null?void 0:M.props)==null?void 0:ee.children,ce=(W=L==null?void 0:L.props)==null?void 0:W.children,X=m>V.length-1?ce:le;return e.jsx(hs,{value:{getStyles:f,orientation:C,iconPosition:A},children:e.jsxs(xe,{...f("root"),ref:o,size:s,...G,children:[e.jsx(xe,{...f("steps"),mod:{orientation:C,"icon-position":A,wrap:Z&&C!=="vertical"},children:ne}),X&&e.jsx("div",{...f("content"),children:X})]})})});D.classes=ye;D.displayName="@mantine/core/Stepper";D.Completed=ie;D.Step=ve;const Ps=()=>{const n=rs(),o=us(s=>s.isLoading),{handleRegister:v}=as(),[p,h]=y.useState(0),[g,j]=y.useState(""),[b,S]=y.useState(!1),[R,w]=y.useState(!1),[m,I]=y.useState(0),[P,d]=y.useState(!1),r=ps({initialValues:{email:"",password:"",firstName:"",lastName:"",confirmPassword:"",address:"",phoneNumber:""},validate:{email:s=>s?/^\S+@\S+$/.test(s)?null:"Invalid email address":"Email is required",password:s=>s?s.length<6?"Password must be at least 6 characters":/[A-Z]/.test(s)?/[a-z]/.test(s)?/[0-9]/.test(s)?null:"Password must contain at least one number":"Password must contain at least one lowercase letter":"Password must contain at least one uppercase letter":"Password is required",confirmPassword:(s,c)=>s!==c.password?"Passwords do not match":s?null:"Please confirm your password",firstName:s=>s?null:"First Name is required",lastName:s=>s?null:"Last Name is required",address:s=>s?null:"Address is required",phoneNumber:s=>s?null:"Phone Number is required"}});y.useEffect(()=>{if(m>0){const s=setTimeout(()=>I(m-1),1e3);return()=>clearTimeout(s)}},[m]);const k=async()=>{if(!r.validateField("email").hasError)try{const c=await me.sendVerificationCode(r.values.email);c.success?(h(1),I(60),z.show({title:"Code Sent",message:c.message,color:"green",icon:e.jsx(pe,{size:16})})):z.show({title:"Error",message:c.error,color:"red",icon:e.jsx(T,{size:16})})}catch{z.show({title:"Error",message:"Failed to send verification code. Please try again.",color:"red",icon:e.jsx(T,{size:16})})}},q=async()=>{if(g.length!==6){z.show({title:"Invalid Code",message:"Please enter a 6-digit verification code",color:"red",icon:e.jsx(T,{size:16})});return}S(!0);try{const s=await me.verifyCode(r.values.email,g);s.success?(d(!0),h(2),z.show({title:"Email Verified",message:"Email verified successfully! Complete your registration.",color:"green",icon:e.jsx(je,{size:16})})):z.show({title:"Verification Failed",message:s.error,color:"red",icon:e.jsx(T,{size:16})})}catch{z.show({title:"Error",message:"An unexpected error occurred. Please try again.",color:"red",icon:e.jsx(T,{size:16})})}S(!1)},C=async()=>{if(!(m>0)){w(!0);try{const s=await me.sendVerificationCode(r.values.email);s.success?(z.show({title:"Code Sent",message:s.message,color:"green",icon:e.jsx(pe,{size:16})}),I(60)):z.show({title:"Error",message:s.error,color:"red",icon:e.jsx(T,{size:16})})}catch{z.show({title:"Error",message:"Failed to resend verification code. Please try again.",color:"red",icon:e.jsx(T,{size:16})})}w(!1)}},A=async s=>{if(!P){z.show({title:"Email Not Verified",message:"Please verify your email before completing registration.",color:"red",icon:e.jsx(T,{size:16})});return}try{const c=await v({email:s.email,password:s.password,firstName:s.firstName,lastName:s.lastName,confirmPassword:s.confirmPassword,address:s.address,phoneNumber:s.phoneNumber});if(!(c!=null&&c.success))throw new Error((c==null?void 0:c.error)||"Registration failed")}catch(c){console.error("Registration error:",c)}};return e.jsxs(os,{w:"100vw",h:"100vh",fluid:!0,bg:is.backgroundColor,children:[e.jsx(ns,{h:"50"}),e.jsxs(ls,{withBorder:!0,shadow:"md",radius:"lg",p:"xl",mx:"auto",w:"500",children:[e.jsx(cs,{visible:o||b,overlayProps:{blur:2}}),e.jsx(Q,{pb:"md",justify:"center",children:e.jsx(ds,{height:60,width:60,onClick:()=>n("/"),style:{cursor:"pointer"}})}),e.jsx(Y,{size:"30px",ta:"center",mb:"md",fw:500,children:"Create an account"}),e.jsxs(D,{active:p,breakpoint:"sm",mb:"xl",children:[e.jsx(D.Step,{label:"Email",description:"Enter your email",children:"Step 1: Email verification"}),e.jsx(D.Step,{label:"Verify",description:"Verify code",children:"Step 2: Email verification"}),e.jsx(D.Step,{label:"Complete",description:"Finish registration",children:"Step 3: Complete registration"})]}),p===0&&e.jsxs(ue,{gap:"lg",children:[e.jsx(K,{size:"md",required:!0,label:"Email",placeholder:"your@email.com",value:r.values.email,onChange:s=>r.setFieldValue("email",s.currentTarget.value),error:r.errors.email,radius:"md",disabled:o}),e.jsx(H,{size:"lg",radius:"xl",fullWidth:!0,onClick:k,loading:o,disabled:!r.values.email,children:"Send Verification Code"}),e.jsxs(Y,{ta:"center",size:"sm",children:["Already have an account?"," ",e.jsx(Ne,{component:"button",type:"button",onClick:()=>n("/login"),fw:500,disabled:o,children:"Sign in"})]})]}),p===1&&e.jsxs(ue,{gap:"lg",children:[e.jsxs(Ce,{icon:e.jsx(pe,{size:16}),variant:"light",children:["We've sent a 6-digit verification code to"," ",e.jsx(Y,{component:"span",fw:500,children:r.values.email}),". Please check your inbox."]}),e.jsx(Q,{justify:"center",children:e.jsx(ge,{length:6,value:g,onChange:j,size:"lg",type:"number",placeholder:"○",disabled:b})}),e.jsx(H,{size:"lg",radius:"xl",fullWidth:!0,onClick:q,loading:b,disabled:g.length!==6,children:"Verify Code"}),e.jsxs(Q,{justify:"center",gap:"xs",children:[e.jsx(Y,{size:"sm",c:"dimmed",children:"Didn't receive the code?"}),e.jsx(H,{variant:"subtle",size:"sm",onClick:C,loading:R,disabled:m>0,children:m>0?`Resend in ${m}s`:"Resend Code"})]}),e.jsx(H,{variant:"subtle",onClick:()=>h(0),disabled:b,children:"← Change Email"})]}),p===2&&e.jsx("form",{onSubmit:r.onSubmit(A),children:e.jsxs(ue,{gap:"md",children:[e.jsx(Ce,{icon:e.jsx(je,{size:16}),color:"green",variant:"light",mb:"md",children:"Email verified successfully! Complete your registration below."}),e.jsxs(Q,{grow:!0,children:[e.jsx(K,{size:"md",required:!0,label:"First Name",placeholder:"e.g. John",value:r.values.firstName,onChange:s=>r.setFieldValue("firstName",s.currentTarget.value),error:r.errors.firstName,radius:"md",disabled:o}),e.jsx(K,{size:"md",required:!0,label:"Last Name",placeholder:"e.g. Doe",value:r.values.lastName,onChange:s=>r.setFieldValue("lastName",s.currentTarget.value),error:r.errors.lastName,radius:"md",disabled:o})]}),e.jsx(K,{size:"md",required:!0,label:"Phone Number",placeholder:"e.g. 09123456789",value:r.values.phoneNumber,onChange:s=>r.setFieldValue("phoneNumber",s.currentTarget.value),error:r.errors.phoneNumber,radius:"md",disabled:o}),e.jsx(K,{size:"md",required:!0,label:"Address",placeholder:"e.g. Main St, Nablus, Palestine",value:r.values.address,onChange:s=>r.setFieldValue("address",s.currentTarget.value),error:r.errors.address,radius:"md",disabled:o}),e.jsx(K,{size:"md",required:!0,label:"Email",value:r.values.email,radius:"md",disabled:!0}),e.jsx(Pe,{size:"md",required:!0,label:"Password",placeholder:"Your password",value:r.values.password,onChange:s=>r.setFieldValue("password",s.currentTarget.value),error:r.errors.password,radius:"md",disabled:o}),e.jsx(Pe,{size:"md",required:!0,label:"Confirm Password",placeholder:"Confirm your password",value:r.values.confirmPassword,onChange:s=>r.setFieldValue("confirmPassword",s.currentTarget.value),error:r.errors.confirmPassword,radius:"md",disabled:o}),e.jsx(H,{mt:"lg",type:"submit",radius:"xl",size:"lg",fullWidth:!0,loading:o,children:"Complete Registration"}),e.jsxs(Y,{ta:"center",size:"sm",children:["Already have an account?"," ",e.jsx(Ne,{component:"button",type:"button",onClick:()=>n("/login"),fw:500,disabled:o,children:"Sign in"})]})]})})]})]})};export{Ps as default};
