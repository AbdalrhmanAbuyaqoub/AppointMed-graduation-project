import{r as v,j as e,h as B,T as a,G as i,ad as c,E as I,d as E,ae as P,C,f as x,V as G,P as D,e as O,B as U,a3 as R,a4 as W}from"./index-2K_n1FRf.js";import{u as L}from"./useAppointmentQueries-CC2S5nxJ.js";import{u as _}from"./useDoctorQueries-MuxkZPR3.js";import{u as F,d,a as Q,t as V}from"./useWorkingHoursQueries-DaXu6suH.js";import{I as $,A as q,C as J}from"./AppointmentDetailsDrawer-CV9aREuf.js";import{T as t}from"./Table-DYjjwA0n.js";import{B as K}from"./Badge-CBwcfUsd.js";import{A as X}from"./ActionIcon-pWppweKH.js";import{T as g}from"./Title-Clypw5uz.js";import{G as A}from"./Grid-B53yBcyN.js";import{I as M}from"./IconCalendar-BZonq4jF.js";import{I as Z}from"./IconPlus-6iykoS9v.js";import"./useQuery-CVFAupRI.js";import"./useMutation-BDHTUPci.js";import"./appointmentService-DmIbX8yT.js";import"./useClinicQueries-BbViY6Ep.js";import"./useUserQueries-CANe7j8e.js";import"./use-form-DFhBqMe-.js";import"./Select-DxHxNxY-.js";import"./CheckIcon-D-4r5XSn.js";import"./Divider-D6wSKOoh.js";import"./SimpleGrid-YyUncImV.js";import"./use-isomorphic-layout-effect.browser.esm-C24j9-jA.js";import"./IconCheck-BTsRsjRA.js";import"./IconTrash-CpIZs9JE.js";import"./IconEdit-B4QlTEb9.js";function ee({appointments:l=[]}){const[m,h]=v.useState(null),[p,u]=v.useState(!1),{updateAppointmentStatus:w}=L(),y={0:"Scheduled",1:"Cancelled",2:"Completed",3:"No Show"},T={0:"blue",1:"red",2:"green",3:"orange"},j=async(r,f)=>{try{const n=await w.mutateAsync({appointmentId:r,newStatus:f});I.show({title:"Success",message:n.message||"Appointment status updated successfully",color:"green"})}catch(n){I.show({title:"Error",message:n.message||"Failed to update appointment status",color:"red"})}},b=r=>{h(r),u(!0)};return l.length===0?e.jsx(B,{h:200,children:e.jsx(a,{size:"lg",fw:500,c:"dimmed",children:"No appointments scheduled for today"})}):e.jsxs(e.Fragment,{children:[e.jsxs(t,{verticalSpacing:"sm",highlightOnHover:!0,mt:15,children:[e.jsx(t.Thead,{children:e.jsxs(t.Tr,{children:[e.jsx(t.Th,{c:"dimmed",children:"ID"}),e.jsx(t.Th,{c:"dimmed",children:"Patient"}),e.jsx(t.Th,{c:"dimmed",children:"Doctor"}),e.jsx(t.Th,{c:"dimmed",children:"Time"}),e.jsx(t.Th,{c:"dimmed",children:"Status"})]})}),e.jsx(t.Tbody,{children:l.map(r=>{const f=r.status,n=y[f]||"Scheduled",S=T[f]||"blue";return e.jsxs(t.Tr,{style:{cursor:"pointer"},onClick:()=>b(r),children:[e.jsx(t.Td,{children:r.id}),e.jsx(t.Td,{children:e.jsx(a,{size:"sm",children:r.patientName})}),e.jsx(t.Td,{children:e.jsxs(a,{size:"sm",children:["Dr. ",r.doctorName]})}),e.jsx(t.Td,{children:e.jsx(a,{size:"sm",children:r.displayTime})}),e.jsx(t.Td,{children:e.jsx(K,{size:"sm",color:S,children:n})}),e.jsx(t.Td,{children:e.jsx(i,{gap:"xs",onClick:z=>z.stopPropagation(),children:e.jsxs(c,{shadow:"md",width:200,children:[e.jsx(c.Target,{children:e.jsx(X,{variant:"subtle",color:"gray",children:e.jsx($,{size:16})})}),e.jsxs(c.Dropdown,{children:[e.jsx(c.Label,{children:"Update Status"}),e.jsx(c.Item,{onClick:()=>j(r.id,0),color:"blue",children:"Mark as Scheduled"}),e.jsx(c.Item,{onClick:()=>j(r.id,1),color:"red",children:"Mark as Cancelled"}),e.jsx(c.Item,{onClick:()=>j(r.id,2),color:"green",children:"Mark as Completed"}),e.jsx(c.Item,{onClick:()=>j(r.id,3),color:"orange",children:"Mark as No Show"})]})]})})})]},r.id)})})]}),e.jsx(q,{opened:p,onClose:()=>u(!1),appointment:m})]})}const se="_autoHideScrollbar_uhlgo_2",N={autoHideScrollbar:se};d.extend(Q);d.extend(V);const Y=l=>{const m=d().tz(d.tz.guess()).format("YYYY-MM-DD"),h=d.utc(l).tz(d.tz.guess()).format("YYYY-MM-DD");return m===h},re=(l,m)=>{const h=d().day();return l.filter(p=>{const u=m[p.id]||[];return u.length===0?!0:u.includes(h)})};function ve(){const l=E(),{appointments:m,isLoadingAppointments:h,appointmentsError:p}=L(),{doctors:u,isLoading:w}=_(),{doctorsWorkingDays:y,isLoading:T}=F(),[j,{open:b,close:r}]=P(!1),f=s=>{l(`/doctors/${s}`)},n=(m||[]).map(s=>{var k;const o=s.startDate?d.utc(s.startDate).tz(d.tz.guess()):null;return{...s,formattedStartDate:o,doctorName:((k=s.doctor)==null?void 0:k.name)||"N/A",displayDate:(o==null?void 0:o.format("MMM D, YYYY"))||"Invalid Date",displayTime:(o==null?void 0:o.format("hh:mm A"))||"Invalid Time"}}),S=n.filter(s=>s.formattedStartDate&&Y(s.startDate)),z=n.filter(s=>s.formattedStartDate&&Y(s.startDate)).sort((s,o)=>!s.formattedStartDate||!o.formattedStartDate?0:s.formattedStartDate.isBefore(o.formattedStartDate)?-1:1),H=re(u,y);return h||w||T?e.jsx(C,{pt:12,fluid:!0,maw:1232,children:e.jsx(B,{h:400,children:e.jsxs(x,{align:"center",children:[e.jsx(G,{size:"lg"}),e.jsx(a,{children:"Loading dashboard..."})]})})}):p?e.jsx(C,{pt:12,fluid:!0,maw:1232,children:e.jsxs(a,{color:"red",children:["Error loading dashboard: ",p.message]})}):e.jsx(C,{pt:12,fluid:!0,maw:1232,h:"200",children:e.jsxs(x,{children:[e.jsx(g,{fz:"24px",order:2,children:"Dashboard"}),e.jsxs(A,{gutter:"md",w:"100%",children:[e.jsx(A.Col,{span:8,children:e.jsxs(x,{children:[e.jsxs(i,{justify:"space-between",gap:"md",w:"100%",children:[e.jsx(D,{withBorder:!0,radius:"md",p:"md",h:100,style:{flex:1},children:e.jsx(i,{justify:"space-between",align:"center",h:"100%",children:e.jsxs(x,{gap:"xs",children:[e.jsxs(i,{gap:"xs",children:[e.jsx(M,{size:20,color:"var(--mantine-color-green-6)"}),e.jsx(g,{order:3,fz:"16px",c:"dimmed",children:"Today's Appointments"})]}),e.jsx(a,{fz:"24px",fw:700,c:"green",children:S.length})]})})}),e.jsx(D,{withBorder:!0,radius:"md",p:"md",h:100,style:{flex:1},children:e.jsx(i,{justify:"space-between",align:"center",h:"100%",children:e.jsxs(x,{gap:"xs",children:[e.jsxs(i,{gap:"xs",children:[e.jsx(M,{size:20,color:"var(--mantine-color-blue-6)"}),e.jsx(g,{order:3,fz:"16px",c:"dimmed",children:"Total Appointments"})]}),e.jsx(a,{fz:"24px",fw:700,c:"blue",children:n.length})]})})})]}),e.jsxs(D,{withBorder:!0,radius:"md",p:"md",h:500,children:[e.jsxs(i,{justify:"space-between",align:"center",mb:"md",children:[e.jsx(i,{children:e.jsx(g,{order:3,fz:"18px",children:"Upcoming Appointments"})}),e.jsx(O,{onClick:b,leftSection:e.jsx(Z,{size:16}),variant:"outline",size:"md",radius:"xl",fw:500,children:"New Appointment"})]}),e.jsx(U,{style:{overflowY:"auto",height:"calc(100% - 60px)"},className:N.autoHideScrollbar,children:e.jsx(ee,{appointments:z})})]})]})}),e.jsx(A.Col,{span:4,children:e.jsxs(D,{withBorder:!0,radius:"md",p:"md",h:616,children:[e.jsx(i,{mb:"xs",children:e.jsx(g,{order:4,fz:"lg",children:"Available Doctors"})}),e.jsx(x,{gap:"sm",style:{overflowY:"auto",height:"calc(100% - 40px)"},className:N.autoHideScrollbar,children:H.map(s=>e.jsxs(i,{style:{cursor:"pointer",padding:"8px",borderRadius:"8px",transition:"background-color 0.2s ease"},gap:"xs",onClick:()=>f(s.id),onMouseEnter:o=>{o.currentTarget.style.backgroundColor="var(--mantine-color-gray-1)"},onMouseLeave:o=>{o.currentTarget.style.backgroundColor="transparent"},children:[e.jsx(R,{color:"#e7edf6",style:{cursor:"pointer"},size:"md",radius:"xl",variant:"filled",children:e.jsx(a,{fz:"sm",children:W({fullName:s.name})})}),e.jsxs(x,{gap:"0",children:[e.jsxs(a,{fw:500,truncate:!0,children:["Dr. ",s.name]}),e.jsx(a,{size:"sm",c:"dimmed",truncate:!0,children:s.clinicName})]})]},s.id))})]})})]}),e.jsx(J,{opened:j,onClose:r})]})})}export{ve as default};
