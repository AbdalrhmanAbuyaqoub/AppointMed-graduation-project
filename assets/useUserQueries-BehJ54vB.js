import{ah as g,b4 as w,b5 as m,aj as l,K as o}from"./index-DpM1l42o.js";const h="http://app8.runasp.net/api",i=g.create({baseURL:h,headers:{"Content-Type":"application/json"}});i.interceptors.request.use(e=>{const t=localStorage.getItem("access_token");return t&&(e.headers.Authorization=`Bearer ${t}`),e},e=>Promise.reject(e));const p={sendVerificationCode:async e=>{var t,r;try{return(await i.post("/Users/send-verification-code",{email:e})).data}catch(s){throw console.error("Error sending verification code:",s),new Error(((r=(t=s.response)==null?void 0:t.data)==null?void 0:r.message)||"Failed to send verification code")}},verifyCode:async(e,t)=>{var r,s;try{return(await i.post("/Users/verify-code",{email:e,code:t})).data}catch(n){throw console.error("Error verifying code:",n),new Error(((s=(r=n.response)==null?void 0:r.data)==null?void 0:s.message)||"Failed to verify code")}},getPatients:async()=>{var e,t;try{const r=await i.get("/Users/get-ALL-patients");return r.data.isSuccess&&Array.isArray(r.data.result)?r.data.result:(console.warn("Unexpected response format from get-patients:",r.data),[])}catch(r){throw console.error("Error fetching patients:",r),new Error(((t=(e=r.response)==null?void 0:e.data)==null?void 0:t.message)||"Failed to fetch patients")}},banPatient:async e=>{var t,r;try{return(await i.post(`/Users/ban/${e}`)).data}catch(s){throw console.error("Error banning patient:",s),new Error(((r=(t=s.response)==null?void 0:t.data)==null?void 0:r.message)||"Failed to ban patient")}},unbanPatient:async e=>{var t,r;try{return(await i.post(`/Users/unban/${e}`)).data}catch(s){throw console.error("Error unbanning patient:",s),new Error(((r=(t=s.response)==null?void 0:t.data)==null?void 0:r.message)||"Failed to unban patient")}},resetPassword:async e=>{var t,r;try{return(await i.put("/Users/reset-password",e)).data}catch(s){throw console.error("Error resetting password:",s),new Error(((r=(t=s.response)==null?void 0:t.data)==null?void 0:r.message)||"Failed to reset password")}},deleteAccount:async(e,t)=>{var r,s;try{return(await i.delete(`/Users/delete-user?email=${e}&id=${t}`)).data}catch(n){throw console.error("Error deleting account:",n),new Error(((s=(r=n.response)==null?void 0:r.data)==null?void 0:s.message)||"Failed to delete account")}}};function f(){const e=w(),t=m({queryKey:["patients"],queryFn:p.getPatients,initialData:[],refetchOnMount:!0,staleTime:0,cacheTime:1e3*60*5}),r=l({mutationFn:p.banPatient,onMutate:async a=>{await e.cancelQueries({queryKey:["patients"]});const c=e.getQueryData(["patients"]);return e.setQueryData(["patients"],u=>u.map(d=>d.id===a?{...d,isBanned:!0}:d)),{previousPatients:c}},onSuccess:()=>{e.invalidateQueries({queryKey:["patients"]}),o.show({title:"Success",message:"Patient has been banned",color:"red"})},onError:(a,c,u)=>{e.setQueryData(["patients"],u.previousPatients),o.show({title:"Error",message:a.message||"Failed to ban patient",color:"red"})}}),s=l({mutationFn:p.unbanPatient,onMutate:async a=>{await e.cancelQueries({queryKey:["patients"]});const c=e.getQueryData(["patients"]);return e.setQueryData(["patients"],u=>u.map(d=>d.id===a?{...d,isBanned:!1}:d)),{previousPatients:c}},onSuccess:()=>{e.invalidateQueries({queryKey:["patients"]}),o.show({title:"Success",message:"Patient has been unbanned",color:"green"})},onError:(a,c,u)=>{e.setQueryData(["patients"],u.previousPatients),o.show({title:"Error",message:a.message||"Failed to unban patient",color:"red"})}}),n=l({mutationFn:p.resetPassword,onSuccess:()=>{o.show({title:"Success",message:"Password reset successfully",color:"green"})},onError:a=>{o.show({title:"Error",message:a.message||"Failed to reset password",color:"red"})}}),y=l({mutationFn:({email:a,id:c})=>p.deleteAccount(a,c),onSuccess:()=>{o.show({title:"Success",message:"Account deleted successfully",color:"green"})},onError:a=>{o.show({title:"Error",message:a.message||"Failed to delete account",color:"red"})}});return{patients:t.data||[],isLoading:t.isLoading,isError:t.isError,error:t.error,refetch:t.refetch,banPatient:r.mutate,unbanPatient:s.mutate,updateProfile:updateProfileMutation.mutate,resetPassword:n.mutate,deleteAccount:y.mutate,isUpdatingProfile:updateProfileMutation.isPending,isResettingPassword:n.isPending,isDeletingAccount:y.isPending}}export{f as u};
