import{j as s,C as K,S as d,P as Q,G as t,A as H,Y as f,K as S,T as i,D as U,a0 as V,F as m,W as M,ac as p,aa as X,n as Z}from"./ui-DwlZS5FE.js";import{r as h}from"./router-DP3ythCP.js";import{u as $,g as ee,j as k,n as c,k as L}from"./chat-DfZj3kwJ.js";import{f as se}from"./appointments-D_E_DIOB.js";import{L as re,c as ae,s as oe,h as ie,u as te,M as le,n as ne,N as de}from"./icons-CEIuXgFH.js";import"./vendor-DJG_os-6.js";import"./query-CPQchYQR.js";const R=g=>{try{if(!g)return null;const n=g.split(".");if(n.length!==3)return null;const e=JSON.parse(atob(n[1]));return console.log("Decoded token payload:",e),e}catch(n){return console.error("Error decoding token:",n),null}};function fe({isModal:g=!1,onClose:n}){var E,v,C,y,z,I,A,b,D;const{user:e,handleLogout:T}=$(),{resetPasswordWithToken:F,deleteAccount:j,isResettingPassword:O,isDeletingAccount:q}=se();h.useEffect(()=>{},[e]);const[B,w]=h.useState(!1),[G,u]=h.useState(!1),[o,x]=h.useState({oldPassword:"",newPassword:"",confirmNewPassword:""}),[P,W]=h.useState(""),_=()=>{if(e!=null&&e.id)return e.id;if(e!=null&&e.userId)return e.userId;if(e!=null&&e.user_id)return e.user_id;const a=L(),r=R(a);return(r==null?void 0:r.nameid)||(r==null?void 0:r.userId)||(r==null?void 0:r.sub)||(r==null?void 0:r.id)},N=()=>{if(e!=null&&e.email)return e.email;const a=L(),r=R(a);return(r==null?void 0:r.email)||(r==null?void 0:r.unique_name)},Y=async a=>{if(a.preventDefault(),o.newPassword!==o.confirmNewPassword){c.show({title:"Error",message:"New passwords do not match",color:"red"});return}if(o.newPassword.length<6){c.show({title:"Error",message:"Password must be at least 6 characters long",color:"red"});return}const r=N();if(!r){c.show({title:"Error",message:"User email is missing. Please try logging out and logging back in.",color:"red"});return}try{const l={email:r,oldPassword:o.oldPassword,newPassword:o.newPassword,confirmNewPassword:o.confirmNewPassword};console.log("Password reset data being sent:",l),await F(l),w(!1),x({oldPassword:"",newPassword:"",confirmNewPassword:""})}catch(l){console.error("Password reset failed:",l)}},J=async()=>{if(P!=="DELETE"){c.show({title:"Error",message:'Please type "DELETE" to confirm account deletion',color:"red"});return}const a=N(),r=_();if(!a){c.show({title:"Error",message:"User email is missing. Please try logging out and logging back in.",color:"red"});return}try{r?await j({email:a,id:r}):await j({email:a,id:""}),c.show({title:"Success",message:"Account deleted successfully. You will be logged out.",color:"green"}),u(!1),g&&n&&n(),setTimeout(async()=>{try{await T()}catch{window.location.href="/login"}},1500)}catch(l){c.show({title:"Error",message:l.message||"Failed to delete account",color:"red"})}};return s.jsx(K,{size:"lg",py:"xl",children:s.jsxs(d,{gap:"xl",children:[s.jsx(Q,{p:"xl",radius:"md",withBorder:!0,children:s.jsxs(d,{gap:"xl",children:[s.jsxs(t,{gap:"xl",align:"flex-start",children:[s.jsx(H,{size:"xl",radius:"xl",variant:"filled",children:ee({firstName:e==null?void 0:e.firstName,lastName:e==null?void 0:e.lastName})}),s.jsxs(d,{gap:"xs",style:{flex:1},children:[s.jsx(f,{order:2,fz:28,children:k({firstName:((E=e==null?void 0:e.firstName)==null?void 0:E.charAt(0).toUpperCase())+((v=e==null?void 0:e.firstName)==null?void 0:v.slice(1)),lastName:((C=e==null?void 0:e.lastName)==null?void 0:C.charAt(0).toUpperCase())+((y=e==null?void 0:e.lastName)==null?void 0:y.slice(1))})}),s.jsxs(t,{gap:"md",children:[s.jsx(S,{size:"lg",variant:"filled",color:"blue",children:((z=e==null?void 0:e.role)==null?void 0:z.toUpperCase())||"USER"}),s.jsx(S,{size:"lg",variant:"light",color:"green",children:s.jsxs(t,{gap:"xs",children:[s.jsx(re,{size:16}),s.jsx(i,{children:"Active Account"})]})})]})]})]}),s.jsx(U,{}),s.jsxs(V,{cols:{base:1,sm:2},spacing:"xl",children:[s.jsxs(d,{gap:"md",children:[s.jsx(f,{order:3,size:"h4",children:"Basic Information"}),s.jsxs(t,{gap:"md",children:[s.jsx(ae,{size:20,color:"var(--mantine-color-gray-6)"}),s.jsx(i,{size:"sm",fw:500,children:"Full Name:"}),s.jsx(i,{size:"sm",children:k({firstName:((I=e==null?void 0:e.firstName)==null?void 0:I.charAt(0).toUpperCase())+((A=e==null?void 0:e.firstName)==null?void 0:A.slice(1)),lastName:((b=e==null?void 0:e.lastName)==null?void 0:b.charAt(0).toUpperCase())+((D=e==null?void 0:e.lastName)==null?void 0:D.slice(1))})})]}),s.jsxs(t,{gap:"md",children:[s.jsx(oe,{size:20,color:"var(--mantine-color-gray-6)"}),s.jsx(i,{size:"sm",fw:500,children:"Email:"}),s.jsx(i,{size:"sm",children:(e==null?void 0:e.email)||"No email provided"})]})]}),s.jsxs(d,{gap:"md",children:[s.jsx(f,{order:3,size:"h4",children:"Contact Information"}),s.jsxs(t,{gap:"md",children:[s.jsx(ie,{size:20,color:"var(--mantine-color-gray-6)"}),s.jsx(i,{size:"sm",fw:500,children:"Phone:"}),s.jsx(i,{size:"sm",children:(e==null?void 0:e.phoneNumber)||"Not provided"})]}),s.jsxs(t,{gap:"md",children:[s.jsx(te,{size:20,color:"var(--mantine-color-gray-6)"}),s.jsx(i,{size:"sm",fw:500,children:"Address:"}),s.jsx(i,{size:"sm",children:(e==null?void 0:e.address)||"Not provided"})]})]})]}),s.jsx(U,{}),s.jsxs(t,{gap:"md",children:[s.jsx(m,{leftSection:s.jsx(le,{size:16}),onClick:()=>w(!0),variant:"outline",radius:"md",color:"blue",children:"Reset Password"}),s.jsx(m,{leftSection:s.jsx(ne,{size:16}),onClick:()=>u(!0),variant:"outline",color:"red",radius:"md",children:"Delete Account"})]})]})}),s.jsx(M,{opened:B,onClose:()=>w(!1),title:s.jsx(i,{fw:600,children:"Reset Password"}),size:"md",children:s.jsx("form",{onSubmit:Y,children:s.jsxs(d,{gap:"md",children:[s.jsx(p,{radius:"md",label:"Current Password",placeholder:"Enter current password",value:o.oldPassword,onChange:a=>x({...o,oldPassword:a.target.value}),required:!0}),s.jsx(p,{radius:"md",label:"New Password",placeholder:"Enter new password",value:o.newPassword,onChange:a=>x({...o,newPassword:a.target.value}),required:!0}),s.jsx(p,{radius:"md",label:"Confirm New Password",placeholder:"Confirm new password",value:o.confirmNewPassword,onChange:a=>x({...o,confirmNewPassword:a.target.value}),required:!0}),s.jsxs(t,{justify:"flex-end",gap:"md",children:[s.jsx(m,{variant:"outline",onClick:()=>w(!1),radius:"md",children:"Cancel"}),s.jsx(m,{type:"submit",loading:O,radius:"md",children:"Reset Password"})]})]})})}),s.jsx(M,{opened:G,onClose:()=>u(!1),title:"Delete Account",size:"md",radius:"md",children:s.jsxs(d,{gap:"md",children:[s.jsx(X,{p:"xs",icon:s.jsx(de,{size:16}),title:"Warning",color:"red",variant:"light",children:"This action cannot be undone. All your data will be permanently deleted."}),s.jsxs(i,{size:"sm",c:"dimmed",children:["To confirm deletion, please type ",s.jsx("strong",{children:"DELETE"})," in the field below:"]}),s.jsx(Z,{placeholder:"Type DELETE to confirm",value:P,onChange:a=>W(a.target.value)}),s.jsxs(t,{justify:"flex-end",gap:"md",children:[s.jsx(m,{variant:"filled",radius:"md",onClick:()=>u(!1),children:"Cancel"}),s.jsx(m,{color:"red",radius:"md",variant:"outline",loading:q,onClick:J,children:"Delete Account"})]})]})})]})})}export{fe as default};
