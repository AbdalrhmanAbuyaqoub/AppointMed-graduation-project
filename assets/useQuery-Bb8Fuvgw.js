var t,e,s,i,r,a,n,h,o,l,u,c,d,p,f,b,y,v,R,g,m,w,O,C,k,M,x=t=>{throw TypeError(t)},S=(t,e,s)=>e.has(t)||x("Cannot "+s),W=(t,e,s)=>(S(t,e,"read from private field"),s?s.call(t):e.get(t)),E=(t,e,s)=>e.has(t)?x("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,s),U=(t,e,s,i)=>(S(t,e,"write to private field"),i?i.call(t,s):e.set(t,s),s),Q=(t,e,s)=>(S(t,e,"access private method"),s);import{aS as T,aT as _,aU as I,aV as F,aW as q,aX as D,aY as P,aZ as L,a_ as A,a$ as j,b0 as H,b1 as B,b2 as z,r as K,b3 as V,aK as X}from"./index-BwajA8ZI.js";var Y=(M=class extends T{constructor(y,v){super(),E(this,b),E(this,t),E(this,e),E(this,s),E(this,i),E(this,r),E(this,a),E(this,n),E(this,h),E(this,o),E(this,l),E(this,u),E(this,c),E(this,d),E(this,p),E(this,f,new Set),this.options=v,U(this,t,y),U(this,h,null),U(this,n,_()),this.options.experimental_prefetchInRender||W(this,n).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(v)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){1===this.listeners.size&&(W(this,e).addObserver(this),Z(W(this,e),this.options)?Q(this,b,y).call(this):this.updateResult(),Q(this,b,m).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return $(W(this,e),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return $(W(this,e),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,Q(this,b,w).call(this),Q(this,b,O).call(this),W(this,e).removeObserver(this)}setOptions(s){const i=this.options,r=W(this,e);if(this.options=W(this,t).defaultQueryOptions(s),void 0!==this.options.enabled&&"boolean"!=typeof this.options.enabled&&"function"!=typeof this.options.enabled&&"boolean"!=typeof I(this.options.enabled,W(this,e)))throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");Q(this,b,C).call(this),W(this,e).setOptions(this.options),i._defaulted&&!F(this.options,i)&&W(this,t).getQueryCache().notify({type:"observerOptionsUpdated",query:W(this,e),observer:this});const a=this.hasListeners();a&&G(W(this,e),r,this.options,i)&&Q(this,b,y).call(this),this.updateResult(),!a||W(this,e)===r&&I(this.options.enabled,W(this,e))===I(i.enabled,W(this,e))&&q(this.options.staleTime,W(this,e))===q(i.staleTime,W(this,e))||Q(this,b,v).call(this);const n=Q(this,b,R).call(this);!a||W(this,e)===r&&I(this.options.enabled,W(this,e))===I(i.enabled,W(this,e))&&n===W(this,p)||Q(this,b,g).call(this,n)}getOptimisticResult(s){const n=W(this,t).getQueryCache().build(W(this,t),s),h=this.createResult(n,s);return function(t,e){if(!F(t.getCurrentResult(),e))return!0;return!1}(this,h)&&(U(this,i,h),U(this,a,this.options),U(this,r,W(this,e).state)),h}getCurrentResult(){return W(this,i)}trackResult(t,e){return new Proxy(t,{get:(t,s)=>(this.trackProp(s),null==e||e(s),Reflect.get(t,s))})}trackProp(t){W(this,f).add(t)}getCurrentQuery(){return W(this,e)}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(e){const s=W(this,t).defaultQueryOptions(e),i=W(this,t).getQueryCache().build(W(this,t),s);return i.fetch().then(()=>this.createResult(i,s))}fetch(t){return Q(this,b,y).call(this,{...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),W(this,i)))}createResult(t,c){var d;const p=W(this,e),f=this.options,b=W(this,i),y=W(this,r),v=W(this,a),R=t!==p?t.state:W(this,s),{state:g}=t;let m,w={...g},O=!1;if(c._optimisticResults){const e=this.hasListeners(),s=!e&&Z(t,c),i=e&&G(t,p,c,f);(s||i)&&(w={...w,...H(g.data,t.options)}),"isRestoring"===c._optimisticResults&&(w.fetchStatus="idle")}let{error:C,errorUpdatedAt:k,status:M}=w;m=w.data;let x=!1;if(void 0!==c.placeholderData&&void 0===m&&"pending"===M){let t;(null==b?void 0:b.isPlaceholderData)&&c.placeholderData===(null==v?void 0:v.placeholderData)?(t=b.data,x=!0):t="function"==typeof c.placeholderData?c.placeholderData(null==(d=W(this,u))?void 0:d.state.data,W(this,u)):c.placeholderData,void 0!==t&&(M="success",m=B(null==b?void 0:b.data,t,c),O=!0)}if(c.select&&void 0!==m&&!x)if(b&&m===(null==y?void 0:y.data)&&c.select===W(this,o))m=W(this,l);else try{U(this,o,c.select),m=c.select(m),m=B(null==b?void 0:b.data,m,c),U(this,l,m),U(this,h,null)}catch(q){U(this,h,q)}W(this,h)&&(C=W(this,h),m=W(this,l),k=Date.now(),M="error");const S="fetching"===w.fetchStatus,E="pending"===M,Q="error"===M,T=E&&S,I=void 0!==m,F={status:M,fetchStatus:w.fetchStatus,isPending:E,isSuccess:"success"===M,isError:Q,isInitialLoading:T,isLoading:T,data:m,dataUpdatedAt:w.dataUpdatedAt,error:C,errorUpdatedAt:k,failureCount:w.fetchFailureCount,failureReason:w.fetchFailureReason,errorUpdateCount:w.errorUpdateCount,isFetched:w.dataUpdateCount>0||w.errorUpdateCount>0,isFetchedAfterMount:w.dataUpdateCount>R.dataUpdateCount||w.errorUpdateCount>R.errorUpdateCount,isFetching:S,isRefetching:S&&!E,isLoadingError:Q&&!I,isPaused:"paused"===w.fetchStatus,isPlaceholderData:O,isRefetchError:Q&&I,isStale:J(t,c),refetch:this.refetch,promise:W(this,n)};if(this.options.experimental_prefetchInRender){const e=t=>{"error"===F.status?t.reject(F.error):void 0!==F.data&&t.resolve(F.data)},s=()=>{const t=U(this,n,F.promise=_());e(t)},i=W(this,n);switch(i.status){case"pending":t.queryHash===p.queryHash&&e(i);break;case"fulfilled":"error"!==F.status&&F.data===i.value||s();break;case"rejected":"error"===F.status&&F.error===i.reason||s()}}return F}updateResult(){const t=W(this,i),s=this.createResult(W(this,e),this.options);if(U(this,r,W(this,e).state),U(this,a,this.options),void 0!==W(this,r).data&&U(this,u,W(this,e)),F(s,t))return;U(this,i,s);Q(this,b,k).call(this,{listeners:(()=>{if(!t)return!0;const{notifyOnChangeProps:e}=this.options,s="function"==typeof e?e():e;if("all"===s||!s&&!W(this,f).size)return!0;const r=new Set(s??W(this,f));return this.options.throwOnError&&r.add("error"),Object.keys(W(this,i)).some(e=>{const s=e;return W(this,i)[s]!==t[s]&&r.has(s)})})()})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&Q(this,b,m).call(this)}},t=new WeakMap,e=new WeakMap,s=new WeakMap,i=new WeakMap,r=new WeakMap,a=new WeakMap,n=new WeakMap,h=new WeakMap,o=new WeakMap,l=new WeakMap,u=new WeakMap,c=new WeakMap,d=new WeakMap,p=new WeakMap,f=new WeakMap,b=new WeakSet,y=function(t){Q(this,b,C).call(this);let s=W(this,e).fetch(this.options,t);return(null==t?void 0:t.throwOnError)||(s=s.catch(D)),s},v=function(){Q(this,b,w).call(this);const t=q(this.options.staleTime,W(this,e));if(P||W(this,i).isStale||!L(t))return;const s=A(W(this,i).dataUpdatedAt,t);U(this,c,setTimeout(()=>{W(this,i).isStale||this.updateResult()},s+1))},R=function(){return("function"==typeof this.options.refetchInterval?this.options.refetchInterval(W(this,e)):this.options.refetchInterval)??!1},g=function(t){Q(this,b,O).call(this),U(this,p,t),!P&&!1!==I(this.options.enabled,W(this,e))&&L(W(this,p))&&0!==W(this,p)&&U(this,d,setInterval(()=>{(this.options.refetchIntervalInBackground||j.isFocused())&&Q(this,b,y).call(this)},W(this,p)))},m=function(){Q(this,b,v).call(this),Q(this,b,g).call(this,Q(this,b,R).call(this))},w=function(){W(this,c)&&(clearTimeout(W(this,c)),U(this,c,void 0))},O=function(){W(this,d)&&(clearInterval(W(this,d)),U(this,d,void 0))},C=function(){const i=W(this,t).getQueryCache().build(W(this,t),this.options);if(i===W(this,e))return;const r=W(this,e);U(this,e,i),U(this,s,i.state),this.hasListeners()&&(null==r||r.removeObserver(this),i.addObserver(this))},k=function(s){z.batch(()=>{s.listeners&&this.listeners.forEach(t=>{t(W(this,i))}),W(this,t).getQueryCache().notify({query:W(this,e),type:"observerResultsUpdated"})})},M);function Z(t,e){return function(t,e){return!1!==I(e.enabled,t)&&void 0===t.state.data&&!("error"===t.state.status&&!1===e.retryOnMount)}(t,e)||void 0!==t.state.data&&$(t,e,e.refetchOnMount)}function $(t,e,s){if(!1!==I(e.enabled,t)){const i="function"==typeof s?s(t):s;return"always"===i||!1!==i&&J(t,e)}return!1}function G(t,e,s,i){return(t!==e||!1===I(i.enabled,t))&&(!s.suspense||"error"!==t.state.status)&&J(t,s)}function J(t,e){return!1!==I(e.enabled,t)&&t.isStaleByTime(q(e.staleTime,t))}var N=K.createContext(!1);N.Provider;var tt=K.createContext(function(){let t=!1;return{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t}}()),et=(t,e,s)=>e.fetchOptimistic(t).catch(()=>{s.clearReset()});function st(t,e,s){var i,r,a,n,h;const o=X(),l=K.useContext(N),u=K.useContext(tt),c=o.defaultQueryOptions(t);null==(r=null==(i=o.getDefaultOptions().queries)?void 0:i._experimental_beforeQuery)||r.call(i,c),c._optimisticResults=l?"isRestoring":"optimistic",(t=>{const e=t.staleTime;t.suspense&&(t.staleTime="function"==typeof e?(...t)=>Math.max(e(...t),1e3):Math.max(e??1e3,1e3),"number"==typeof t.gcTime&&(t.gcTime=Math.max(t.gcTime,1e3)))})(c),((t,e)=>{(t.suspense||t.throwOnError||t.experimental_prefetchInRender)&&(e.isReset()||(t.retryOnMount=!1))})(c,u),(t=>{K.useEffect(()=>{t.clearReset()},[t])})(u);const d=!o.getQueryCache().get(c.queryHash),[p]=K.useState(()=>new e(o,c)),f=p.getOptimisticResult(c),b=!l&&!1!==t.subscribed;if(K.useSyncExternalStore(K.useCallback(t=>{const e=b?p.subscribe(z.batchCalls(t)):D;return p.updateResult(),e},[p,b]),()=>p.getCurrentResult(),()=>p.getCurrentResult()),K.useEffect(()=>{p.setOptions(c)},[c,p]),((t,e)=>(null==t?void 0:t.suspense)&&e.isPending)(c,f))throw et(c,p,u);if((({result:t,errorResetBoundary:e,throwOnError:s,query:i,suspense:r})=>t.isError&&!e.isReset()&&!t.isFetching&&i&&(r&&void 0===t.data||V(s,[t.error,i])))({result:f,errorResetBoundary:u,throwOnError:c.throwOnError,query:o.getQueryCache().get(c.queryHash),suspense:c.suspense}))throw f.error;if(null==(n=null==(a=o.getDefaultOptions().queries)?void 0:a._experimental_afterQuery)||n.call(a,c,f),c.experimental_prefetchInRender&&!P&&((t,e)=>t.isLoading&&t.isFetching&&!e)(f,l)){const t=d?et(c,p,u):null==(h=o.getQueryCache().get(c.queryHash))?void 0:h.promise;null==t||t.catch(D).finally(()=>{p.updateResult()})}return c.notifyOnChangeProps?f:p.trackResult(f)}function it(t,e){return st(t,Y)}export{it as u};
