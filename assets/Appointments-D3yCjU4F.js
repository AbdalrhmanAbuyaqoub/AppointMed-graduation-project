import{s as Ie,r as C,Z as Ne,q as te,u as _,j as e,U as Ae,B as je,aA as be,a as ze,aB as Q,c as Te,z as Le,y as Me,a3 as ke,D as Ee,g as Fe,G as E,f as U,ap as D,e as O,aC as Re,ao as Oe,ae as $e,aD as Be,aE as Ye,aF as fe,h as Ce,i as He,M as H,aG as Ve,ar as Ue,aH as _e,C as We,T as Ze,aI as Ge,at as qe,P as Je}from"./index-ZwLsdpq7.js";import{u as De}from"./useAppointmentQueries-BY0jJUAZ.js";import{S as Ke,D as Qe,I as Xe,a as et,A as tt,C as st}from"./AppointmentDetailsDrawer-BalQOPNm.js";import{T as h}from"./Table-C_2zmgBg.js";import{g as at}from"./get-auto-contrast-value-Da6zqqWm.js";import{d as ee,a as nt,t as ot}from"./useWorkingHoursQueries-4Kg8ESMa.js";import"./appointmentService-IRgsPcX5.js";import"./use-form-D7qxXVJX.js";import"./use-isomorphic-layout-effect.browser.esm-DpoqnXgy.js";function k(a,t){const n=t-a+1;return Array.from({length:n},(o,l)=>l+a)}const X="dots";function it({total:a,siblings:t=1,boundaries:n=1,page:o,initialPage:l=1,onChange:i}){const c=Math.max(Math.trunc(a),0),[m,x]=Ie({value:o,onChange:i,defaultValue:l,finalValue:l}),d=I=>{I<=0?x(1):I>c?x(c):x(I)},p=()=>d(m+1),u=()=>d(m-1),j=()=>d(1),S=()=>d(c);return{range:C.useMemo(()=>{if(t*2+3+n*2>=c)return k(1,c);const A=Math.max(m-t,n),b=Math.min(m+t,c-n),z=A>n+2,M=b<c-(n+1);if(!z&&M){const T=t*2+n+2;return[...k(1,T),X,...k(c-(n-1),c)]}if(z&&!M){const T=n+1+2*t;return[...k(1,n),X,...k(c-T,c)]}return[...k(1,n),X,...k(A,b),X,...k(c-n+1,c)]},[c,t,m]),active:m,setPage:d,next:p,previous:u,first:j,last:S}}const[rt,se]=Ne("Pagination.Root component was not found in tree");var W={root:"m_4addd315",control:"m_326d024a",dots:"m_4ad7767d"};const ct={withPadding:!0},Z=te((a,t)=>{const n=_("PaginationControl",ct,a),{classNames:o,className:l,style:i,styles:c,vars:m,active:x,disabled:d,withPadding:p,mod:u,...j}=n,S=se(),f=d||S.disabled;return e.jsx(Ae,{ref:t,disabled:f,mod:[{active:x,disabled:f,"with-padding":p},u],...S.getStyles("control",{className:l,style:i,classNames:o,styles:c,active:!f}),...j})});Z.classes=W;Z.displayName="@mantine/core/PaginationControl";function G({style:a,children:t,path:n,...o}){return e.jsx("svg",{viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg",style:{width:"calc(var(--pagination-control-size) / 1.8)",height:"calc(var(--pagination-control-size) / 1.8)",...a},...o,children:e.jsx("path",{d:n,fill:"currentColor"})})}const lt=a=>e.jsx(G,{...a,path:"M8.781 8l-3.3-3.3.943-.943L10.667 8l-4.243 4.243-.943-.943 3.3-3.3z"}),dt=a=>e.jsx(G,{...a,path:"M7.219 8l3.3 3.3-.943.943L5.333 8l4.243-4.243.943.943-3.3 3.3z"}),ut=a=>e.jsx(G,{...a,path:"M6.85355 3.85355C7.04882 3.65829 7.04882 3.34171 6.85355 3.14645C6.65829 2.95118 6.34171 2.95118 6.14645 3.14645L2.14645 7.14645C1.95118 7.34171 1.95118 7.65829 2.14645 7.85355L6.14645 11.8536C6.34171 12.0488 6.65829 12.0488 6.85355 11.8536C7.04882 11.6583 7.04882 11.3417 6.85355 11.1464L3.20711 7.5L6.85355 3.85355ZM12.8536 3.85355C13.0488 3.65829 13.0488 3.34171 12.8536 3.14645C12.6583 2.95118 12.3417 2.95118 12.1464 3.14645L8.14645 7.14645C7.95118 7.34171 7.95118 7.65829 8.14645 7.85355L12.1464 11.8536C12.3417 12.0488 12.6583 12.0488 12.8536 11.8536C13.0488 11.6583 13.0488 11.3417 12.8536 11.1464L9.20711 7.5L12.8536 3.85355Z"}),ht=a=>e.jsx(G,{...a,path:"M2.14645 11.1464C1.95118 11.3417 1.95118 11.6583 2.14645 11.8536C2.34171 12.0488 2.65829 12.0488 2.85355 11.8536L6.85355 7.85355C7.04882 7.65829 7.04882 7.34171 6.85355 7.14645L2.85355 3.14645C2.65829 2.95118 2.34171 2.95118 2.14645 3.14645C1.95118 3.34171 1.95118 3.65829 2.14645 3.85355L5.79289 7.5L2.14645 11.1464ZM8.14645 11.1464C7.95118 11.3417 7.95118 11.6583 8.14645 11.8536C8.34171 12.0488 8.65829 12.0488 8.85355 11.8536L12.8536 7.85355C13.0488 7.65829 13.0488 7.34171 12.8536 7.14645L8.85355 3.14645C8.65829 2.95118 8.34171 2.95118 8.14645 3.14645C7.95118 3.34171 7.95118 3.65829 8.14645 3.85355L11.7929 7.5L8.14645 11.1464Z"}),mt=a=>e.jsx(G,{...a,path:"M2 8c0-.733.6-1.333 1.333-1.333.734 0 1.334.6 1.334 1.333s-.6 1.333-1.334 1.333C2.6 9.333 2 8.733 2 8zm9.333 0c0-.733.6-1.333 1.334-1.333C13.4 6.667 14 7.267 14 8s-.6 1.333-1.333 1.333c-.734 0-1.334-.6-1.334-1.333zM6.667 8c0-.733.6-1.333 1.333-1.333s1.333.6 1.333 1.333S8.733 9.333 8 9.333 6.667 8.733 6.667 8z"}),gt={icon:mt},ae=te((a,t)=>{const n=_("PaginationDots",gt,a),{classNames:o,className:l,style:i,styles:c,vars:m,icon:x,...d}=n,p=se(),u=x;return e.jsx(je,{ref:t,...p.getStyles("dots",{className:l,style:i,styles:c,classNames:o}),...d,children:e.jsx(u,{style:{width:"calc(var(--pagination-control-size) / 1.8)",height:"calc(var(--pagination-control-size) / 1.8)"}})})});ae.classes=W;ae.displayName="@mantine/core/PaginationDots";function ne({icon:a,name:t,action:n,type:o}){const l={icon:a},i=C.forwardRef((c,m)=>{const{icon:x,...d}=_(t,l,c),p=x,u=se(),j=o==="next"?u.active===u.total:u.active===1;return e.jsx(Z,{disabled:u.disabled||j,ref:m,onClick:u[n],withPadding:!1,...d,children:e.jsx(p,{className:"mantine-rotate-rtl",style:{width:"calc(var(--pagination-control-size) / 1.8)",height:"calc(var(--pagination-control-size) / 1.8)"}})})});return i.displayName=`@mantine/core/${t}`,be(i)}const Pe=ne({icon:lt,name:"PaginationNext",action:"onNext",type:"next"}),we=ne({icon:dt,name:"PaginationPrevious",action:"onPrevious",type:"previous"}),ve=ne({icon:ut,name:"PaginationFirst",action:"onFirst",type:"previous"}),ye=ne({icon:ht,name:"PaginationLast",action:"onLast",type:"next"});function ge({dotsIcon:a}){const t=se(),n=t.range.map((o,l)=>{var i,c,m;return o==="dots"?e.jsx(ae,{icon:a},l):e.jsx(Z,{active:o===t.active,"aria-current":o===t.active?"page":void 0,onClick:()=>t.onChange(o),disabled:t.disabled,...(i=t.getItemProps)==null?void 0:i.call(t,o),children:((m=(c=t.getItemProps)==null?void 0:c.call(t,o))==null?void 0:m.children)??o},l)});return e.jsx(e.Fragment,{children:n})}ge.displayName="@mantine/core/PaginationItems";const xt={siblings:1,boundaries:1},pt=Te((a,{size:t,radius:n,color:o,autoContrast:l})=>({root:{"--pagination-control-radius":n===void 0?void 0:Fe(n),"--pagination-control-size":Ee(t,"pagination-control-size"),"--pagination-control-fz":ke(t),"--pagination-active-bg":o?Me(o,a):void 0,"--pagination-active-color":at(l,a)?Le({color:o,theme:a,autoContrast:l}):void 0}})),oe=te((a,t)=>{const n=_("PaginationRoot",xt,a),{classNames:o,className:l,style:i,styles:c,unstyled:m,vars:x,total:d,value:p,defaultValue:u,onChange:j,disabled:S,siblings:f,boundaries:I,color:A,radius:b,onNextPage:z,onPreviousPage:M,onFirstPage:T,onLastPage:F,getItemProps:$,autoContrast:s,...L}=n,R=ze({name:"Pagination",classes:W,props:n,className:l,style:i,classNames:o,styles:c,unstyled:m,vars:x,varsResolver:pt}),{range:B,setPage:P,next:V,previous:q,active:ie,first:re,last:ce}=it({page:p,initialPage:u,onChange:j,total:d,siblings:f,boundaries:I}),J=Q(z,V),le=Q(M,q),K=Q(T,re),Y=Q(F,ce);return e.jsx(rt,{value:{total:d,range:B,active:ie,disabled:S,getItemProps:$,onChange:P,onNext:J,onPrevious:le,onFirst:K,onLast:Y,getStyles:R},children:e.jsx(je,{ref:t,...R("root"),...L})})});oe.classes=W;oe.displayName="@mantine/core/PaginationRoot";const ft={withControls:!0,withPages:!0,siblings:1,boundaries:1,gap:8},N=te((a,t)=>{const n=_("Pagination",ft,a),{withEdges:o,withControls:l,getControlProps:i,nextIcon:c,previousIcon:m,lastIcon:x,firstIcon:d,dotsIcon:p,total:u,gap:j,hideWithOnePage:S,withPages:f,...I}=n;return u<=0||S&&u===1?null:e.jsx(oe,{ref:t,total:u,...I,children:e.jsxs(E,{gap:j,children:[o&&e.jsx(ve,{icon:d,...i==null?void 0:i("first")}),l&&e.jsx(we,{icon:m,...i==null?void 0:i("previous")}),f&&e.jsx(ge,{dotsIcon:p}),l&&e.jsx(Pe,{icon:c,...i==null?void 0:i("next")}),o&&e.jsx(ye,{icon:x,...i==null?void 0:i("last")})]})})});N.classes=W;N.displayName="@mantine/core/Pagination";N.Root=oe;N.Control=Z;N.Dots=ae;N.First=ve;N.Last=ye;N.Next=Pe;N.Previous=we;N.Items=ge;const jt=a=>{const t=new Date,n=new Date(t.setHours(0,0,0,0));switch(a){case"today":return[n,new Date(t.setHours(23,59,59,999))];case"this-week":{const o=new Date(n);o.setDate(o.getDate()-o.getDay());const l=new Date(o);return l.setDate(l.getDate()+6),l.setHours(23,59,59,999),[o,l]}case"this-month":{const o=new Date(t.getFullYear(),t.getMonth(),1),l=new Date(t.getFullYear(),t.getMonth()+1,0,23,59,59,999);return[o,l]}default:return[null,null]}},me=a=>{if(!a)return null;const t=new Date(a);return t.setHours(0,0,0,0),t};function Ct({searchQuery:a,hasFilters:t}){const n=()=>a?"No appointments found matching your search":t?"No appointments found with the current filters":"No appointments found";return e.jsx(h.Tr,{children:e.jsx(h.Td,{colSpan:7,children:e.jsx(He,{h:100,children:e.jsx(U,{align:"center",gap:"md",children:e.jsx(Ce,{size:"lg",fw:500,c:"dimmed",children:n()})})})})})}function Dt({appointments:a=[],onAppointmentClick:t,searchQuery:n=""}){var xe,pe;const[o,l]=C.useState("all"),[i,c]=C.useState([null,null]),[m,x]=C.useState(!1),[d,p]=C.useState(null),[u,j]=C.useState(!1),[S,f]=C.useState(!1),[I,A]=C.useState(!1),[b,z]=C.useState(a),[M,T]=C.useState(1),F=20,{updateAppointment:$,deleteAppointment:s,updateAppointmentStatus:L}=De(),R={0:"Scheduled",1:"Cancelled",2:"Completed",3:"No Show"},B={0:"blue",1:"red",2:"green",3:"orange"};C.useEffect(()=>{z(a)},[a]);const P=r=>{const g=jt(r);c(g)},V=()=>{if(!i[0]||!i[1])return"Date Range";const r=v=>!v||!(v instanceof Date)?"":v.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),g=r(i[0]),w=r(i[1]);return!g||!w?"Date Range":`${g} - ${w}`},q=r=>{p(r),j(!0)},ie=async r=>{try{await s.mutateAsync(r),H.show({title:"Success",message:"Appointment deleted successfully",color:"green"})}catch(g){H.show({title:"Error",message:g.message||"Failed to delete appointment",color:"red"})}},re=async r=>{try{await $.mutateAsync({id:d.id,...r}),H.show({title:"Success",message:"Appointment updated successfully",color:"green"}),j(!1)}catch(g){H.show({title:"Error",message:g.message||"Failed to update appointment",color:"red"})}};C.useEffect(()=>{const r=a.filter(g=>{var v;if(!(o==="all"||g.status===parseInt(o)))return!1;if(n){const y=n.toLowerCase().trim();if(![g.patientName,(v=g.id)==null?void 0:v.toString()].some(he=>he==null?void 0:he.toLowerCase().includes(y)))return!1}if(!i[0]||!i[1])return!0;try{const y=me(new Date(g.date)),de=me(i[0]),ue=me(i[1]);return!y||!de||!ue?!0:y>=de&&y<=ue}catch(y){return console.error("Error filtering appointment date:",y),!0}});z(r),T(1)},[a,o,n,i]);const ce=Math.ceil(b.length/F),J=(M-1)*F,le=J+F,K=b.slice(J,le),Y=async(r,g)=>{try{const w=await L.mutateAsync({appointmentId:r,newStatus:g});H.show({title:"Success",message:w.message||"Appointment status updated successfully",color:"green"});const v=b.map(y=>y.id===r?{...y,status:w.newStatus}:y);z(v)}catch(w){H.show({title:"Error",message:w.message||"Failed to update appointment status",color:"red"})}},Se=r=>{p(r),A(!0),t&&t(r)};return e.jsxs(U,{children:[e.jsx(E,{mt:"sm",justify:"start",w:"100%",mb:"md",children:e.jsxs(E,{gap:"md",children:[e.jsx(Ke,{size:"md",radius:"md",value:o,onChange:l,data:[{label:"All",value:"all"},{label:"Scheduled",value:"0"},{label:"Completed",value:"2"},{label:"Cancelled",value:"1"},{label:"No Show",value:"3"}]}),e.jsxs(D,{shadow:"md",radius:"lg",opened:m,onChange:x,position:"bottom-start",width:"targetWidth",children:[e.jsx(D.Target,{children:e.jsx(O,{size:"md",radius:"md",variant:"subtle",rightSection:e.jsx(Re,{color:"black",size:18}),children:V()})}),e.jsx(D.Dropdown,{p:"md",children:e.jsxs(U,{gap:"xs",children:[e.jsxs(E,{py:"sm",w:"100%",justify:"left",children:[e.jsx(O,{size:"sm",radius:"md",variant:"subtle",onClick:()=>P("today"),children:"Today"}),e.jsx(O,{size:"sm",radius:"md",variant:"subtle",onClick:()=>P("this-week"),children:"This Week"}),e.jsx(O,{radius:"md",size:"sm",variant:"subtle",onClick:()=>P("this-month"),children:"This Month"})]}),e.jsx(Qe,{size:"sm",type:"range",value:i,onChange:r=>{const[g,w]=r;if(g&&w){const v=new Date(w);v.setHours(23,59,59,999),c([g,v])}else c(r)},numberOfColumns:2})]})})]})]})}),e.jsxs(h,{verticalSpacing:"sm",highlightOnHover:!0,children:[e.jsx(h.Thead,{children:e.jsxs(h.Tr,{children:[e.jsx(h.Th,{children:"ID"}),e.jsx(h.Th,{children:"Patient"}),e.jsx(h.Th,{children:"Doctor"}),e.jsx(h.Th,{children:"Clinic"}),e.jsx(h.Th,{children:"Date"}),e.jsx(h.Th,{children:"Time"}),e.jsx(h.Th,{children:"Status"})]})}),e.jsx(h.Tbody,{children:K.length===0?e.jsx(Ct,{searchQuery:n,hasFilters:o!=="all"||i[0]&&i[1]}):K.map(r=>{const g=r.status,w=R[g]||"Scheduled",v=B[g]||"blue";return e.jsxs(h.Tr,{style:{cursor:"pointer"},onClick:()=>Se(r),children:[e.jsx(h.Td,{children:r.id}),e.jsx(h.Td,{children:r.patientName}),e.jsx(h.Td,{children:r.doctorName}),e.jsx(h.Td,{children:r.clinicName}),e.jsx(h.Td,{children:r.displayDate||r.date}),e.jsx(h.Td,{children:r.time}),e.jsx(h.Td,{children:e.jsx(Oe,{size:"md",color:v,children:w})}),e.jsx(h.Td,{children:e.jsx(E,{gap:"xs",onClick:y=>y.stopPropagation(),children:e.jsxs(D,{shadow:"md",width:200,children:[e.jsx(D.Target,{children:e.jsx($e,{variant:"subtle",color:"gray",children:e.jsx(Xe,{size:16})})}),e.jsxs(D.Dropdown,{children:[e.jsx(D.Label,{children:"Update Status"}),e.jsx(D.Item,{onClick:()=>Y(r.id,0),color:"blue",children:"Mark as Scheduled"}),e.jsx(D.Item,{onClick:()=>Y(r.id,1),color:"red",children:"Mark as Cancelled"}),e.jsx(D.Item,{onClick:()=>Y(r.id,2),color:"green",children:"Mark as Completed"}),e.jsx(D.Item,{onClick:()=>Y(r.id,3),color:"orange",children:"Mark as No Show"}),e.jsx(D.Divider,{}),e.jsx(D.Label,{children:"Actions"}),e.jsx(D.Item,{leftSection:e.jsx(Be,{size:14}),onClick:()=>q(r),children:"Edit"}),e.jsx(D.Item,{leftSection:e.jsx(Ye,{size:14}),color:"red",onClick:()=>{p(r),f(!0)},children:"Delete"})]})]})})})]},r.id)})})]}),b.length>0&&e.jsx(E,{justify:"center",mt:"lg",children:e.jsx(N,{value:M,onChange:T,total:ce,size:"sm",radius:"md"})}),e.jsx(fe,{opened:u,onClose:()=>j(!1),title:"Edit Appointment",size:"lg",children:d&&e.jsx(et,{initialValues:{doctorId:(pe=(xe=d.doctor)==null?void 0:xe.id)==null?void 0:pe.toString(),patientName:d.patientName,patientPhone:d.patientPhone||"",startTime:new Date(d.rawDate),notes:d.notes||""},onSubmit:re,isLoading:$.isPending})}),e.jsx(fe,{opened:S,onClose:()=>f(!1),title:"Delete Appointment",size:"sm",children:e.jsxs(U,{children:[e.jsxs(Ce,{children:["Are you sure you want to delete this appointment for"," ",d==null?void 0:d.patientName,"?"]}),e.jsxs(E,{justify:"flex-end",mt:"md",children:[e.jsx(O,{variant:"light",onClick:()=>f(!1),children:"Cancel"}),e.jsx(O,{color:"red",loading:s.isPending,onClick:()=>{ie(d.id),f(!1)},children:"Delete"})]})]})}),e.jsx(tt,{opened:I,onClose:()=>A(!1),appointment:d,onEdit:()=>{A(!1),j(!0)},onDelete:()=>{A(!1),f(!0)}})]})}ee.extend(nt);ee.extend(ot);function zt(){const[a,t]=C.useState(null),[n,o]=C.useState(null),{searchQuery:l}=Ve(),[i,{open:c,close:m}]=Ue(!1),{clinics:x,doctors:d,isLoading:p,error:u}=_e(),{appointments:j,isLoadingAppointments:S,appointmentsError:f,getAppointmentsByClinic:I,getAppointmentsByDoctor:A}=De(),{data:b}=I(a),{data:z}=A(n),M=n?z:a?b:j,T=C.useCallback(s=>{if(!s||s==="all")t(null),o(null);else if(s.startsWith("clinic-")){const L=s.replace("clinic-","");t(L),o(null)}else if(s.startsWith("doctor-")){const L=s.replace("doctor-","");o(L),t(null)}},[]),F=[{group:"General",items:[{value:"all",label:"All Appointments"}]},{group:"Clinics",items:x.map(s=>({value:`clinic-${s.id}`,label:s.name}))},{group:"Doctors",items:d.map(s=>({value:`doctor-${s.id}`,label:`${s.name} (${s.clinicName})`}))}],$=(M||[]).map(s=>{var L,R,B;try{const P=s.startDate?ee.utc(s.startDate).tz(ee.tz.guess()):null;if(!P||!P.isValid())return{...s,id:s.id,patientName:s.patientName,doctorName:((L=s.doctor)==null?void 0:L.name)||"N/A",clinicName:s.clinicName||"N/A",date:"Invalid Date",time:"Invalid Time",status:s.status!==void 0?s.status:0,doctor:s.doctor,userId:s.userId,patientId:s.patientId};const V=P.format("YYYY-MM-DD");return{id:s.id,patientName:s.patientName,doctorName:((R=s.doctor)==null?void 0:R.name)||"N/A",clinicName:s.clinicName||"N/A",rawDate:P.toDate(),date:V,displayDate:P.format("MMM D, YYYY"),time:P.format("hh:mm A"),status:s.status!==void 0?s.status:0,doctor:s.doctor,patientPhone:s.patientPhone,notes:s.notes,userId:s.userId,patientId:s.patientId}}catch(P){return console.error("Error formatting appointment:",P),{...s,id:s.id,patientName:s.patientName,doctorName:((B=s.doctor)==null?void 0:B.name)||"N/A",clinicName:s.clinicName||"N/A",date:"Error",displayDate:"Error",time:"Error",status:s.status!==void 0?s.status:0,doctor:s.doctor,userId:s.userId,patientId:s.patientId}}});return e.jsx(We,{pt:12,fluid:!0,maw:1232,children:e.jsxs(U,{children:[e.jsx(Ze,{fz:"24px",order:2,children:"Appointments"}),e.jsxs(E,{mt:40,justify:"space-between",children:[e.jsx(Ge,{w:200,size:"lg",radius:"md",data:F,placeholder:"Select clinic or doctor",disabled:p,error:u==null?void 0:u.message,onChange:T,value:n?`doctor-${n}`:a?`clinic-${a}`:"all",comboboxProps:{width:500,position:"bottom-start"},styles:{dropdown:{borderRadius:"var(--mantine-radius-md)",boxShadow:"var(--mantine-shadow-md)",minWidth:"200px"}}}),e.jsx(O,{onClick:c,leftSection:e.jsx(qe,{size:16}),variant:"outline",size:"lg",radius:"xl",children:"New Appointment"})]}),e.jsx(Je,{withBorder:!0,radius:"md",p:"md",children:S?e.jsx("div",{children:"Loading appointments..."}):f?e.jsxs("div",{children:["Error loading appointments: ",f.message]}):e.jsx(Dt,{appointments:$,searchQuery:l})}),e.jsx(st,{opened:i,onClose:m})]})})}export{zt as default};
