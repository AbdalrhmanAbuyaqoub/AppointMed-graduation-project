import{J as R,d as U,l as G,u as E,e as F,Z as D,j as e,I as H,B as S,f as L,n as k,G as I,q as B,P as j,r as M,_ as A,$ as x,H as W,a0 as q,p as K,a1 as O,a2 as $,a3 as J,a4 as Q,D as X,a5 as Y,A as Z,a6 as V,a7 as ee,a8 as se}from"./index-RKo_O0CB.js";import{A as w}from"./Avatar-Bca3wnni.js";import{I as te}from"./Image-Bh1MA1Ya.js";const ae={gap:{type:"spacing",property:"gap"},rowGap:{type:"spacing",property:"rowGap"},columnGap:{type:"spacing",property:"columnGap"},align:{type:"identity",property:"alignItems"},justify:{type:"identity",property:"justifyContent"},wrap:{type:"identity",property:"flexWrap"},direction:{type:"identity",property:"flexDirection"}};var C={root:"m_8bffd616"};const ne={},g=R((s,t)=>{const a=U("Flex",ne,s),{classNames:n,className:r,style:o,styles:u,unstyled:d,vars:c,gap:v,rowGap:f,columnGap:i,align:p,justify:m,wrap:h,direction:b,...N}=a,T=G({name:"Flex",classes:C,props:a,className:r,style:o,classNames:n,styles:u,unstyled:d,vars:c}),z=E(),_=F(),y=D({styleProps:{gap:v,rowGap:f,columnGap:i,align:p,justify:m,wrap:h,direction:b},theme:z,data:ae});return e.jsxs(e.Fragment,{children:[y.hasResponsiveStyles&&e.jsx(H,{selector:`.${_}`,styles:y.styles,media:y.media}),e.jsx(S,{ref:t,...T("root",{className:_,style:L(y.inlineStyles)}),...N})]})});g.classes=C;g.displayName="@mantine/core/Flex";/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var re=k("outline","robot","IconRobot",[["path",{d:"M6 4m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v4a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z",key:"svg-0"}],["path",{d:"M12 2v2",key:"svg-1"}],["path",{d:"M9 12v9",key:"svg-2"}],["path",{d:"M15 12v9",key:"svg-3"}],["path",{d:"M5 16l4 -2",key:"svg-4"}],["path",{d:"M15 14l4 2",key:"svg-5"}],["path",{d:"M9 18h6",key:"svg-6"}],["path",{d:"M10 8v.01",key:"svg-7"}],["path",{d:"M14 8v.01",key:"svg-8"}]]);/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var oe=k("outline","send","IconSend",[["path",{d:"M10 14l11 -11",key:"svg-0"}],["path",{d:"M21 3l-6.5 18a.55 .55 0 0 1 -1 0l-3.5 -7l-7 -3.5a.55 .55 0 0 1 0 -1l18 -6.5",key:"svg-1"}]]);/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var ie=k("outline","settings","IconSettings",[["path",{d:"M10.325 4.317c.426 -1.756 2.924 -1.756 3.35 0a1.724 1.724 0 0 0 2.573 1.066c1.543 -.94 3.31 .826 2.37 2.37a1.724 1.724 0 0 0 1.065 2.572c1.756 .426 1.756 2.924 0 3.35a1.724 1.724 0 0 0 -1.066 2.573c.94 1.543 -.826 3.31 -2.37 2.37a1.724 1.724 0 0 0 -2.572 1.065c-.426 1.756 -2.924 1.756 -3.35 0a1.724 1.724 0 0 0 -2.573 -1.066c-1.543 .94 -3.31 -.826 -2.37 -2.37a1.724 1.724 0 0 0 -1.065 -2.572c-1.756 -.426 -1.756 -2.924 0 -3.35a1.724 1.724 0 0 0 1.066 -2.573c-.94 -1.543 .826 -3.31 2.37 -2.37c1 .608 2.296 .07 2.572 -1.065z",key:"svg-0"}],["path",{d:"M9 12a3 3 0 1 0 6 0a3 3 0 0 0 -6 0",key:"svg-1"}]]);const le="_userBubble_kv9dn_1",ce="_botBubble_kv9dn_8",pe="_userAvatar_kv9dn_18",de="_botAvatar_kv9dn_24",ue="_messageGroup_kv9dn_30",me="_messageWrapper_kv9dn_36",he="_timestamp_kv9dn_40",ge="_input_kv9dn_45",ye="_sendButton_kv9dn_65",xe="_inputContainer_kv9dn_83",l={userBubble:le,botBubble:ce,userAvatar:pe,botAvatar:de,messageGroup:ue,messageWrapper:me,timestamp:he,input:ge,sendButton:ye,inputContainer:xe};function ve(s){const t=[];let a=0;const n=/<b>(.*?)<\/b>/gi;let r,o=0;for(;(r=n.exec(s))!==null;)r.index>a&&t.push(s.slice(a,r.index)),t.push(e.jsx("b",{children:r[1]},o++)),a=n.lastIndex;return a<s.length&&t.push(s.slice(a)),t}function fe({message:s}){return e.jsxs(I,{justify:s.isUser?"flex-end":"flex-start",align:"flex-end",className:l.messageGroup,children:[!s.isUser&&e.jsx(w,{variant:"filled",radius:"xl",size:"md",className:l.botAvatar,children:e.jsx(re,{size:"1.2rem"})}),e.jsxs(B,{gap:4,align:s.isUser?"flex-end":"flex-start",style:{maxWidth:"70%"},children:[e.jsx(S,{className:l.messageWrapper,children:e.jsx(j,{className:s.isUser?l.userBubble:l.botBubble,shadow:"sm",p:"sm",children:e.jsx(M,{size:"sm",style:{whiteSpace:"pre-wrap",wordBreak:"break-word"},children:ve(s.text)})})}),e.jsx(M,{size:"xs",c:"dimmed",className:l.timestamp,children:s.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),s.isUser&&e.jsx(w,{variant:"filled",size:"md",radius:"xl",className:l.userAvatar,children:e.jsx(A,{size:"1.2rem"})})]})}function be({onSendMessage:s}){const[t,a]=x.useState(""),n=()=>{t.trim()&&(s(t.trim()),a(""))},r=o=>{o.key==="Enter"&&!o.shiftKey&&(o.preventDefault(),n())};return e.jsxs(I,{gap:"xs",className:l.inputContainer,children:[e.jsx(W,{placeholder:"Type a message... (Press Enter to send)",value:t,onChange:o=>a(o.target.value),onKeyDown:r,style:{flex:1},classNames:{input:l.input},size:"md",radius:"xl"}),e.jsx(q,{label:"Send message",position:"top",children:e.jsx(K,{onClick:n,variant:"filled",className:l.sendButton,disabled:!t.trim(),children:e.jsx(oe,{size:18})})})]})}const je="https://chatbot.majhool.me/api",P=O.create({baseURL:je,headers:{"Content-Type":"application/json"}});P.interceptors.request.use(s=>{const t=localStorage.getItem("token");return t&&(s.headers.Authorization=`Bearer ${t}`),s},s=>Promise.reject(s));const Se=()=>{const s=$();if(!s)return null;try{const a=s.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),n=decodeURIComponent(atob(a).split("").map(o=>"%"+("00"+o.charCodeAt(0).toString(16)).slice(-2)).join("")),r=JSON.parse(n);return r.nameid||r.userId||r.sub||r.id}catch(t){return console.error("Error decoding token:",t),null}},ke={sendMessage:async s=>{try{const a={user_id:Se()||"",message:s};console.log("[chatService] Sending message:",a);const n=await P.post("/chat",a);return console.log("[chatService] Received response:",n.data),n.data}catch(t){throw console.error("Error sending message:",t),t}}};function _e(){const[s,t]=x.useState([]),a=J({mutationFn:async n=>{const r={id:Date.now().toString(),text:n,isUser:!0,timestamp:new Date},o={id:(Date.now()+1).toString(),text:"...",isUser:!1,timestamp:new Date,isTemp:!0};t(d=>[...d,r,o]);const u=await ke.sendMessage(n);return t(d=>d.map(c=>c.isTemp&&c.id===o.id?{...c,text:u.reply,isTemp:!1}:c)),{userMessage:r}},onError:n=>{Q.error("Error","Failed to send message"),t(r=>r.filter(o=>!o.isTemp))}});return{messages:s,isLoading:a.isPending,error:a.error,sendMessage:n=>a.mutate(n)}}const Me="/graduation-front/assets/calendar-illustration-rrQxCqtX.svg";function Ae(){const s=x.useRef(null),{user:t,handleLogout:a}=X(),[n,r]=x.useState(!1),{messages:o,sendMessage:u}=_e(),d=[{label:"Profile",icon:e.jsx(A,{size:14}),onClick:()=>{}},{label:"Settings",icon:e.jsx(ie,{size:14}),onClick:()=>{}},{label:"Log Out",icon:e.jsx(se,{size:14}),onClick:a,color:"red"}],c=(i="smooth")=>{if(s.current){const p=s.current,m=p.scrollHeight,h=p.clientHeight;p.scrollTo({top:m-h,behavior:i})}};Y.useEffect(()=>{n||c()},[o,n]);const v=async i=>{i.trim()&&(r(!1),await u(i))},f=({y:i})=>{if(!s.current)return;const p=s.current,m=p.scrollHeight,h=p.clientHeight,b=Math.abs(m-h-i)<1;r(!b)};return e.jsx(Z,{bg:"var(--mantine-color-blue-light)",children:e.jsxs(g,{h:"100vh",gap:"md",p:"md",children:[e.jsxs(j,{w:"70%",radius:"md",bg:"transparent",pos:"relative",children:[e.jsx(S,{pos:"absolute",top:20,left:30,children:e.jsx(V,{userRole:(t==null?void 0:t.role)||"user",menuItems:d})}),e.jsx(g,{align:"center",justify:"center",h:"100%",children:e.jsx(te,{src:Me,alt:"Calendar Illustration",h:600,w:"auto"})})]}),e.jsx(j,{w:500,radius:"lg",shadow:"md",mr:30,bg:"gray.1",pos:"relative",children:e.jsxs(g,{direction:"column",h:"100%",children:[e.jsx(ee,{h:"calc(100% - 80px)",viewportRef:s,offsetScrollbars:!0,onScrollPositionChange:f,scrollbarSize:8,type:"hover",children:e.jsx(B,{gap:"md",p:"md",children:o.map(i=>e.jsx(fe,{message:i},i.id))})}),e.jsx(be,{onSendMessage:v})]})})]})})}export{Ae as default};
